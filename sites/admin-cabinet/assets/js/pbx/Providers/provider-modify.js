"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate, Form, $, ClipboardJS */

/**
 * Object for handling provider management form
 *
 * @module provider
 */
var provider = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#save-provider-form'),

  /**
   * jQuery object for the secret field.
   * @type {jQuery}
   */
  $secret: $('#secret'),

  /**
   * Dirty check field, for checking if something on the form was changed
   * @type {jQuery}
   */
  $dirrtyField: $('#dirrty'),
  providerType: $('#providerType').val(),
  $checkBoxes: $('#save-provider-form .checkbox'),
  $accordions: $('#save-provider-form .ui.accordion'),
  $dropDowns: $('#save-provider-form .ui.dropdown'),
  $deleteRowButton: $('#additional-hosts-table .delete-row-button'),
  $qualifyToggle: $('#qualify'),
  $qualifyFreqToggle: $('#qualify-freq'),
  $additionalHostInput: $('#additional-host input'),
  hostInputValidation: /^((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(\d|[1-2]\d|3[0-2]))?|[a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+)$/gm,
  hostRow: '#save-provider-form .host-row',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    description: {
      identifier: 'description',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.pr_ValidationProviderNameIsEmpty
      }]
    },
    host: {
      identifier: 'host',
      rules: [{
        type: 'checkHostProvider',
        prompt: globalTranslate.pr_ValidationProviderHostIsEmpty
      }]
    },
    username: {
      identifier: 'username',
      optional: true,
      rules: [{
        type: 'minLength[2]',
        prompt: globalTranslate.pr_ValidationProviderLoginNotSingleSimbol
      }]
    },
    port: {
      identifier: 'port',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.pr_ValidationProviderPortRange
      }]
    }
  },

  /**
   * Initialize the provider form.
   */
  initialize: function initialize() {
    provider.$checkBoxes.checkbox();
    provider.$accordions.accordion();
    provider.$dropDowns.dropdown();
    /**
     * Callback function called when the qualify toggle changes.
     */

    provider.$qualifyToggle.checkbox({
      onChange: function onChange() {
        if (provider.$qualifyToggle.checkbox('is checked')) {
          provider.$qualifyFreqToggle.removeClass('disabled');
        } else {
          provider.$qualifyFreqToggle.addClass('disabled');
        }
      }
    }); // Add new string to additional-hosts-table table

    provider.$additionalHostInput.keypress(function (e) {
      if (e.which === 13) {
        provider.cbOnCompleteHostAddress();
      }
    }); // Delete host from additional-hosts-table

    provider.$deleteRowButton.on('click', function (e) {
      e.preventDefault();
      $(e.target).closest('tr').remove();
      provider.updateHostsTableView(); // Change the value of '$dirrtyField' to trigger
      // the 'change' form event and enable submit button.

      provider.$dirrtyField.val(Math.random());
      provider.$dirrtyField.trigger('change');
      return false;
    });
    provider.initializeForm();
    provider.updateVisibilityElements();
    $('#registration_type').on('change', provider.updateVisibilityElements);
    $('#disablefromuser input').on('change', provider.updateVisibilityElements);
    $('#generate-new-password').on('click', function (e) {
      /**
       * Event handler for the generate new password button click event.
       * @param {Event} e - The click event.
       */
      e.preventDefault();
      var chars = 'abcdef1234567890';
      var pass = '';

      for (var x = 0; x < 32; x += 1) {
        var i = Math.floor(Math.random() * chars.length);
        pass += chars.charAt(i);
      }

      provider.$secret.val(pass);
      provider.$secret.trigger('change');
    });
    provider.$secret.on('change', function () {
      $('#elSecret a.ui.button.clipboard').attr('data-clipboard-text', provider.$secret.val());
    });
    var clipboard = new ClipboardJS('.clipboard');
    $('.clipboard').popup({
      on: 'manual'
    });
    clipboard.on('success', function (e) {
      $(e.trigger).popup('show');
      setTimeout(function () {
        $(e.trigger).popup('hide');
      }, 1500);
      e.clearSelection();
    });
    clipboard.on('error', function (e) {
      console.error('Action:', e.action);
      console.error('Trigger:', e.trigger);
    });
  },

  /**
   * Update the visibility of elements based on the provider type and registration type.
   */
  updateVisibilityElements: function updateVisibilityElements() {
    if (provider.providerType !== 'SIP') {
      return;
    } // Get element references


    var elHost = $('#elHost');
    var elUsername = $('#elUsername');
    var elSecret = $('#elSecret');
    var elAdditionalHost = $('#elAdditionalHosts');
    var regType = $('#registration_type').val();
    var elUniqId = $('#uniqid');
    var genPassword = $('#generate-new-password');
    var valUserName = $('#username');
    var valSecret = provider.$secret; // Reset username if necessary

    if (valUserName.val() === elUniqId.val() && regType !== 'outbound') {
      valUserName.val('');
    }

    valUserName.removeAttr('readonly'); // Update element visibility based on registration type

    if (regType === 'outbound') {
      elHost.show();
      elUsername.show();
      elSecret.show();
      elAdditionalHost.show();
      genPassword.hide();
    } else if (regType === 'inbound') {
      valUserName.val(elUniqId.val());
      valUserName.attr('readonly', '');

      if (valSecret.val().trim() === '') {
        valSecret.val('id=' + $('#id').val() + '-' + elUniqId.val());
      }

      elHost.hide();
      elUsername.show();
      elSecret.show();
      genPassword.show();
    } else if (regType === 'none') {
      elHost.show();
      elUsername.hide();
      elSecret.hide();
    } // Update element visibility based on 'disablefromuser' checkbox


    var el = $('#disablefromuser');
    var fromUser = $('#divFromUser');

    if (el.checkbox('is checked')) {
      fromUser.hide();
      fromUser.removeClass('visible');
    } else {
      fromUser.show();
      fromUser.addClass('visible');
    }
  },

  /**
   * Callback function when completing the host address input.
   */
  cbOnCompleteHostAddress: function cbOnCompleteHostAddress() {
    var value = provider.$formObj.form('get value', 'additional-host');

    if (value) {
      var validation = value.match(provider.hostInputValidation); // Validate the input value

      if (validation === null || validation.length === 0) {
        provider.$additionalHostInput.transition('shake');
        return;
      } // Check if the host address already exists


      if ($(".host-row[data-value=\"".concat(value, "\"]")).length === 0) {
        var $tr = $('.host-row-tpl').last();
        var $clone = $tr.clone(true);
        $clone.removeClass('host-row-tpl').addClass('host-row').show();
        $clone.attr('data-value', value);
        $clone.find('.address').html(value);

        if ($(provider.hostRow).last().length === 0) {
          $tr.after($clone);
        } else {
          $(provider.hostRow).last().after($clone);
        }

        provider.updateHostsTableView(); // Change the value of '$dirrtyField' to trigger
        // the 'change' form event and enable submit button.

        provider.$dirrtyField.val(Math.random());
        provider.$dirrtyField.trigger('change');
      }

      provider.$additionalHostInput.val('');
    }
  },

  /**
   * Updates the hosts table view based on the presence of additional hosts or shows dummy if there is no records
   */
  updateHostsTableView: function updateHostsTableView() {
    var dummy = "<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">".concat(globalTranslate.pr_NoAnyAdditionalHosts, "</td></tr>");

    if ($(provider.hostRow).length === 0) {
      $('#additional-hosts-table tbody').append(dummy);
    } else {
      $('#additional-hosts-table tbody .dummy').remove();
    }
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = provider.$formObj.form('get values');
    var arrAdditionalHosts = [];
    $(provider.hostRow).each(function (index, obj) {
      if ($(obj).attr('data-value')) {
        arrAdditionalHosts.push({
          address: $(obj).attr('data-value')
        });
      }
    });
    result.data.additionalHosts = JSON.stringify(arrAdditionalHosts);
    return result;
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = provider.$formObj;

    Form.$formObj.form.settings.rules.checkHostProvider = function (value) {
      var enable;

      if ($('#registration_type').val() === 'inbound') {
        enable = true;
      } else {
        enable = value.trim() !== '';
      }

      return enable;
    };

    switch (provider.providerType) {
      case 'SIP':
        Form.url = "".concat(globalRootUrl, "providers/save/sip"); // Form submission URL

        break;

      case 'IAX':
        Form.url = "".concat(globalRootUrl, "providers/save/iax"); // Form submission URL

        break;

      default:
        return;
    }

    Form.validateRules = provider.validateRules; // Form validation rules

    Form.cbBeforeSendForm = provider.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = provider.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Custom form validation rule for username.
 * @param {string} noregister - The value of the 'noregister' attribute.
 * @param {string} username - The value of the username input field.
 * @returns {boolean} - Whether the validation rule passes or not.
 */

$.fn.form.settings.rules.username = function (noregister, username) {
  return !(username.length === 0 && noregister !== 'on');
};
/**
 *  Initialize provider management form on document ready
 */


$(document).ready(function () {
  provider.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qcm92aWRlcnMvcHJvdmlkZXItbW9kaWZ5LmpzIl0sIm5hbWVzIjpbInByb3ZpZGVyIiwiJGZvcm1PYmoiLCIkIiwiJHNlY3JldCIsIiRkaXJydHlGaWVsZCIsInByb3ZpZGVyVHlwZSIsInZhbCIsIiRjaGVja0JveGVzIiwiJGFjY29yZGlvbnMiLCIkZHJvcERvd25zIiwiJGRlbGV0ZVJvd0J1dHRvbiIsIiRxdWFsaWZ5VG9nZ2xlIiwiJHF1YWxpZnlGcmVxVG9nZ2xlIiwiJGFkZGl0aW9uYWxIb3N0SW5wdXQiLCJob3N0SW5wdXRWYWxpZGF0aW9uIiwiaG9zdFJvdyIsInZhbGlkYXRlUnVsZXMiLCJkZXNjcmlwdGlvbiIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJOYW1lSXNFbXB0eSIsImhvc3QiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJIb3N0SXNFbXB0eSIsInVzZXJuYW1lIiwib3B0aW9uYWwiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJMb2dpbk5vdFNpbmdsZVNpbWJvbCIsInBvcnQiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJQb3J0UmFuZ2UiLCJpbml0aWFsaXplIiwiY2hlY2tib3giLCJhY2NvcmRpb24iLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImtleXByZXNzIiwiZSIsIndoaWNoIiwiY2JPbkNvbXBsZXRlSG9zdEFkZHJlc3MiLCJvbiIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwiY2xvc2VzdCIsInJlbW92ZSIsInVwZGF0ZUhvc3RzVGFibGVWaWV3IiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJpbml0aWFsaXplRm9ybSIsInVwZGF0ZVZpc2liaWxpdHlFbGVtZW50cyIsImNoYXJzIiwicGFzcyIsIngiLCJpIiwiZmxvb3IiLCJsZW5ndGgiLCJjaGFyQXQiLCJhdHRyIiwiY2xpcGJvYXJkIiwiQ2xpcGJvYXJkSlMiLCJwb3B1cCIsInNldFRpbWVvdXQiLCJjbGVhclNlbGVjdGlvbiIsImNvbnNvbGUiLCJlcnJvciIsImFjdGlvbiIsImVsSG9zdCIsImVsVXNlcm5hbWUiLCJlbFNlY3JldCIsImVsQWRkaXRpb25hbEhvc3QiLCJyZWdUeXBlIiwiZWxVbmlxSWQiLCJnZW5QYXNzd29yZCIsInZhbFVzZXJOYW1lIiwidmFsU2VjcmV0IiwicmVtb3ZlQXR0ciIsInNob3ciLCJoaWRlIiwidHJpbSIsImVsIiwiZnJvbVVzZXIiLCJ2YWx1ZSIsImZvcm0iLCJ2YWxpZGF0aW9uIiwibWF0Y2giLCJ0cmFuc2l0aW9uIiwiJHRyIiwibGFzdCIsIiRjbG9uZSIsImNsb25lIiwiZmluZCIsImh0bWwiLCJhZnRlciIsImR1bW15IiwicHJfTm9BbnlBZGRpdGlvbmFsSG9zdHMiLCJhcHBlbmQiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiYXJyQWRkaXRpb25hbEhvc3RzIiwiZWFjaCIsImluZGV4Iiwib2JqIiwicHVzaCIsImFkZHJlc3MiLCJhZGRpdGlvbmFsSG9zdHMiLCJKU09OIiwic3RyaW5naWZ5IiwiY2JBZnRlclNlbmRGb3JtIiwicmVzcG9uc2UiLCJGb3JtIiwiY2hlY2tIb3N0UHJvdmlkZXIiLCJlbmFibGUiLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZm4iLCJub3JlZ2lzdGVyIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSxRQUFRLEdBQUc7QUFFYjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxRQUFRLEVBQUVDLENBQUMsQ0FBQyxxQkFBRCxDQU5FOztBQVFiO0FBQ0o7QUFDQTtBQUNB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LFVBQVYsRUFBc0I5RixRQUF0QixFQUFnQztBQUNoRSxTQUFPLEVBQUVBLFFBQVEsQ0FBQ2dDLE1BQVQsS0FBb0IsQ0FBcEIsSUFBeUI4RCxVQUFVLEtBQUssSUFBMUMsQ0FBUDtBQUNILENBRkQ7QUFJQTtBQUNBO0FBQ0E7OztBQUNBdEgsQ0FBQyxDQUFDdUgsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUNwQjFILEVBQUFBLFFBQVEsQ0FBQytCLFVBQVQ7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGdsb2JhbFRyYW5zbGF0ZSwgRm9ybSwgJCwgQ2xpcGJvYXJkSlMgKi9cblxuXG4vKipcbiAqIE9iamVjdCBmb3IgaGFuZGxpbmcgcHJvdmlkZXIgbWFuYWdlbWVudCBmb3JtXG4gKlxuICogQG1vZHVsZSBwcm92aWRlclxuICovXG5jb25zdCBwcm92aWRlciA9IHtcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNzYXZlLXByb3ZpZGVyLWZvcm0nKSxcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBzZWNyZXQgZmllbGQuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkc2VjcmV0OiAkKCcjc2VjcmV0JyksXG5cbiAgICAvKipcbiAgICAgKiBEaXJ0eSBjaGVjayBmaWVsZCwgZm9yIGNoZWNraW5nIGlmIHNvbWV0aGluZyBvbiB0aGUgZm9ybSB3YXMgY2hhbmdlZFxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cblxuICAgIHByb3ZpZGVyVHlwZTogJCgnI3Byb3ZpZGVyVHlwZScpLnZhbCgpLFxuICAgICRjaGVja0JveGVzOiAkKCcjc2F2ZS1wcm92aWRlci1mb3JtIC5jaGVja2JveCcpLFxuICAgICRhY2NvcmRpb25zOiAkKCcjc2F2ZS1wcm92aWRlci1mb3JtIC51aS5hY2NvcmRpb24nKSxcbiAgICAkZHJvcERvd25zOiAkKCcjc2F2ZS1wcm92aWRlci1mb3JtIC51aS5kcm9wZG93bicpLFxuICAgICRkZWxldGVSb3dCdXR0b246ICQoJyNhZGRpdGlvbmFsLWhvc3RzLXRhYmxlIC5kZWxldGUtcm93LWJ1dHRvbicpLFxuICAgICRxdWFsaWZ5VG9nZ2xlOiAkKCcjcXVhbGlmeScpLFxuICAgICRxdWFsaWZ5RnJlcVRvZ2dsZTogJCgnI3F1YWxpZnktZnJlcScpLFxuICAgICRhZGRpdGlvbmFsSG9zdElucHV0OiAkKCcjYWRkaXRpb25hbC1ob3N0IGlucHV0JyksXG4gICAgaG9zdElucHV0VmFsaWRhdGlvbjogL14oKChbMC05XXxbMS05XVswLTldfDFbMC05XXsyfXwyWzAtNF1bMC05XXwyNVswLTVdKVxcLil7M30oWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkoXFwvKFxcZHxbMS0yXVxcZHwzWzAtMl0pKT98W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0oPzpcXC5bYS16QS1aXXsyLH0pKykkL2dtLFxuICAgIGhvc3RSb3c6ICcjc2F2ZS1wcm92aWRlci1mb3JtIC5ob3N0LXJvdycsXG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgZm9ybSBmaWVsZHMgYmVmb3JlIHN1Ym1pc3Npb24uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgICAqL1xuICAgIHZhbGlkYXRlUnVsZXM6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdkZXNjcmlwdGlvbicsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2VtcHR5JyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUucHJfVmFsaWRhdGlvblByb3ZpZGVyTmFtZUlzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIGhvc3Q6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdob3N0JyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tIb3N0UHJvdmlkZXInLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5wcl9WYWxpZGF0aW9uUHJvdmlkZXJIb3N0SXNFbXB0eSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAgdXNlcm5hbWU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICd1c2VybmFtZScsXG4gICAgICAgICAgICBvcHRpb25hbDogdHJ1ZSxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbWluTGVuZ3RoWzJdJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUucHJfVmFsaWRhdGlvblByb3ZpZGVyTG9naW5Ob3RTaW5nbGVTaW1ib2wsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHBvcnQ6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdwb3J0JyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW50ZWdlclsxLi42NTUzNV0nLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5wcl9WYWxpZGF0aW9uUHJvdmlkZXJQb3J0UmFuZ2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgdGhlIHByb3ZpZGVyIGZvcm0uXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgcHJvdmlkZXIuJGNoZWNrQm94ZXMuY2hlY2tib3goKTtcbiAgICAgICAgcHJvdmlkZXIuJGFjY29yZGlvbnMuYWNjb3JkaW9uKCk7XG4gICAgICAgIHByb3ZpZGVyLiRkcm9wRG93bnMuZHJvcGRvd24oKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIHF1YWxpZnkgdG9nZ2xlIGNoYW5nZXMuXG4gICAgICAgICAqL1xuICAgICAgICBwcm92aWRlci4kcXVhbGlmeVRvZ2dsZS5jaGVja2JveCh7XG4gICAgICAgICAgICBvbkNoYW5nZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJvdmlkZXIuJHF1YWxpZnlUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBwcm92aWRlci4kcXVhbGlmeUZyZXFUb2dnbGUucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIuJHF1YWxpZnlGcmVxVG9nZ2xlLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBuZXcgc3RyaW5nIHRvIGFkZGl0aW9uYWwtaG9zdHMtdGFibGUgdGFibGVcbiAgICAgICAgcHJvdmlkZXIuJGFkZGl0aW9uYWxIb3N0SW5wdXQua2V5cHJlc3MoKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMykge1xuICAgICAgICAgICAgICAgIHByb3ZpZGVyLmNiT25Db21wbGV0ZUhvc3RBZGRyZXNzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERlbGV0ZSBob3N0IGZyb20gYWRkaXRpb25hbC1ob3N0cy10YWJsZVxuICAgICAgICBwcm92aWRlci4kZGVsZXRlUm93QnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgcHJvdmlkZXIudXBkYXRlSG9zdHNUYWJsZVZpZXcoKTtcblxuICAgICAgICAgICAgLy8gQ2hhbmdlIHRoZSB2YWx1ZSBvZiAnJGRpcnJ0eUZpZWxkJyB0byB0cmlnZ2VyXG4gICAgICAgICAgICAvLyB0aGUgJ2NoYW5nZScgZm9ybSBldmVudCBhbmQgZW5hYmxlIHN1Ym1pdCBidXR0b24uXG4gICAgICAgICAgICBwcm92aWRlci4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuICAgICAgICAgICAgcHJvdmlkZXIuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBwcm92aWRlci5pbml0aWFsaXplRm9ybSgpO1xuXG4gICAgICAgIHByb3ZpZGVyLnVwZGF0ZVZpc2liaWxpdHlFbGVtZW50cygpO1xuXG4gICAgICAgICQoJyNyZWdpc3RyYXRpb25fdHlwZScpLm9uKCdjaGFuZ2UnLCBwcm92aWRlci51cGRhdGVWaXNpYmlsaXR5RWxlbWVudHMpO1xuXG4gICAgICAgICQoJyNkaXNhYmxlZnJvbXVzZXIgaW5wdXQnKS5vbignY2hhbmdlJywgcHJvdmlkZXIudXBkYXRlVmlzaWJpbGl0eUVsZW1lbnRzKTtcblxuICAgICAgICAkKCcjZ2VuZXJhdGUtbmV3LXBhc3N3b3JkJykub24oJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRXZlbnQgaGFuZGxlciBmb3IgdGhlIGdlbmVyYXRlIG5ldyBwYXNzd29yZCBidXR0b24gY2xpY2sgZXZlbnQuXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIC0gVGhlIGNsaWNrIGV2ZW50LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBjaGFycyA9ICdhYmNkZWYxMjM0NTY3ODkwJztcbiAgICAgICAgICAgIGxldCBwYXNzID0gJyc7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDMyOyB4ICs9IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBwYXNzICs9IGNoYXJzLmNoYXJBdChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3ZpZGVyLiRzZWNyZXQudmFsKHBhc3MpO1xuICAgICAgICAgICAgcHJvdmlkZXIuJHNlY3JldC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcHJvdmlkZXIuJHNlY3JldC5vbignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgJCgnI2VsU2VjcmV0IGEudWkuYnV0dG9uLmNsaXBib2FyZCcpLmF0dHIoJ2RhdGEtY2xpcGJvYXJkLXRleHQnLCBwcm92aWRlci4kc2VjcmV0LnZhbCgpKVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjbGlwYm9hcmQgPSBuZXcgQ2xpcGJvYXJkSlMoJy5jbGlwYm9hcmQnKTtcbiAgICAgICAgJCgnLmNsaXBib2FyZCcpLnBvcHVwKHtcbiAgICAgICAgICAgIG9uOiAnbWFudWFsJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2xpcGJvYXJkLm9uKCdzdWNjZXNzJywgKGUpID0+IHtcbiAgICAgICAgICAgICQoZS50cmlnZ2VyKS5wb3B1cCgnc2hvdycpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChlLnRyaWdnZXIpLnBvcHVwKCdoaWRlJyk7XG4gICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgICAgIGUuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2xpcGJvYXJkLm9uKCdlcnJvcicsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBY3Rpb246JywgZS5hY3Rpb24pO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVHJpZ2dlcjonLCBlLnRyaWdnZXIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIGVsZW1lbnRzIGJhc2VkIG9uIHRoZSBwcm92aWRlciB0eXBlIGFuZCByZWdpc3RyYXRpb24gdHlwZS5cbiAgICAgKi9cbiAgICB1cGRhdGVWaXNpYmlsaXR5RWxlbWVudHMoKSB7XG4gICAgICAgIGlmIChwcm92aWRlci5wcm92aWRlclR5cGUgIT09ICdTSVAnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgZWxlbWVudCByZWZlcmVuY2VzXG4gICAgICAgIGxldCBlbEhvc3QgPSAkKCcjZWxIb3N0Jyk7XG4gICAgICAgIGxldCBlbFVzZXJuYW1lID0gJCgnI2VsVXNlcm5hbWUnKTtcbiAgICAgICAgbGV0IGVsU2VjcmV0ID0gJCgnI2VsU2VjcmV0Jyk7XG4gICAgICAgIGxldCBlbEFkZGl0aW9uYWxIb3N0ID0gJCgnI2VsQWRkaXRpb25hbEhvc3RzJyk7XG4gICAgICAgIGxldCByZWdUeXBlID0gJCgnI3JlZ2lzdHJhdGlvbl90eXBlJykudmFsKCk7XG4gICAgICAgIGxldCBlbFVuaXFJZCA9ICQoJyN1bmlxaWQnKTtcbiAgICAgICAgbGV0IGdlblBhc3N3b3JkID0gJCgnI2dlbmVyYXRlLW5ldy1wYXNzd29yZCcpO1xuXG4gICAgICAgIGxldCB2YWxVc2VyTmFtZSA9ICQoJyN1c2VybmFtZScpO1xuICAgICAgICBsZXQgdmFsU2VjcmV0ID0gcHJvdmlkZXIuJHNlY3JldDtcblxuICAgICAgICAvLyBSZXNldCB1c2VybmFtZSBpZiBuZWNlc3NhcnlcbiAgICAgICAgaWYgKHZhbFVzZXJOYW1lLnZhbCgpID09PSBlbFVuaXFJZC52YWwoKSAmJiByZWdUeXBlICE9PSAnb3V0Ym91bmQnKSB7XG4gICAgICAgICAgICB2YWxVc2VyTmFtZS52YWwoJycpO1xuICAgICAgICB9XG4gICAgICAgIHZhbFVzZXJOYW1lLnJlbW92ZUF0dHIoJ3JlYWRvbmx5Jyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGVsZW1lbnQgdmlzaWJpbGl0eSBiYXNlZCBvbiByZWdpc3RyYXRpb24gdHlwZVxuICAgICAgICBpZiAocmVnVHlwZSA9PT0gJ291dGJvdW5kJykge1xuICAgICAgICAgICAgZWxIb3N0LnNob3coKTtcbiAgICAgICAgICAgIGVsVXNlcm5hbWUuc2hvdygpO1xuICAgICAgICAgICAgZWxTZWNyZXQuc2hvdygpO1xuICAgICAgICAgICAgZWxBZGRpdGlvbmFsSG9zdC5zaG93KCk7XG4gICAgICAgICAgICBnZW5QYXNzd29yZC5oaWRlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVnVHlwZSA9PT0gJ2luYm91bmQnKSB7XG4gICAgICAgICAgICB2YWxVc2VyTmFtZS52YWwoZWxVbmlxSWQudmFsKCkpO1xuICAgICAgICAgICAgdmFsVXNlck5hbWUuYXR0cigncmVhZG9ubHknLCAnJyk7XG4gICAgICAgICAgICBpZiAodmFsU2VjcmV0LnZhbCgpLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB2YWxTZWNyZXQudmFsKCdpZD0nICsgJCgnI2lkJykudmFsKCkgKyAnLScgKyBlbFVuaXFJZC52YWwoKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsSG9zdC5oaWRlKCk7XG4gICAgICAgICAgICBlbFVzZXJuYW1lLnNob3coKTtcbiAgICAgICAgICAgIGVsU2VjcmV0LnNob3coKTtcbiAgICAgICAgICAgIGdlblBhc3N3b3JkLnNob3coKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZWdUeXBlID09PSAnbm9uZScpIHtcbiAgICAgICAgICAgIGVsSG9zdC5zaG93KCk7XG4gICAgICAgICAgICBlbFVzZXJuYW1lLmhpZGUoKTtcbiAgICAgICAgICAgIGVsU2VjcmV0LmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBlbGVtZW50IHZpc2liaWxpdHkgYmFzZWQgb24gJ2Rpc2FibGVmcm9tdXNlcicgY2hlY2tib3hcbiAgICAgICAgbGV0IGVsID0gJCgnI2Rpc2FibGVmcm9tdXNlcicpO1xuICAgICAgICBsZXQgZnJvbVVzZXIgPSAkKCcjZGl2RnJvbVVzZXInKTtcbiAgICAgICAgaWYgKGVsLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcbiAgICAgICAgICAgIGZyb21Vc2VyLmhpZGUoKTtcbiAgICAgICAgICAgIGZyb21Vc2VyLnJlbW92ZUNsYXNzKCd2aXNpYmxlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmcm9tVXNlci5zaG93KCk7XG4gICAgICAgICAgICBmcm9tVXNlci5hZGRDbGFzcygndmlzaWJsZScpO1xuXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBjb21wbGV0aW5nIHRoZSBob3N0IGFkZHJlc3MgaW5wdXQuXG4gICAgICovXG4gICAgY2JPbkNvbXBsZXRlSG9zdEFkZHJlc3MoKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvdmlkZXIuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2FkZGl0aW9uYWwtaG9zdCcpO1xuXG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbHVlLm1hdGNoKHByb3ZpZGVyLmhvc3RJbnB1dFZhbGlkYXRpb24pO1xuXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgaW5wdXQgdmFsdWVcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uID09PSBudWxsXG4gICAgICAgICAgICAgICAgfHwgdmFsaWRhdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlci4kYWRkaXRpb25hbEhvc3RJbnB1dC50cmFuc2l0aW9uKCdzaGFrZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGhvc3QgYWRkcmVzcyBhbHJlYWR5IGV4aXN0c1xuICAgICAgICAgICAgaWYgKCQoYC5ob3N0LXJvd1tkYXRhLXZhbHVlPVwiJHt2YWx1ZX1cIl1gKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCAkdHIgPSAkKCcuaG9zdC1yb3ctdHBsJykubGFzdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0ICRjbG9uZSA9ICR0ci5jbG9uZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAkY2xvbmVcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdob3N0LXJvdy10cGwnKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2hvc3Qtcm93JylcbiAgICAgICAgICAgICAgICAgICAgLnNob3coKTtcbiAgICAgICAgICAgICAgICAkY2xvbmUuYXR0cignZGF0YS12YWx1ZScsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAkY2xvbmUuZmluZCgnLmFkZHJlc3MnKS5odG1sKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoJChwcm92aWRlci5ob3N0Um93KS5sYXN0KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ci5hZnRlcigkY2xvbmUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQocHJvdmlkZXIuaG9zdFJvdykubGFzdCgpLmFmdGVyKCRjbG9uZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb3ZpZGVyLnVwZGF0ZUhvc3RzVGFibGVWaWV3KCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdGhlIHZhbHVlIG9mICckZGlycnR5RmllbGQnIHRvIHRyaWdnZXJcbiAgICAgICAgICAgICAgICAvLyB0aGUgJ2NoYW5nZScgZm9ybSBldmVudCBhbmQgZW5hYmxlIHN1Ym1pdCBidXR0b24uXG4gICAgICAgICAgICAgICAgcHJvdmlkZXIuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcbiAgICAgICAgICAgICAgICBwcm92aWRlci4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcm92aWRlci4kYWRkaXRpb25hbEhvc3RJbnB1dC52YWwoJycpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGhvc3RzIHRhYmxlIHZpZXcgYmFzZWQgb24gdGhlIHByZXNlbmNlIG9mIGFkZGl0aW9uYWwgaG9zdHMgb3Igc2hvd3MgZHVtbXkgaWYgdGhlcmUgaXMgbm8gcmVjb3Jkc1xuICAgICAqL1xuICAgIHVwZGF0ZUhvc3RzVGFibGVWaWV3KCkge1xuICAgICAgICBjb25zdCBkdW1teSA9IGA8dHIgY2xhc3M9XCJkdW1teVwiPjx0ZCBjb2xzcGFuPVwiNFwiIGNsYXNzPVwiY2VudGVyIGFsaWduZWRcIj4ke2dsb2JhbFRyYW5zbGF0ZS5wcl9Ob0FueUFkZGl0aW9uYWxIb3N0c308L3RkPjwvdHI+YDtcblxuICAgICAgICBpZiAoJChwcm92aWRlci5ob3N0Um93KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICQoJyNhZGRpdGlvbmFsLWhvc3RzLXRhYmxlIHRib2R5JykuYXBwZW5kKGR1bW15KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJyNhZGRpdGlvbmFsLWhvc3RzLXRhYmxlIHRib2R5IC5kdW1teScpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGZvcm0gaXMgc2VudFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyAtIFRoZSBjdXJyZW50IHNldHRpbmdzIG9mIHRoZSBmb3JtXG4gICAgICogQHJldHVybnMge09iamVjdH0gLSBUaGUgdXBkYXRlZCBzZXR0aW5ncyBvZiB0aGUgZm9ybVxuICAgICAqL1xuICAgIGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG4gICAgICAgIHJlc3VsdC5kYXRhID0gcHJvdmlkZXIuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXG4gICAgICAgIGNvbnN0IGFyckFkZGl0aW9uYWxIb3N0cyA9IFtdO1xuICAgICAgICAkKHByb3ZpZGVyLmhvc3RSb3cpLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGlmICgkKG9iaikuYXR0cignZGF0YS12YWx1ZScpKSB7XG4gICAgICAgICAgICAgICAgYXJyQWRkaXRpb25hbEhvc3RzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiAkKG9iaikuYXR0cignZGF0YS12YWx1ZScpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmVzdWx0LmRhdGEuYWRkaXRpb25hbEhvc3RzID0gSlNPTi5zdHJpbmdpZnkoYXJyQWRkaXRpb25hbEhvc3RzKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGFmdGVyIHRoZSBmb3JtIGhhcyBiZWVuIHNlbnQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlIC0gVGhlIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciBhZnRlciB0aGUgZm9ybSBpcyBzZW50XG4gICAgICovXG4gICAgY2JBZnRlclNlbmRGb3JtKHJlc3BvbnNlKSB7XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgZm9ybSB3aXRoIGN1c3RvbSBzZXR0aW5nc1xuICAgICAqL1xuICAgIGluaXRpYWxpemVGb3JtKCkge1xuICAgICAgICBGb3JtLiRmb3JtT2JqID0gcHJvdmlkZXIuJGZvcm1PYmo7XG4gICAgICAgIEZvcm0uJGZvcm1PYmouZm9ybS5zZXR0aW5ncy5ydWxlcy5jaGVja0hvc3RQcm92aWRlciA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGVuYWJsZTtcbiAgICAgICAgICAgIGlmICgkKCcjcmVnaXN0cmF0aW9uX3R5cGUnKS52YWwoKSA9PT0gJ2luYm91bmQnKSB7XG4gICAgICAgICAgICAgICAgZW5hYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZW5hYmxlID0gdmFsdWUudHJpbSgpICE9PSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbmFibGU7XG4gICAgICAgIH07XG4gICAgICAgIHN3aXRjaCAocHJvdmlkZXIucHJvdmlkZXJUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdTSVAnOlxuICAgICAgICAgICAgICAgIEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1wcm92aWRlcnMvc2F2ZS9zaXBgOyAvLyBGb3JtIHN1Ym1pc3Npb24gVVJMXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdJQVgnOlxuICAgICAgICAgICAgICAgIEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1wcm92aWRlcnMvc2F2ZS9pYXhgOyAvLyBGb3JtIHN1Ym1pc3Npb24gVVJMXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBGb3JtLnZhbGlkYXRlUnVsZXMgPSBwcm92aWRlci52YWxpZGF0ZVJ1bGVzOyAvLyBGb3JtIHZhbGlkYXRpb24gcnVsZXNcbiAgICAgICAgRm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gcHJvdmlkZXIuY2JCZWZvcmVTZW5kRm9ybTsgLy8gQ2FsbGJhY2sgYmVmb3JlIGZvcm0gaXMgc2VudFxuICAgICAgICBGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IHByb3ZpZGVyLmNiQWZ0ZXJTZW5kRm9ybTsgLy8gQ2FsbGJhY2sgYWZ0ZXIgZm9ybSBpcyBzZW50XG4gICAgICAgIEZvcm0uaW5pdGlhbGl6ZSgpO1xuICAgIH0sXG59O1xuXG4vKipcbiAqIEN1c3RvbSBmb3JtIHZhbGlkYXRpb24gcnVsZSBmb3IgdXNlcm5hbWUuXG4gKiBAcGFyYW0ge3N0cmluZ30gbm9yZWdpc3RlciAtIFRoZSB2YWx1ZSBvZiB0aGUgJ25vcmVnaXN0ZXInIGF0dHJpYnV0ZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VybmFtZSAtIFRoZSB2YWx1ZSBvZiB0aGUgdXNlcm5hbWUgaW5wdXQgZmllbGQuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRoZSB2YWxpZGF0aW9uIHJ1bGUgcGFzc2VzIG9yIG5vdC5cbiAqL1xuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLnVzZXJuYW1lID0gZnVuY3Rpb24gKG5vcmVnaXN0ZXIsIHVzZXJuYW1lKSB7XG4gICAgcmV0dXJuICEodXNlcm5hbWUubGVuZ3RoID09PSAwICYmIG5vcmVnaXN0ZXIgIT09ICdvbicpO1xufTtcblxuLyoqXG4gKiAgSW5pdGlhbGl6ZSBwcm92aWRlciBtYW5hZ2VtZW50IGZvcm0gb24gZG9jdW1lbnQgcmVhZHlcbiAqL1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIHByb3ZpZGVyLmluaXRpYWxpemUoKTtcbn0pO1xuIl19