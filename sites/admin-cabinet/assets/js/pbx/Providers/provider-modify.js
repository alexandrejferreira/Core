"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate, Form, $, ClipboardJS */

/**
 * Object for handling provider management form
 *
 * @module provider
 */
var provider = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#save-provider-form'),

  /**
   * jQuery object for the secret field.
   * @type {jQuery}
   */
  $secret: $('#secret'),
  providerType: $('#providerType').val(),
  $checkBoxes: $('#save-provider-form .checkbox'),
  $accordions: $('#save-provider-form .ui.accordion'),
  $dropDowns: $('#save-provider-form .ui.dropdown'),
  $deleteRowButton: $('#additional-hosts-table .delete-row-button'),
  $qualifyToggle: $('#qualify'),
  $qualifyFreqToggle: $('#qualify-freq'),
  $additionalHostInput: $('#additional-host input'),
  hostInputValidation: /^((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(\d|[1-2]\d|3[0-2]))?|[a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+)$/gm,
  hostRow: '#save-provider-form .host-row',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    description: {
      identifier: 'description',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.pr_ValidationProviderNameIsEmpty
      }]
    },
    host: {
      identifier: 'host',
      rules: [{
        type: 'checkHostProvider',
        prompt: globalTranslate.pr_ValidationProviderHostIsEmpty
      }]
    },
    username: {
      identifier: 'username',
      optional: true,
      rules: [{
        type: 'minLength[2]',
        prompt: globalTranslate.pr_ValidationProviderLoginNotSingleSimbol
      }]
    },
    port: {
      identifier: 'port',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.pr_ValidationProviderPortRange
      }]
    }
  },

  /**
   * Initialize the provider form.
   */
  initialize: function initialize() {
    provider.$checkBoxes.checkbox();
    provider.$accordions.accordion();
    provider.$dropDowns.dropdown();
    /**
     * Callback function called when the qualify toggle changes.
     */

    provider.$qualifyToggle.checkbox({
      onChange: function onChange() {
        if (provider.$qualifyToggle.checkbox('is checked')) {
          provider.$qualifyFreqToggle.removeClass('disabled');
        } else {
          provider.$qualifyFreqToggle.addClass('disabled');
        }
      }
    }); // Add new string to additional-hosts-table table

    provider.$additionalHostInput.keypress(function (e) {
      if (e.which === 13) {
        provider.cbOnCompleteHostAddress();
      }
    }); // Delete host from additional-hosts-table

    provider.$deleteRowButton.on('click', function (e) {
      e.preventDefault();
      $(e.target).closest('tr').remove();
      provider.updateHostsTableView();
      Form.dataChanged();
      return false;
    });
    provider.initializeForm();
    provider.updateVisibilityElements();
    $('#registration_type').on('change', provider.updateVisibilityElements);
    $('#disablefromuser input').on('change', provider.updateVisibilityElements);
    $('#generate-new-password').on('click', function (e) {
      /**
       * Event handler for the generate new password button click event.
       * @param {Event} e - The click event.
       */
      e.preventDefault();
      var chars = 'abcdef1234567890';
      var pass = '';

      for (var x = 0; x < 32; x += 1) {
        var i = Math.floor(Math.random() * chars.length);
        pass += chars.charAt(i);
      }

      provider.$secret.val(pass);
      provider.$secret.trigger('change');
    });
    provider.$secret.on('change', function () {
      $('#elSecret a.ui.button.clipboard').attr('data-clipboard-text', provider.$secret.val());
    });
    var clipboard = new ClipboardJS('.clipboard');
    $('.clipboard').popup({
      on: 'manual'
    });
    clipboard.on('success', function (e) {
      $(e.trigger).popup('show');
      setTimeout(function () {
        $(e.trigger).popup('hide');
      }, 1500);
      e.clearSelection();
    });
    clipboard.on('error', function (e) {
      console.error('Action:', e.action);
      console.error('Trigger:', e.trigger);
    });
  },

  /**
   * Update the visibility of elements based on the provider type and registration type.
   */
  updateVisibilityElements: function updateVisibilityElements() {
    if (provider.providerType !== 'SIP') {
      return;
    } // Get element references


    var elHost = $('#elHost');
    var elUsername = $('#elUsername');
    var elSecret = $('#elSecret');
    var elAdditionalHost = $('#elAdditionalHosts');
    var regType = $('#registration_type').val();
    var elUniqId = $('#uniqid');
    var genPassword = $('#generate-new-password');
    var valUserName = $('#username');
    var valSecret = provider.$secret; // Reset username if necessary

    if (valUserName.val() === elUniqId.val() && regType !== 'outbound') {
      valUserName.val('');
    }

    valUserName.removeAttr('readonly'); // Update element visibility based on registration type

    if (regType === 'outbound') {
      elHost.show();
      elUsername.show();
      elSecret.show();
      elAdditionalHost.show();
      genPassword.hide();
    } else if (regType === 'inbound') {
      valUserName.val(elUniqId.val());
      valUserName.attr('readonly', '');

      if (valSecret.val().trim() === '') {
        valSecret.val('id=' + $('#id').val() + '-' + elUniqId.val());
      }

      elHost.hide();
      elUsername.show();
      elSecret.show();
      genPassword.show();
    } else if (regType === 'none') {
      elHost.show();
      elUsername.hide();
      elSecret.hide();
    } // Update element visibility based on 'disablefromuser' checkbox


    var el = $('#disablefromuser');
    var fromUser = $('#divFromUser');

    if (el.checkbox('is checked')) {
      fromUser.hide();
      fromUser.removeClass('visible');
    } else {
      fromUser.show();
      fromUser.addClass('visible');
    }
  },

  /**
   * Callback function when completing the host address input.
   */
  cbOnCompleteHostAddress: function cbOnCompleteHostAddress() {
    var value = provider.$formObj.form('get value', 'additional-host');

    if (value) {
      var validation = value.match(provider.hostInputValidation); // Validate the input value

      if (validation === null || validation.length === 0) {
        provider.$additionalHostInput.transition('shake');
        return;
      } // Check if the host address already exists


      if ($(".host-row[data-value=\"".concat(value, "\"]")).length === 0) {
        var $tr = $('.host-row-tpl').last();
        var $clone = $tr.clone(true);
        $clone.removeClass('host-row-tpl').addClass('host-row').show();
        $clone.attr('data-value', value);
        $clone.find('.address').html(value);

        if ($(provider.hostRow).last().length === 0) {
          $tr.after($clone);
        } else {
          $(provider.hostRow).last().after($clone);
        }

        provider.updateHostsTableView();
        Form.dataChanged();
      }

      provider.$additionalHostInput.val('');
    }
  },

  /**
   * Updates the hosts table view based on the presence of additional hosts or shows dummy if there is no records
   */
  updateHostsTableView: function updateHostsTableView() {
    var dummy = "<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">".concat(globalTranslate.pr_NoAnyAdditionalHosts, "</td></tr>");

    if ($(provider.hostRow).length === 0) {
      $('#additional-hosts-table tbody').append(dummy);
    } else {
      $('#additional-hosts-table tbody .dummy').remove();
    }
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = provider.$formObj.form('get values');
    var arrAdditionalHosts = [];
    $(provider.hostRow).each(function (index, obj) {
      if ($(obj).attr('data-value')) {
        arrAdditionalHosts.push({
          address: $(obj).attr('data-value')
        });
      }
    });
    result.data.additionalHosts = JSON.stringify(arrAdditionalHosts);
    return result;
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = provider.$formObj;

    Form.$formObj.form.settings.rules.checkHostProvider = function (value) {
      var enable;

      if ($('#registration_type').val() === 'inbound') {
        enable = true;
      } else {
        enable = value.trim() !== '';
      }

      return enable;
    };

    switch (provider.providerType) {
      case 'SIP':
        Form.url = "".concat(globalRootUrl, "providers/save/sip"); // Form submission URL

        break;

      case 'IAX':
        Form.url = "".concat(globalRootUrl, "providers/save/iax"); // Form submission URL

        break;

      default:
        return;
    }

    Form.validateRules = provider.validateRules; // Form validation rules

    Form.cbBeforeSendForm = provider.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = provider.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Custom form validation rule for username.
 * @param {string} noregister - The value of the 'noregister' attribute.
 * @param {string} username - The value of the username input field.
 * @returns {boolean} - Whether the validation rule passes or not.
 */

$.fn.form.settings.rules.username = function (noregister, username) {
  return !(username.length === 0 && noregister !== 'on');
};
/**
 *  Initialize provider management form on document ready
 */


$(document).ready(function () {
  provider.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qcm92aWRlcnMvcHJvdmlkZXItbW9kaWZ5LmpzIl0sIm5hbWVzIjpbInByb3ZpZGVyIiwiJGZvcm1PYmoiLCIkIiwiJHNlY3JldCIsInByb3ZpZGVyVHlwZSIsInZhbCIsIiRjaGVja0JveGVzIiwiJGFjY29yZGlvbnMiLCIkZHJvcERvd25zIiwiJGRlbGV0ZVJvd0J1dHRvbiIsIiRxdWFsaWZ5VG9nZ2xlIiwiJHF1YWxpZnlGcmVxVG9nZ2xlIiwiJGFkZGl0aW9uYWxIb3N0SW5wdXQiLCJob3N0SW5wdXRWYWxpZGF0aW9uIiwiaG9zdFJvdyIsInZhbGlkYXRlUnVsZXMiLCJkZXNjcmlwdGlvbiIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJOYW1lSXNFbXB0eSIsImhvc3QiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJIb3N0SXNFbXB0eSIsInVzZXJuYW1lIiwib3B0aW9uYWwiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJMb2dpbk5vdFNpbmdsZVNpbWJvbCIsInBvcnQiLCJwcl9WYWxpZGF0aW9uUHJvdmlkZXJQb3J0UmFuZ2UiLCJpbml0aWFsaXplIiwiY2hlY2tib3giLCJhY2NvcmRpb24iLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImtleXByZXNzIiwiZSIsIndoaWNoIiwiY2JPbkNvbXBsZXRlSG9zdEFkZHJlc3MiLCJvbiIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwiY2xvc2VzdCIsInJlbW92ZSIsInVwZGF0ZUhvc3RzVGFibGVWaWV3IiwiRm9ybSIsImRhdGFDaGFuZ2VkIiwiaW5pdGlhbGl6ZUZvcm0iLCJ1cGRhdGVWaXNpYmlsaXR5RWxlbWVudHMiLCJjaGFycyIsInBhc3MiLCJ4IiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImNoYXJBdCIsInRyaWdnZXIiLCJhdHRyIiwiY2xpcGJvYXJkIiwiQ2xpcGJvYXJkSlMiLCJwb3B1cCIsInNldFRpbWVvdXQiLCJjbGVhclNlbGVjdGlvbiIsImNvbnNvbGUiLCJlcnJvciIsImFjdGlvbiIsImVsSG9zdCIsImVsVXNlcm5hbWUiLCJlbFNlY3JldCIsImVsQWRkaXRpb25hbEhvc3QiLCJyZWdUeXBlIiwiZWxVbmlxSWQiLCJnZW5QYXNzd29yZCIsInZhbFVzZXJOYW1lIiwidmFsU2VjcmV0IiwicmVtb3ZlQXR0ciIsInNob3ciLCJoaWRlIiwidHJpbSIsImVsIiwiZnJvbVVzZXIiLCJ2YWx1ZSIsImZvcm0iLCJ2YWxpZGF0aW9uIiwibWF0Y2giLCJ0cmFuc2l0aW9uIiwiJHRyIiwibGFzdCIsIiRjbG9uZSIsImNsb25lIiwiZmluZCIsImh0bWwiLCJhZnRlciIsImR1bW15IiwicHJfTm9BbnlBZGRpdGlvbmFsSG9zdHMiLCJhcHBlbmQiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiYXJyQWRkaXRpb25hbEhvc3RzIiwiZWFjaCIsImluZGV4Iiwib2JqIiwicHVzaCIsImFkZHJlc3MiLCJhZGRpdGlvbmFsSG9zdHMiLCJKU09OIiwic3RyaW5naWZ5IiwiY2JBZnRlclNlbmRGb3JtIiwicmVzcG9uc2UiLCJjaGVja0hvc3RQcm92aWRlciIsImVuYWJsZSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJmbiIsIm5vcmVnaXN0ZXIiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQU1BLFFBQVEsR0FBRztBQUViO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFFBQVEsRUFBRUMsQ0FBQyxDQUFDLHFCQUFELENBTkU7O0FBUWI7QUFDSjtBQUNBO0FBQ0E7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QUFDRCxhQUFPa0MsTUFBUDtBQUNILEtBUkQ7O0FBU0EsWUFBUXBILFFBQVEsQ0FBQ0ksWUFBakI7QUFDSSxXQUFLLEtBQUw7QUFDSTJDLFFBQUFBLElBQUksQ0FBQ3NFLEdBQUwsYUFBY0MsYUFBZCx3QkFESixDQUNxRDs7QUFDakQ7O0FBQ0osV0FBSyxLQUFMO0FBQ0l2RSxRQUFBQSxJQUFJLENBQUNzRSxHQUFMLGFBQWNDLGFBQWQsd0JBREosQ0FDcUQ7O0FBQ2pEOztBQUNKO0FBQ0k7QUFSUjs7QUFVQXZFLElBQUFBLElBQUksQ0FBQ2hDLGFBQUwsR0FBcUJmLFFBQVEsQ0FBQ2UsYUFBOUIsQ0FyQmEsQ0FxQmdDOztBQUM3Q2dDLElBQUFBLElBQUksQ0FBQ3FELGdCQUFMLEdBQXdCcEcsUUFBUSxDQUFDb0csZ0JBQWpDLENBdEJhLENBc0JzQzs7QUFDbkRyRCxJQUFBQSxJQUFJLENBQUNrRSxlQUFMLEdBQXVCakgsUUFBUSxDQUFDaUgsZUFBaEMsQ0F2QmEsQ0F1Qm9DOztBQUNqRGxFLElBQUFBLElBQUksQ0FBQ2pCLFVBQUw7QUFDSDtBQW5VWSxDQUFqQjtBQXNVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E1QixDQUFDLENBQUNxSCxFQUFGLENBQUtqQyxJQUFMLENBQVVlLFFBQVYsQ0FBbUJuRixLQUFuQixDQUF5Qk8sUUFBekIsR0FBb0MsVUFBVStGLFVBQVYsRUFBc0IvRixRQUF0QixFQUFnQztBQUNoRSxTQUFPLEVBQUVBLFFBQVEsQ0FBQ2lDLE1BQVQsS0FBb0IsQ0FBcEIsSUFBeUI4RCxVQUFVLEtBQUssSUFBMUMsQ0FBUDtBQUNILENBRkQ7QUFJQTtBQUNBO0FBQ0E7OztBQUNBdEgsQ0FBQyxDQUFDdUgsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUNwQjFILEVBQUFBLFFBQVEsQ0FBQzhCLFVBQVQ7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGdsb2JhbFRyYW5zbGF0ZSwgRm9ybSwgJCwgQ2xpcGJvYXJkSlMgKi9cblxuXG4vKipcbiAqIE9iamVjdCBmb3IgaGFuZGxpbmcgcHJvdmlkZXIgbWFuYWdlbWVudCBmb3JtXG4gKlxuICogQG1vZHVsZSBwcm92aWRlclxuICovXG5jb25zdCBwcm92aWRlciA9IHtcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNzYXZlLXByb3ZpZGVyLWZvcm0nKSxcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBzZWNyZXQgZmllbGQuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkc2VjcmV0OiAkKCcjc2VjcmV0JyksXG5cbiAgICBwcm92aWRlclR5cGU6ICQoJyNwcm92aWRlclR5cGUnKS52YWwoKSxcbiAgICAkY2hlY2tCb3hlczogJCgnI3NhdmUtcHJvdmlkZXItZm9ybSAuY2hlY2tib3gnKSxcbiAgICAkYWNjb3JkaW9uczogJCgnI3NhdmUtcHJvdmlkZXItZm9ybSAudWkuYWNjb3JkaW9uJyksXG4gICAgJGRyb3BEb3duczogJCgnI3NhdmUtcHJvdmlkZXItZm9ybSAudWkuZHJvcGRvd24nKSxcbiAgICAkZGVsZXRlUm93QnV0dG9uOiAkKCcjYWRkaXRpb25hbC1ob3N0cy10YWJsZSAuZGVsZXRlLXJvdy1idXR0b24nKSxcbiAgICAkcXVhbGlmeVRvZ2dsZTogJCgnI3F1YWxpZnknKSxcbiAgICAkcXVhbGlmeUZyZXFUb2dnbGU6ICQoJyNxdWFsaWZ5LWZyZXEnKSxcbiAgICAkYWRkaXRpb25hbEhvc3RJbnB1dDogJCgnI2FkZGl0aW9uYWwtaG9zdCBpbnB1dCcpLFxuICAgIGhvc3RJbnB1dFZhbGlkYXRpb246IC9eKCgoWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSlcXC4pezN9KFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pKFxcLyhcXGR8WzEtMl1cXGR8M1swLTJdKSk/fFthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKD86XFwuW2EtekEtWl17Mix9KSspJC9nbSxcbiAgICBob3N0Um93OiAnI3NhdmUtcHJvdmlkZXItZm9ybSAuaG9zdC1yb3cnLFxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0gZmllbGRzIGJlZm9yZSBzdWJtaXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVJ1bGVzOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAnZGVzY3JpcHRpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLnByX1ZhbGlkYXRpb25Qcm92aWRlck5hbWVJc0VtcHR5LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBob3N0OiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAnaG9zdCcsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrSG9zdFByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUucHJfVmFsaWRhdGlvblByb3ZpZGVySG9zdElzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXJuYW1lOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAndXNlcm5hbWUnLFxuICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21pbkxlbmd0aFsyXScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLnByX1ZhbGlkYXRpb25Qcm92aWRlckxvZ2luTm90U2luZ2xlU2ltYm9sLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBwb3J0OiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAncG9ydCcsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVnZXJbMS4uNjU1MzVdJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUucHJfVmFsaWRhdGlvblByb3ZpZGVyUG9ydFJhbmdlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBwcm92aWRlciBmb3JtLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIHByb3ZpZGVyLiRjaGVja0JveGVzLmNoZWNrYm94KCk7XG4gICAgICAgIHByb3ZpZGVyLiRhY2NvcmRpb25zLmFjY29yZGlvbigpO1xuICAgICAgICBwcm92aWRlci4kZHJvcERvd25zLmRyb3Bkb3duKCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSBxdWFsaWZ5IHRvZ2dsZSBjaGFuZ2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgcHJvdmlkZXIuJHF1YWxpZnlUb2dnbGUuY2hlY2tib3goe1xuICAgICAgICAgICAgb25DaGFuZ2UoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb3ZpZGVyLiRxdWFsaWZ5VG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIuJHF1YWxpZnlGcmVxVG9nZ2xlLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyLiRxdWFsaWZ5RnJlcVRvZ2dsZS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgbmV3IHN0cmluZyB0byBhZGRpdGlvbmFsLWhvc3RzLXRhYmxlIHRhYmxlXG4gICAgICAgIHByb3ZpZGVyLiRhZGRpdGlvbmFsSG9zdElucHV0LmtleXByZXNzKChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlci5jYk9uQ29tcGxldGVIb3N0QWRkcmVzcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBEZWxldGUgaG9zdCBmcm9tIGFkZGl0aW9uYWwtaG9zdHMtdGFibGVcbiAgICAgICAgcHJvdmlkZXIuJGRlbGV0ZVJvd0J1dHRvbi5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHByb3ZpZGVyLnVwZGF0ZUhvc3RzVGFibGVWaWV3KCk7XG4gICAgICAgICAgICBGb3JtLmRhdGFDaGFuZ2VkKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBwcm92aWRlci5pbml0aWFsaXplRm9ybSgpO1xuXG4gICAgICAgIHByb3ZpZGVyLnVwZGF0ZVZpc2liaWxpdHlFbGVtZW50cygpO1xuXG4gICAgICAgICQoJyNyZWdpc3RyYXRpb25fdHlwZScpLm9uKCdjaGFuZ2UnLCBwcm92aWRlci51cGRhdGVWaXNpYmlsaXR5RWxlbWVudHMpO1xuXG4gICAgICAgICQoJyNkaXNhYmxlZnJvbXVzZXIgaW5wdXQnKS5vbignY2hhbmdlJywgcHJvdmlkZXIudXBkYXRlVmlzaWJpbGl0eUVsZW1lbnRzKTtcblxuICAgICAgICAkKCcjZ2VuZXJhdGUtbmV3LXBhc3N3b3JkJykub24oJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRXZlbnQgaGFuZGxlciBmb3IgdGhlIGdlbmVyYXRlIG5ldyBwYXNzd29yZCBidXR0b24gY2xpY2sgZXZlbnQuXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIC0gVGhlIGNsaWNrIGV2ZW50LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBjaGFycyA9ICdhYmNkZWYxMjM0NTY3ODkwJztcbiAgICAgICAgICAgIGxldCBwYXNzID0gJyc7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDMyOyB4ICs9IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBwYXNzICs9IGNoYXJzLmNoYXJBdChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3ZpZGVyLiRzZWNyZXQudmFsKHBhc3MpO1xuICAgICAgICAgICAgcHJvdmlkZXIuJHNlY3JldC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcHJvdmlkZXIuJHNlY3JldC5vbignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgJCgnI2VsU2VjcmV0IGEudWkuYnV0dG9uLmNsaXBib2FyZCcpLmF0dHIoJ2RhdGEtY2xpcGJvYXJkLXRleHQnLCBwcm92aWRlci4kc2VjcmV0LnZhbCgpKVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjbGlwYm9hcmQgPSBuZXcgQ2xpcGJvYXJkSlMoJy5jbGlwYm9hcmQnKTtcbiAgICAgICAgJCgnLmNsaXBib2FyZCcpLnBvcHVwKHtcbiAgICAgICAgICAgIG9uOiAnbWFudWFsJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2xpcGJvYXJkLm9uKCdzdWNjZXNzJywgKGUpID0+IHtcbiAgICAgICAgICAgICQoZS50cmlnZ2VyKS5wb3B1cCgnc2hvdycpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChlLnRyaWdnZXIpLnBvcHVwKCdoaWRlJyk7XG4gICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgICAgIGUuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2xpcGJvYXJkLm9uKCdlcnJvcicsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBY3Rpb246JywgZS5hY3Rpb24pO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVHJpZ2dlcjonLCBlLnRyaWdnZXIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIGVsZW1lbnRzIGJhc2VkIG9uIHRoZSBwcm92aWRlciB0eXBlIGFuZCByZWdpc3RyYXRpb24gdHlwZS5cbiAgICAgKi9cbiAgICB1cGRhdGVWaXNpYmlsaXR5RWxlbWVudHMoKSB7XG4gICAgICAgIGlmIChwcm92aWRlci5wcm92aWRlclR5cGUgIT09ICdTSVAnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgZWxlbWVudCByZWZlcmVuY2VzXG4gICAgICAgIGxldCBlbEhvc3QgPSAkKCcjZWxIb3N0Jyk7XG4gICAgICAgIGxldCBlbFVzZXJuYW1lID0gJCgnI2VsVXNlcm5hbWUnKTtcbiAgICAgICAgbGV0IGVsU2VjcmV0ID0gJCgnI2VsU2VjcmV0Jyk7XG4gICAgICAgIGxldCBlbEFkZGl0aW9uYWxIb3N0ID0gJCgnI2VsQWRkaXRpb25hbEhvc3RzJyk7XG4gICAgICAgIGxldCByZWdUeXBlID0gJCgnI3JlZ2lzdHJhdGlvbl90eXBlJykudmFsKCk7XG4gICAgICAgIGxldCBlbFVuaXFJZCA9ICQoJyN1bmlxaWQnKTtcbiAgICAgICAgbGV0IGdlblBhc3N3b3JkID0gJCgnI2dlbmVyYXRlLW5ldy1wYXNzd29yZCcpO1xuXG4gICAgICAgIGxldCB2YWxVc2VyTmFtZSA9ICQoJyN1c2VybmFtZScpO1xuICAgICAgICBsZXQgdmFsU2VjcmV0ID0gcHJvdmlkZXIuJHNlY3JldDtcblxuICAgICAgICAvLyBSZXNldCB1c2VybmFtZSBpZiBuZWNlc3NhcnlcbiAgICAgICAgaWYgKHZhbFVzZXJOYW1lLnZhbCgpID09PSBlbFVuaXFJZC52YWwoKSAmJiByZWdUeXBlICE9PSAnb3V0Ym91bmQnKSB7XG4gICAgICAgICAgICB2YWxVc2VyTmFtZS52YWwoJycpO1xuICAgICAgICB9XG4gICAgICAgIHZhbFVzZXJOYW1lLnJlbW92ZUF0dHIoJ3JlYWRvbmx5Jyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGVsZW1lbnQgdmlzaWJpbGl0eSBiYXNlZCBvbiByZWdpc3RyYXRpb24gdHlwZVxuICAgICAgICBpZiAocmVnVHlwZSA9PT0gJ291dGJvdW5kJykge1xuICAgICAgICAgICAgZWxIb3N0LnNob3coKTtcbiAgICAgICAgICAgIGVsVXNlcm5hbWUuc2hvdygpO1xuICAgICAgICAgICAgZWxTZWNyZXQuc2hvdygpO1xuICAgICAgICAgICAgZWxBZGRpdGlvbmFsSG9zdC5zaG93KCk7XG4gICAgICAgICAgICBnZW5QYXNzd29yZC5oaWRlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVnVHlwZSA9PT0gJ2luYm91bmQnKSB7XG4gICAgICAgICAgICB2YWxVc2VyTmFtZS52YWwoZWxVbmlxSWQudmFsKCkpO1xuICAgICAgICAgICAgdmFsVXNlck5hbWUuYXR0cigncmVhZG9ubHknLCAnJyk7XG4gICAgICAgICAgICBpZiAodmFsU2VjcmV0LnZhbCgpLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB2YWxTZWNyZXQudmFsKCdpZD0nICsgJCgnI2lkJykudmFsKCkgKyAnLScgKyBlbFVuaXFJZC52YWwoKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsSG9zdC5oaWRlKCk7XG4gICAgICAgICAgICBlbFVzZXJuYW1lLnNob3coKTtcbiAgICAgICAgICAgIGVsU2VjcmV0LnNob3coKTtcbiAgICAgICAgICAgIGdlblBhc3N3b3JkLnNob3coKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZWdUeXBlID09PSAnbm9uZScpIHtcbiAgICAgICAgICAgIGVsSG9zdC5zaG93KCk7XG4gICAgICAgICAgICBlbFVzZXJuYW1lLmhpZGUoKTtcbiAgICAgICAgICAgIGVsU2VjcmV0LmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBlbGVtZW50IHZpc2liaWxpdHkgYmFzZWQgb24gJ2Rpc2FibGVmcm9tdXNlcicgY2hlY2tib3hcbiAgICAgICAgbGV0IGVsID0gJCgnI2Rpc2FibGVmcm9tdXNlcicpO1xuICAgICAgICBsZXQgZnJvbVVzZXIgPSAkKCcjZGl2RnJvbVVzZXInKTtcbiAgICAgICAgaWYgKGVsLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcbiAgICAgICAgICAgIGZyb21Vc2VyLmhpZGUoKTtcbiAgICAgICAgICAgIGZyb21Vc2VyLnJlbW92ZUNsYXNzKCd2aXNpYmxlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmcm9tVXNlci5zaG93KCk7XG4gICAgICAgICAgICBmcm9tVXNlci5hZGRDbGFzcygndmlzaWJsZScpO1xuXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBjb21wbGV0aW5nIHRoZSBob3N0IGFkZHJlc3MgaW5wdXQuXG4gICAgICovXG4gICAgY2JPbkNvbXBsZXRlSG9zdEFkZHJlc3MoKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvdmlkZXIuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2FkZGl0aW9uYWwtaG9zdCcpO1xuXG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbHVlLm1hdGNoKHByb3ZpZGVyLmhvc3RJbnB1dFZhbGlkYXRpb24pO1xuXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgaW5wdXQgdmFsdWVcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uID09PSBudWxsXG4gICAgICAgICAgICAgICAgfHwgdmFsaWRhdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlci4kYWRkaXRpb25hbEhvc3RJbnB1dC50cmFuc2l0aW9uKCdzaGFrZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGhvc3QgYWRkcmVzcyBhbHJlYWR5IGV4aXN0c1xuICAgICAgICAgICAgaWYgKCQoYC5ob3N0LXJvd1tkYXRhLXZhbHVlPVwiJHt2YWx1ZX1cIl1gKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCAkdHIgPSAkKCcuaG9zdC1yb3ctdHBsJykubGFzdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0ICRjbG9uZSA9ICR0ci5jbG9uZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAkY2xvbmVcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdob3N0LXJvdy10cGwnKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2hvc3Qtcm93JylcbiAgICAgICAgICAgICAgICAgICAgLnNob3coKTtcbiAgICAgICAgICAgICAgICAkY2xvbmUuYXR0cignZGF0YS12YWx1ZScsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAkY2xvbmUuZmluZCgnLmFkZHJlc3MnKS5odG1sKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoJChwcm92aWRlci5ob3N0Um93KS5sYXN0KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ci5hZnRlcigkY2xvbmUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQocHJvdmlkZXIuaG9zdFJvdykubGFzdCgpLmFmdGVyKCRjbG9uZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb3ZpZGVyLnVwZGF0ZUhvc3RzVGFibGVWaWV3KCk7XG4gICAgICAgICAgICAgICAgRm9ybS5kYXRhQ2hhbmdlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJvdmlkZXIuJGFkZGl0aW9uYWxIb3N0SW5wdXQudmFsKCcnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBob3N0cyB0YWJsZSB2aWV3IGJhc2VkIG9uIHRoZSBwcmVzZW5jZSBvZiBhZGRpdGlvbmFsIGhvc3RzIG9yIHNob3dzIGR1bW15IGlmIHRoZXJlIGlzIG5vIHJlY29yZHNcbiAgICAgKi9cbiAgICB1cGRhdGVIb3N0c1RhYmxlVmlldygpIHtcbiAgICAgICAgY29uc3QgZHVtbXkgPSBgPHRyIGNsYXNzPVwiZHVtbXlcIj48dGQgY29sc3Bhbj1cIjRcIiBjbGFzcz1cImNlbnRlciBhbGlnbmVkXCI+JHtnbG9iYWxUcmFuc2xhdGUucHJfTm9BbnlBZGRpdGlvbmFsSG9zdHN9PC90ZD48L3RyPmA7XG5cbiAgICAgICAgaWYgKCQocHJvdmlkZXIuaG9zdFJvdykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAkKCcjYWRkaXRpb25hbC1ob3N0cy10YWJsZSB0Ym9keScpLmFwcGVuZChkdW1teSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjYWRkaXRpb25hbC1ob3N0cy10YWJsZSB0Ym9keSAuZHVtbXknKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgYmVmb3JlIHRoZSBmb3JtIGlzIHNlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgLSBUaGUgY3VycmVudCBzZXR0aW5ncyBvZiB0aGUgZm9ybVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IC0gVGhlIHVwZGF0ZWQgc2V0dGluZ3Mgb2YgdGhlIGZvcm1cbiAgICAgKi9cbiAgICBjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuICAgICAgICByZXN1bHQuZGF0YSA9IHByb3ZpZGVyLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblxuICAgICAgICBjb25zdCBhcnJBZGRpdGlvbmFsSG9zdHMgPSBbXTtcbiAgICAgICAgJChwcm92aWRlci5ob3N0Um93KS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAoJChvYmopLmF0dHIoJ2RhdGEtdmFsdWUnKSkge1xuICAgICAgICAgICAgICAgIGFyckFkZGl0aW9uYWxIb3N0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogJChvYmopLmF0dHIoJ2RhdGEtdmFsdWUnKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlc3VsdC5kYXRhLmFkZGl0aW9uYWxIb3N0cyA9IEpTT04uc3RyaW5naWZ5KGFyckFkZGl0aW9uYWxIb3N0cyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBhZnRlciB0aGUgZm9ybSBoYXMgYmVlbiBzZW50LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgYWZ0ZXIgdGhlIGZvcm0gaXMgc2VudFxuICAgICAqL1xuICAgIGNiQWZ0ZXJTZW5kRm9ybShyZXNwb25zZSkge1xuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgdGhlIGZvcm0gd2l0aCBjdXN0b20gc2V0dGluZ3NcbiAgICAgKi9cbiAgICBpbml0aWFsaXplRm9ybSgpIHtcbiAgICAgICAgRm9ybS4kZm9ybU9iaiA9IHByb3ZpZGVyLiRmb3JtT2JqO1xuICAgICAgICBGb3JtLiRmb3JtT2JqLmZvcm0uc2V0dGluZ3MucnVsZXMuY2hlY2tIb3N0UHJvdmlkZXIgPSAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGxldCBlbmFibGU7XG4gICAgICAgICAgICBpZiAoJCgnI3JlZ2lzdHJhdGlvbl90eXBlJykudmFsKCkgPT09ICdpbmJvdW5kJykge1xuICAgICAgICAgICAgICAgIGVuYWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVuYWJsZSA9IHZhbHVlLnRyaW0oKSAhPT0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZW5hYmxlO1xuICAgICAgICB9O1xuICAgICAgICBzd2l0Y2ggKHByb3ZpZGVyLnByb3ZpZGVyVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnU0lQJzpcbiAgICAgICAgICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9cHJvdmlkZXJzL3NhdmUvc2lwYDsgLy8gRm9ybSBzdWJtaXNzaW9uIFVSTFxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnSUFYJzpcbiAgICAgICAgICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9cHJvdmlkZXJzL3NhdmUvaWF4YDsgLy8gRm9ybSBzdWJtaXNzaW9uIFVSTFxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgRm9ybS52YWxpZGF0ZVJ1bGVzID0gcHJvdmlkZXIudmFsaWRhdGVSdWxlczsgLy8gRm9ybSB2YWxpZGF0aW9uIHJ1bGVzXG4gICAgICAgIEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IHByb3ZpZGVyLmNiQmVmb3JlU2VuZEZvcm07IC8vIENhbGxiYWNrIGJlZm9yZSBmb3JtIGlzIHNlbnRcbiAgICAgICAgRm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBwcm92aWRlci5jYkFmdGVyU2VuZEZvcm07IC8vIENhbGxiYWNrIGFmdGVyIGZvcm0gaXMgc2VudFxuICAgICAgICBGb3JtLmluaXRpYWxpemUoKTtcbiAgICB9LFxufTtcblxuLyoqXG4gKiBDdXN0b20gZm9ybSB2YWxpZGF0aW9uIHJ1bGUgZm9yIHVzZXJuYW1lLlxuICogQHBhcmFtIHtzdHJpbmd9IG5vcmVnaXN0ZXIgLSBUaGUgdmFsdWUgb2YgdGhlICdub3JlZ2lzdGVyJyBhdHRyaWJ1dGUuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXNlcm5hbWUgLSBUaGUgdmFsdWUgb2YgdGhlIHVzZXJuYW1lIGlucHV0IGZpZWxkLlxuICogQHJldHVybnMge2Jvb2xlYW59IC0gV2hldGhlciB0aGUgdmFsaWRhdGlvbiBydWxlIHBhc3NlcyBvciBub3QuXG4gKi9cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy51c2VybmFtZSA9IGZ1bmN0aW9uIChub3JlZ2lzdGVyLCB1c2VybmFtZSkge1xuICAgIHJldHVybiAhKHVzZXJuYW1lLmxlbmd0aCA9PT0gMCAmJiBub3JlZ2lzdGVyICE9PSAnb24nKTtcbn07XG5cbi8qKlxuICogIEluaXRpYWxpemUgcHJvdmlkZXIgbWFuYWdlbWVudCBmb3JtIG9uIGRvY3VtZW50IHJlYWR5XG4gKi9cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBwcm92aWRlci5pbml0aWFsaXplKCk7XG59KTtcbiJdfQ==