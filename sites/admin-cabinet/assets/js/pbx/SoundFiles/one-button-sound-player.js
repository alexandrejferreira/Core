"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl */
var sndPlayerOneBtn = {
  slider: undefined,
  // audio player
  $pButton: $('.action-playback-button'),
  // play button
  soundSelectorClass: $('.action-playback-button').attr('data-value'),
  duration: 0,
  initialize: function initialize() {
    var audioPlayer = '<audio id="audio-player" preload="auto"><source src="" type="audio/mp3"></audio>';
    sndPlayerOneBtn.$pButton.after(audioPlayer);
    sndPlayerOneBtn.slider = document.getElementById('audio-player');
    $("#".concat(sndPlayerOneBtn.soundSelectorClass)).on('change', function () {
      sndPlayerOneBtn.updateAudioSource();
    });
    sndPlayerOneBtn.$pButton.on('click', function (e) {
      e.preventDefault();

      if (sndPlayerOneBtn.slider.paused && sndPlayerOneBtn.slider.duration) {
        sndPlayerOneBtn.slider.play(); // remove play, add pause

        sndPlayerOneBtn.$pButton.html('<i class="icon pause"></i>');
      } else {
        // pause music
        sndPlayerOneBtn.slider.pause(); // remove pause, add play

        sndPlayerOneBtn.$pButton.html('<i class="icon play"></i>');
      }
    });
    sndPlayerOneBtn.updateAudioSource();
  },
  updateAudioSource: function updateAudioSource() {
    var audioFileId = $('form').form('get value', sndPlayerOneBtn.soundSelectorClass);

    if (audioFileId !== '' && audioFileId !== "-1") {
      $.api({
        url: "".concat(globalRootUrl, "sound-files/getpathbyid/").concat(audioFileId),
        on: 'now',
        onSuccess: function onSuccess(response) {
          sndPlayerOneBtn.cbAfterResponse(response);
        },
        onError: function onError() {}
      });
    }
  },
  cbAfterResponse: function cbAfterResponse(response) {
    if (response.message !== undefined) {
      sndPlayerOneBtn.slider.getElementsByTagName('source')[0].src = "/pbxcore/api/cdr/playback?view=".concat(response.message);
      sndPlayerOneBtn.slider.pause();
      sndPlayerOneBtn.slider.load();
      sndPlayerOneBtn.slider.oncanplaythrough = sndPlayerOneBtn.cbCanPlayThrough;
    }
  },
  cbCanPlayThrough: function cbCanPlayThrough() {
    sndPlayerOneBtn.duration = sndPlayerOneBtn.slider.duration;

    if (sndPlayerOneBtn.$pButton.html() === '<i class="icon pause"></i>') {
      sndPlayerOneBtn.slider.play();
    }
  },
  cbOnSliderChange: function cbOnSliderChange(newVal, meta) {
    if (meta.triggeredByUser && Number.isFinite(sndPlayerOneBtn.slider.duration)) {
      sndPlayerOneBtn.slider.removeEventListener('timeupdate', sndPlayerOneBtn.cbTimeUpdate, false);
      sndPlayerOneBtn.slider.currentTime = sndPlayerOneBtn.slider.duration * newVal / 100;
      sndPlayerOneBtn.slider.addEventListener('timeupdate', sndPlayerOneBtn.cbTimeUpdate, false);
    }
  },
  cbTimeUpdate: function cbTimeUpdate() {
    if (Number.isFinite(sndPlayerOneBtn.slider.duration)) {
      var percent = sndPlayerOneBtn.slider.currentTime / sndPlayerOneBtn.slider.duration;
      var rangePosition = Math.round(percent * 100);
      sndPlayerOneBtn.$slider.range('set value', rangePosition);

      if (sndPlayerOneBtn.slider.currentTime === sndPlayerOneBtn.duration) {
        sndPlayerOneBtn.$pButton.html('<i class="icon play"></i>');
      }
    }
  }
};
$(document).ready(function () {
  sndPlayerOneBtn.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Tb3VuZEZpbGVzL29uZS1idXR0b24tc291bmQtcGxheWVyLmpzIl0sIm5hbWVzIjpbInNuZFBsYXllck9uZUJ0biIsInNsaWRlciIsInVuZGVmaW5lZCIsIiRwQnV0dG9uIiwiJCIsInNvdW5kU2VsZWN0b3JDbGFzcyIsImF0dHIiLCJkdXJhdGlvbiIsImluaXRpYWxpemUiLCJhdWRpb1BsYXllciIsImFmdGVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIm9uIiwidXBkYXRlQXVkaW9Tb3VyY2UiLCJlIiwicHJldmVudERlZmF1bHQiLCJwYXVzZWQiLCJwbGF5IiwiaHRtbCIsInBhdXNlIiwiYXVkaW9GaWxlSWQiLCJmb3JtIiwiYXBpIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsIm9uU3VjY2VzcyIsInJlc3BvbnNlIiwiY2JBZnRlclJlc3BvbnNlIiwib25FcnJvciIsIm1lc3NhZ2UiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInNyYyIsImxvYWQiLCJvbmNhbnBsYXl0aHJvdWdoIiwiY2JDYW5QbGF5VGhyb3VnaCIsImNiT25TbGlkZXJDaGFuZ2UiLCJuZXdWYWwiLCJtZXRhIiwidHJpZ2dlcmVkQnlVc2VyIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2JUaW1lVXBkYXRlIiwiY3VycmVudFRpbWUiLCJhZGRFdmVudExpc3RlbmVyIiwicGVyY2VudCIsInJhbmdlUG9zaXRpb24iLCJNYXRoIiwicm91bmQiLCIkc2xpZGVyIiwicmFuZ2UiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUEsSUFBTUEsZUFBZSxHQUFHO0FBQ3ZCQyxFQUFBQSxNQUFNLEVBQUVDLFNBRGU7QUFDSjtBQUNuQkMsRUFBQUEsUUFBUSxFQUFFQyxDQUFD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OUMsTUFBQUEsZUFBZSxDQUFDa0QsT0FBaEIsQ0FBd0JDLEtBQXhCLENBQThCLFdBQTlCLEVBQTJDSixhQUEzQzs7QUFDQSxVQUFJL0MsZUFBZSxDQUFDQyxNQUFoQixDQUF1QjJDLFdBQXZCLEtBQXVDNUMsZUFBZSxDQUFDTyxRQUEzRCxFQUFxRTtBQUNwRVAsUUFBQUEsZUFBZSxDQUFDRyxRQUFoQixDQUF5QmdCLElBQXpCLENBQThCLDJCQUE5QjtBQUNBO0FBQ0Q7QUFDRDtBQXhFc0IsQ0FBeEI7QUEwRUFmLENBQUMsQ0FBQ08sUUFBRCxDQUFELENBQVl5QyxLQUFaLENBQWtCLFlBQU07QUFDdkJwRCxFQUFBQSxlQUFlLENBQUNRLFVBQWhCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMCBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCAqL1xuXG5jb25zdCBzbmRQbGF5ZXJPbmVCdG4gPSB7XG5cdHNsaWRlcjogdW5kZWZpbmVkLCAvLyBhdWRpbyBwbGF5ZXJcblx0JHBCdXR0b246ICQoJy5hY3Rpb24tcGxheWJhY2stYnV0dG9uJyksIC8vIHBsYXkgYnV0dG9uXG5cdHNvdW5kU2VsZWN0b3JDbGFzczogJCgnLmFjdGlvbi1wbGF5YmFjay1idXR0b24nKS5hdHRyKCdkYXRhLXZhbHVlJyksXG5cdGR1cmF0aW9uOiAwLFxuXHRpbml0aWFsaXplKCkge1xuXHRcdGNvbnN0IGF1ZGlvUGxheWVyID0gJzxhdWRpbyBpZD1cImF1ZGlvLXBsYXllclwiIHByZWxvYWQ9XCJhdXRvXCI+PHNvdXJjZSBzcmM9XCJcIiB0eXBlPVwiYXVkaW8vbXAzXCI+PC9hdWRpbz4nO1xuXHRcdHNuZFBsYXllck9uZUJ0bi4kcEJ1dHRvbi5hZnRlcihhdWRpb1BsYXllcik7XG5cdFx0c25kUGxheWVyT25lQnRuLnNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdWRpby1wbGF5ZXInKTtcblx0XHQkKGAjJHtzbmRQbGF5ZXJPbmVCdG4uc291bmRTZWxlY3RvckNsYXNzfWApLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRzbmRQbGF5ZXJPbmVCdG4udXBkYXRlQXVkaW9Tb3VyY2UoKTtcblx0XHR9KTtcblx0XHRzbmRQbGF5ZXJPbmVCdG4uJHBCdXR0b24ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmIChzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLnBhdXNlZCAmJiBzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLmR1cmF0aW9uKSB7XG5cdFx0XHRcdHNuZFBsYXllck9uZUJ0bi5zbGlkZXIucGxheSgpO1xuXHRcdFx0XHQvLyByZW1vdmUgcGxheSwgYWRkIHBhdXNlXG5cdFx0XHRcdHNuZFBsYXllck9uZUJ0bi4kcEJ1dHRvbi5odG1sKCc8aSBjbGFzcz1cImljb24gcGF1c2VcIj48L2k+Jyk7XG5cdFx0XHR9IGVsc2UgeyAvLyBwYXVzZSBtdXNpY1xuXHRcdFx0XHRzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLnBhdXNlKCk7XG5cdFx0XHRcdC8vIHJlbW92ZSBwYXVzZSwgYWRkIHBsYXlcblx0XHRcdFx0c25kUGxheWVyT25lQnRuLiRwQnV0dG9uLmh0bWwoJzxpIGNsYXNzPVwiaWNvbiBwbGF5XCI+PC9pPicpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHNuZFBsYXllck9uZUJ0bi51cGRhdGVBdWRpb1NvdXJjZSgpO1xuXHR9LFxuXHR1cGRhdGVBdWRpb1NvdXJjZSgpIHtcblx0XHRjb25zdCBhdWRpb0ZpbGVJZCA9ICQoJ2Zvcm0nKS5mb3JtKCdnZXQgdmFsdWUnLCBzbmRQbGF5ZXJPbmVCdG4uc291bmRTZWxlY3RvckNsYXNzKTtcblx0XHRpZiAoYXVkaW9GaWxlSWQgIT09ICcnICYmIGF1ZGlvRmlsZUlkICE9PSBcIi0xXCIpIHtcblx0XHRcdCQuYXBpKHtcblx0XHRcdFx0dXJsOiBgJHtnbG9iYWxSb290VXJsfXNvdW5kLWZpbGVzL2dldHBhdGhieWlkLyR7YXVkaW9GaWxlSWR9YCxcblx0XHRcdFx0b246ICdub3cnLFxuXHRcdFx0XHRvblN1Y2Nlc3MocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRzbmRQbGF5ZXJPbmVCdG4uY2JBZnRlclJlc3BvbnNlKHJlc3BvbnNlKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0b25FcnJvcigpIHtcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHR9LFxuXHRjYkFmdGVyUmVzcG9uc2UocmVzcG9uc2UpIHtcblx0XHRpZiAocmVzcG9uc2UubWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzb3VyY2UnKVswXS5zcmNcblx0XHRcdFx0PSBgL3BieGNvcmUvYXBpL2Nkci9wbGF5YmFjaz92aWV3PSR7cmVzcG9uc2UubWVzc2FnZX1gO1xuXHRcdFx0c25kUGxheWVyT25lQnRuLnNsaWRlci5wYXVzZSgpO1xuXHRcdFx0c25kUGxheWVyT25lQnRuLnNsaWRlci5sb2FkKCk7XG5cdFx0XHRzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLm9uY2FucGxheXRocm91Z2ggPSBzbmRQbGF5ZXJPbmVCdG4uY2JDYW5QbGF5VGhyb3VnaDtcblx0XHR9XG5cdH0sXG5cdGNiQ2FuUGxheVRocm91Z2goKSB7XG5cdFx0c25kUGxheWVyT25lQnRuLmR1cmF0aW9uID0gc25kUGxheWVyT25lQnRuLnNsaWRlci5kdXJhdGlvbjtcblx0XHRpZiAoc25kUGxheWVyT25lQnRuLiRwQnV0dG9uLmh0bWwoKSA9PT0gJzxpIGNsYXNzPVwiaWNvbiBwYXVzZVwiPjwvaT4nKSB7XG5cdFx0XHRzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLnBsYXkoKTtcblx0XHR9XG5cdH0sXG5cdGNiT25TbGlkZXJDaGFuZ2UobmV3VmFsLCBtZXRhKSB7XG5cdFx0aWYgKG1ldGEudHJpZ2dlcmVkQnlVc2VyICYmIE51bWJlci5pc0Zpbml0ZShzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLmR1cmF0aW9uKSkge1xuXHRcdFx0c25kUGxheWVyT25lQnRuLnNsaWRlci5yZW1vdmVFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgc25kUGxheWVyT25lQnRuLmNiVGltZVVwZGF0ZSwgZmFsc2UpO1xuXHRcdFx0c25kUGxheWVyT25lQnRuLnNsaWRlci5jdXJyZW50VGltZSA9IChzbmRQbGF5ZXJPbmVCdG4uc2xpZGVyLmR1cmF0aW9uICogbmV3VmFsKSAvIDEwMDtcblx0XHRcdHNuZFBsYXllck9uZUJ0bi5zbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIHNuZFBsYXllck9uZUJ0bi5jYlRpbWVVcGRhdGUsIGZhbHNlKTtcblx0XHR9XG5cdH0sXG5cdGNiVGltZVVwZGF0ZSgpIHtcblx0XHRpZiAoTnVtYmVyLmlzRmluaXRlKHNuZFBsYXllck9uZUJ0bi5zbGlkZXIuZHVyYXRpb24pKSB7XG5cdFx0XHRjb25zdCBwZXJjZW50ID0gc25kUGxheWVyT25lQnRuLnNsaWRlci5jdXJyZW50VGltZSAvIHNuZFBsYXllck9uZUJ0bi5zbGlkZXIuZHVyYXRpb247XG5cdFx0XHRjb25zdCByYW5nZVBvc2l0aW9uID0gTWF0aC5yb3VuZCgocGVyY2VudCkgKiAxMDApO1xuXHRcdFx0c25kUGxheWVyT25lQnRuLiRzbGlkZXIucmFuZ2UoJ3NldCB2YWx1ZScsIHJhbmdlUG9zaXRpb24pO1xuXHRcdFx0aWYgKHNuZFBsYXllck9uZUJ0bi5zbGlkZXIuY3VycmVudFRpbWUgPT09IHNuZFBsYXllck9uZUJ0bi5kdXJhdGlvbikge1xuXHRcdFx0XHRzbmRQbGF5ZXJPbmVCdG4uJHBCdXR0b24uaHRtbCgnPGkgY2xhc3M9XCJpY29uIHBsYXlcIj48L2k+Jyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxufTtcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0c25kUGxheWVyT25lQnRuLmluaXRpYWxpemUoKTtcbn0pO1xuIl19