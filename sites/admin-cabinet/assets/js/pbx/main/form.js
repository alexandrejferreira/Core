"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate */
var Form = {
  $formObj: '',
  validateRules: {},
  url: '',
  cbBeforeSendForm: '',
  cbAfterSendForm: '',
  $submitButton: $('#submitbutton'),
  $dropdownSubmit: $('#dropdownSubmit'),
  $submitModeInput: $('input[name="submitMode"]'),
  processData: true,
  contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
  keyboardShortcuts: true,
  enableDirrity: true,
  afterSubmitIndexUrl: '',
  afterSubmitModifyUrl: '',
  oldFormValues: [],
  initialize: function initialize() {
    Form.$formObj.form.settings.rules.notRegExp = Form.notRegExpValidateRule;
    if (Form.enableDirrity) Form.initializeDirrity();
    Form.$submitButton.on('click', function (e) {
      e.preventDefault();
      if (Form.$submitButton.hasClass('loading')) return;
      if (Form.$submitButton.hasClass('disabled')) return;
      Form.$formObj.form({
        on: 'blur',
        fields: Form.validateRules,
        onSuccess: function onSuccess() {
          Form.submitForm();
        },
        onFailure: function onFailure() {
          Form.$formObj.removeClass('error').addClass('error');
        }
      });
      Form.$formObj.form('validate form');
    });

    if (Form.$dropdownSubmit.length > 0) {
      Form.$dropdownSubmit.dropdown({
        onChange: function onChange(value) {
          var translateKey = "bt_".concat(value);
          Form.$submitModeInput.val(value);
          Form.$submitButton.html("<i class=\"save icon\"></i> ".concat(globalTranslate[translateKey])).click();
        }
      });
    }

    Form.$formObj.on('submit', function (e) {
      e.preventDefault();
    });
  },

  /**
   * Инициализация отслеживания изменений формы
   */
  initializeDirrity: function initializeDirrity() {
    Form.saveInitialValues();
    Form.setEvents();
    Form.$submitButton.addClass('disabled');
    Form.$dropdownSubmit.addClass('disabled');
  },

  /**
   * Сохраняет первоначальные значения для проверки на изменения формы
   */
  saveInitialValues: function saveInitialValues() {
    Form.oldFormValues = Form.$formObj.form('get values');
  },

  /**
   * Запускает обработчики изменения объектов формы
   */
  setEvents: function setEvents() {
    Form.$formObj.find('input, select').change(function () {
      Form.checkValues();
    });
    Form.$formObj.find('input, textarea').on('keyup keydown blur', function () {
      Form.checkValues();
    });
    Form.$formObj.find('.ui.checkbox').on('click', function () {
      Form.checkValues();
    });
  },

  /**
   * Сверяет изменения старых и новых значений формы
   */
  checkValues: function checkValues() {
    var newFormValues = Form.$formObj.form('get values');

    if (JSON.stringify(Form.oldFormValues) === JSON.stringify(newFormValues)) {
      Form.$submitButton.addClass('disabled');
      Form.$dropdownSubmit.addClass('disabled');
    } else {
      Form.$submitButton.removeClass('disabled');
      Form.$dropdownSubmit.removeClass('disabled');
    }
  },

  /**
   * Отправка формы на сервер
   */
  submitForm: function submitForm() {
    $.api({
      url: Form.url,
      on: 'now',
      method: 'POST',
      processData: Form.processData,
      contentType: Form.contentType,
      keyboardShortcuts: Form.keyboardShortcuts,
      beforeSend: function beforeSend(settings) {
        Form.$submitButton.addClass('loading');
        var cbBeforeSendResult = Form.cbBeforeSendForm(settings);

        if (cbBeforeSendResult === false) {
          Form.$submitButton.transition('shake').removeClass('loading');
        } else {
          $.each(cbBeforeSendResult.data, function (index, value) {
            if (index.indexOf('ecret') > -1 || index.indexOf('assword') > -1) return;
            if (typeof value === 'string') cbBeforeSendResult.data[index] = value.trim();
          });
        }

        return cbBeforeSendResult;
      },
      onSuccess: function onSuccess(response) {
        $('.ui.message.ajax').remove();
        $.each(response.message, function (index, value) {
          if (index === 'error') {
            Form.$submitButton.transition('shake').removeClass('loading');
            Form.$formObj.after("<div class=\"ui ".concat(index, " message ajax\">").concat(value, "</div>"));
          }
        });
        var event = document.createEvent('Event');
        event.initEvent('ConfigDataChanged', false, true);
        window.dispatchEvent(event);
        Form.cbAfterSendForm(response);

        if (response.success && response.reload.length > 0 && Form.$submitModeInput.val() === 'SaveSettings') {
          window.location = globalRootUrl + response.reload;
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndAddNew') {
          if (Form.afterSubmitModifyUrl.length > 1) {
            window.location = Form.afterSubmitModifyUrl;
          } else {
            var emptyUrl = window.location.href.split('modify');
            var action = 'modify';
            var prefixData = emptyUrl[1].split('/');

            if (prefixData.length > 0) {
              action = action + prefixData[0];
            }

            if (emptyUrl.length > 1) {
              window.location = "".concat(emptyUrl[0]).concat(action, "/");
            }
          }
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndExit') {
          if (Form.afterSubmitIndexUrl.length > 1) {
            window.location = Form.afterSubmitIndexUrl;
          } else {
            var _emptyUrl = window.location.href.split('modify');

            if (_emptyUrl.length > 1) {
              window.location = "".concat(_emptyUrl[0], "index/");
            }
          }
        } else if (response.success && response.reload.length > 0) {
          window.location = globalRootUrl + response.reload;
        } else if (response.success && Form.enableDirrity) {
          Form.initializeDirrity();
        }

        Form.$submitButton.removeClass('loading');
      },
      onFailure: function onFailure(response) {
        Form.$formObj.after(response);
        Form.$submitButton.transition('shake').removeClass('loading');
      }
    });
  },

  /**
   * Возвращщает ИСТИНА, если значение НЕ соответствует Regex.
   * @param value
   * @param regex
   * @returns {boolean}
   */
  notRegExpValidateRule: function notRegExpValidateRule(value, regex) {
    return value.match(regex) !== null;
  }
}; // export default Form;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL2Zvcm0uanMiXSwibmFtZXMiOlsiRm9ybSIsIiRmb3JtT2JqIiwidmFsaWRhdGVSdWxlcyIsInVybCIsImNiQmVmb3JlU2VuZEZvcm0iLCJjYkFmdGVyU2VuZEZvcm0iLCIkc3VibWl0QnV0dG9uIiwiJCIsIiRkcm9wZG93blN1Ym1pdCIsIiRzdWJtaXRNb2RlSW5wdXQiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwia2V5Ym9hcmRTaG9ydGN1dHMiLCJlbmFibGVEaXJyaXR5IiwiYWZ0ZXJTdWJtaXRJbmRleFVybCIsImFmdGVyU3VibWl0TW9kaWZ5VXJsIiwib2xkRm9ybVZhbHVlcyIsImluaXRpYWxpemUiLCJmb3JtIiwic2V0dGluZ3MiLCJydWxlcyIsIm5vdFJlZ0V4cCIsIm5vdFJlZ0V4cFZhbGlkYXRlUnVsZSIsImluaXRpYWxpemVEaXJyaXR5Iiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJoYXNDbGFzcyIsImZpZWxkcyIsIm9uU3VjY2VzcyIsInN1Ym1pdEZvcm0iLCJvbkZhaWx1cmUiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwibGVuZ3RoIiwiZHJvcGRvd24iLCJvbkNoYW5nZSIsInZhbHVlIiwidHJhbnNsYXRlS2V5IiwidmFsIiwiaHRtbCIsImdsb2JhbFRyYW5zbGF0ZSIsImNsaWNrIiwic2F2ZUluaXRpYWxWYWx1ZXMiLCJzZXRFdmVudHMiLCJmaW5kIiwiY2hhbmdlIiwiY2hlY2tWYWx1ZXMiLCJuZXdGb3JtVmFsdWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsImFwaSIsIm1ldGhvZCIsImJlZm9yZVNlbmQiLCJjYkJlZm9yZVNlbmRSZXN1bHQiLCJ0cmFuc2l0aW9uIiwiZWFjaCIsImRhdGEiLCJpbmRleCIsImluZGV4T2YiLCJ0cmltIiwicmVzcG9uc2UiLCJyZW1vdmUiLCJtZXNzYWdlIiwiYWZ0ZXIiLCJldmVudCIsImRvY3VtZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0RXZlbnQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50Iiwic3VjY2VzcyIsInJlbG9hZCIsImxvY2F0aW9uIiwiZ2xvYmFsUm9vdFVybCIsImVtcHR5VXJsIiwiaHJlZiIsInNwbGl0IiwiYWN0aW9uIiwicHJlZml4RGF0YSIsInJlZ2V4IiwibWF0Y2giXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLElBQUksR0FBRztBQUNaQyxFQUFBQSxRQUFRLEVBQUUsRUFERTtBQUVaQyxFQUFBQSxhQUFhLEVBQUUsRUFGSDtBQUdaQyxFQUFBQSxHQUFHLEVBQUUsRUFITztBQUlaQyxFQUFBQSxnQkFBZ0IsRUFBRSxFQUpOO0FBS1pDLEVBQUFBLGVBQWUsRUFBRSxFQUxMO0FBTVpDLEVBQUFBLGFBQWEsRUFBRUMsQ0FBQyxDQUFDLGVBQUQsQ0FOSjtBQU9aQyxFQUFBQSxlQUFlLEVBQUVELENBQUMsQ0FBQyxpQkFBRCxDQVBOO0FBUVpFLEVBQUFBLGdCQUFnQixFQUFFRixDQUFDLENBQUMsMEJBQUQsQ0FSUDtBQVNaRyxFQUFBQSxXQUFXLEVBQUUsSUFURDtBQVVaQyxFQUFBQSxXQUFXLEVBQUUsa0RBVkQ7QUFXWkMsRUFBQUEsaUJBQWlCLEVBQUUsSUFYUDtBQVlaQyxFQUFBQSxhQUFhLEVBQUUsSUFaSDtBQWFaQyxFQUFBQSxtQkFBbUIsRUFBRSxFQWJUO0FBY1pDLEVBQUFBLG9CQUFvQixFQUFFLEVBZFY7QUFlWkMsRUFBQUEsYUFBYSxFQUFFLEVBZkg7QUFnQlpDLEVBQUFBLFVBaEJZLHdCQWdCQztBQUNaakIsSUFBQUEsSUFBSSxDQUFDQyxRQUFMLENBQWNpQixJQUFkLENBQW1CQyxRQUFuQixDQUE0QkMsS0FBNUIsQ0FBa0NDLFNBQWxDLEdBQThDckIsSUFBSSxDQUFDc0IscUJBQW5EO0FBQ0EsUUFBSXRCLElBQUksQ0FBQ2EsYUFBVCxFQUF3QmIsSUFBSSxDQUFD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dkIsUUFBQUEsSUFBSSxDQUFDTSxhQUFMLENBQW1CMEIsV0FBbkIsQ0FBK0IsU0FBL0I7QUFDQSxPQXBFSTtBQXFFTEQsTUFBQUEsU0FyRUsscUJBcUVLOEIsUUFyRUwsRUFxRWU7QUFDbkI3RCxRQUFBQSxJQUFJLENBQUNDLFFBQUwsQ0FBYytELEtBQWQsQ0FBb0JILFFBQXBCO0FBQ0E3RCxRQUFBQSxJQUFJLENBQUNNLGFBQUwsQ0FDRWlELFVBREYsQ0FDYSxPQURiLEVBRUV2QixXQUZGLENBRWMsU0FGZDtBQUdBO0FBMUVJLEtBQU47QUE2RUEsR0EvS1c7O0FBaUxaO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNDVixFQUFBQSxxQkF2TFksaUNBdUxVZSxLQXZMVixFQXVMaUIyQyxLQXZMakIsRUF1THVCO0FBQ2xDLFdBQU8zQyxLQUFLLENBQUM0QyxLQUFOLENBQVlELEtBQVosTUFBdUIsSUFBOUI7QUFDQTtBQXpMVyxDQUFiLEMsQ0E0TEEiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjAgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGdsb2JhbFRyYW5zbGF0ZSAqL1xuXG5jb25zdCBGb3JtID0ge1xuXHQkZm9ybU9iajogJycsXG5cdHZhbGlkYXRlUnVsZXM6IHt9LFxuXHR1cmw6ICcnLFxuXHRjYkJlZm9yZVNlbmRGb3JtOiAnJyxcblx0Y2JBZnRlclNlbmRGb3JtOiAnJyxcblx0JHN1Ym1pdEJ1dHRvbjogJCgnI3N1Ym1pdGJ1dHRvbicpLFxuXHQkZHJvcGRvd25TdWJtaXQ6ICQoJyNkcm9wZG93blN1Ym1pdCcpLFxuXHQkc3VibWl0TW9kZUlucHV0OiAkKCdpbnB1dFtuYW1lPVwic3VibWl0TW9kZVwiXScpLFxuXHRwcm9jZXNzRGF0YTogdHJ1ZSxcblx0Y29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgnLFxuXHRrZXlib2FyZFNob3J0Y3V0czogdHJ1ZSxcblx0ZW5hYmxlRGlycml0eTogdHJ1ZSxcblx0YWZ0ZXJTdWJtaXRJbmRleFVybDogJycsXG5cdGFmdGVyU3VibWl0TW9kaWZ5VXJsOiAnJyxcblx0b2xkRm9ybVZhbHVlczogW10sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Rm9ybS4kZm9ybU9iai5mb3JtLnNldHRpbmdzLnJ1bGVzLm5vdFJlZ0V4cCA9IEZvcm0ubm90UmVnRXhwVmFsaWRhdGVSdWxlO1xuXHRcdGlmIChGb3JtLmVuYWJsZURpcnJpdHkpIEZvcm0uaW5pdGlhbGl6ZURpcnJpdHkoKTtcblxuXHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi5vbignY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKEZvcm0uJHN1Ym1pdEJ1dHRvbi5oYXNDbGFzcygnbG9hZGluZycpKSByZXR1cm47XG5cdFx0XHRpZiAoRm9ybS4kc3VibWl0QnV0dG9uLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSByZXR1cm47XG5cdFx0XHRGb3JtLiRmb3JtT2JqXG5cdFx0XHRcdC5mb3JtKHtcblx0XHRcdFx0XHRvbjogJ2JsdXInLFxuXHRcdFx0XHRcdGZpZWxkczogRm9ybS52YWxpZGF0ZVJ1bGVzLFxuXHRcdFx0XHRcdG9uU3VjY2VzcygpIHtcblx0XHRcdFx0XHRcdEZvcm0uc3VibWl0Rm9ybSgpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0b25GYWlsdXJlKCkge1xuXHRcdFx0XHRcdFx0Rm9ybS4kZm9ybU9iai5yZW1vdmVDbGFzcygnZXJyb3InKS5hZGRDbGFzcygnZXJyb3InKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9KTtcblx0XHRcdEZvcm0uJGZvcm1PYmouZm9ybSgndmFsaWRhdGUgZm9ybScpO1xuXHRcdH0pO1xuXHRcdGlmIChGb3JtLiRkcm9wZG93blN1Ym1pdC5sZW5ndGggPiAwKSB7XG5cdFx0XHRGb3JtLiRkcm9wZG93blN1Ym1pdC5kcm9wZG93bih7XG5cdFx0XHRcdG9uQ2hhbmdlOiAodmFsdWUpID0+IHtcblx0XHRcdFx0XHRjb25zdCB0cmFuc2xhdGVLZXkgPSBgYnRfJHt2YWx1ZX1gO1xuXHRcdFx0XHRcdEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwodmFsdWUpO1xuXHRcdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvblxuXHRcdFx0XHRcdFx0Lmh0bWwoYDxpIGNsYXNzPVwic2F2ZSBpY29uXCI+PC9pPiAke2dsb2JhbFRyYW5zbGF0ZVt0cmFuc2xhdGVLZXldfWApXG5cdFx0XHRcdFx0XHQuY2xpY2soKTtcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRGb3JtLiRmb3JtT2JqLm9uKCdzdWJtaXQnLCAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH0pO1xuXHR9LFxuXHQvKipcblx0ICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0L7RgtGB0LvQtdC20LjQstCw0L3QuNGPINC40LfQvNC10L3QtdC90LjQuSDRhNC+0YDQvNGLXG5cdCAqL1xuXHRpbml0aWFsaXplRGlycml0eSgpIHtcblx0XHRGb3JtLnNhdmVJbml0aWFsVmFsdWVzKCk7XG5cdFx0Rm9ybS5zZXRFdmVudHMoKTtcblx0XHRGb3JtLiRzdWJtaXRCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0Rm9ybS4kZHJvcGRvd25TdWJtaXQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQodC+0YXRgNCw0L3Rj9C10YIg0L/QtdGA0LLQvtC90LDRh9Cw0LvRjNC90YvQtSDQt9C90LDRh9C10L3QuNGPINC00LvRjyDQv9GA0L7QstC10YDQutC4INC90LAg0LjQt9C80LXQvdC10L3QuNGPINGE0L7RgNC80Ytcblx0ICovXG5cdHNhdmVJbml0aWFsVmFsdWVzKCkge1xuXHRcdEZvcm0ub2xkRm9ybVZhbHVlcyA9IEZvcm0uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHR9LFxuXHQvKipcblx0ICog0JfQsNC/0YPRgdC60LDQtdGCINC+0LHRgNCw0LHQvtGC0YfQuNC60Lgg0LjQt9C80LXQvdC10L3QuNGPINC+0LHRitC10LrRgtC+0LIg0YTQvtGA0LzRi1xuXHQgKi9cblx0c2V0RXZlbnRzKCkge1xuXHRcdEZvcm0uJGZvcm1PYmouZmluZCgnaW5wdXQsIHNlbGVjdCcpLmNoYW5nZSgoKSA9PiB7XG5cdFx0XHRGb3JtLmNoZWNrVmFsdWVzKCk7XG5cdFx0fSk7XG5cdFx0Rm9ybS4kZm9ybU9iai5maW5kKCdpbnB1dCwgdGV4dGFyZWEnKS5vbigna2V5dXAga2V5ZG93biBibHVyJywgKCkgPT4ge1xuXHRcdFx0Rm9ybS5jaGVja1ZhbHVlcygpO1xuXHRcdH0pO1xuXHRcdEZvcm0uJGZvcm1PYmouZmluZCgnLnVpLmNoZWNrYm94Jykub24oJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0Rm9ybS5jaGVja1ZhbHVlcygpO1xuXHRcdH0pO1xuXHR9LFxuXHQvKipcblx0ICog0KHQstC10YDRj9C10YIg0LjQt9C80LXQvdC10L3QuNGPINGB0YLQsNGA0YvRhSDQuCDQvdC+0LLRi9GFINC30L3QsNGH0LXQvdC40Lkg0YTQvtGA0LzRi1xuXHQgKi9cblx0Y2hlY2tWYWx1ZXMoKSB7XG5cdFx0Y29uc3QgbmV3Rm9ybVZhbHVlcyA9IEZvcm0uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdGlmIChKU09OLnN0cmluZ2lmeShGb3JtLm9sZEZvcm1WYWx1ZXMpID09PSBKU09OLnN0cmluZ2lmeShuZXdGb3JtVmFsdWVzKSkge1xuXHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0Rm9ybS4kZHJvcGRvd25TdWJtaXQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdEZvcm0uJGRyb3Bkb3duU3VibWl0LnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdH1cblx0fSxcblx0LyoqXG5cdCAqINCe0YLQv9GA0LDQstC60LAg0YTQvtGA0LzRiyDQvdCwINGB0LXRgNCy0LXRgFxuXHQgKi9cblx0c3VibWl0Rm9ybSgpIHtcblx0XHQkLmFwaSh7XG5cdFx0XHR1cmw6IEZvcm0udXJsLFxuXHRcdFx0b246ICdub3cnLFxuXHRcdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRwcm9jZXNzRGF0YTogRm9ybS5wcm9jZXNzRGF0YSxcblx0XHRcdGNvbnRlbnRUeXBlOiBGb3JtLmNvbnRlbnRUeXBlLFxuXHRcdFx0a2V5Ym9hcmRTaG9ydGN1dHM6IEZvcm0ua2V5Ym9hcmRTaG9ydGN1dHMsXG5cdFx0XHRiZWZvcmVTZW5kKHNldHRpbmdzKSB7XG5cdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnbG9hZGluZycpO1xuXHRcdFx0XHRjb25zdCBjYkJlZm9yZVNlbmRSZXN1bHQgPSBGb3JtLmNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpO1xuXHRcdFx0XHRpZiAoY2JCZWZvcmVTZW5kUmVzdWx0ID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvblxuXHRcdFx0XHRcdFx0LnRyYW5zaXRpb24oJ3NoYWtlJylcblx0XHRcdFx0XHRcdC5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCQuZWFjaChjYkJlZm9yZVNlbmRSZXN1bHQuZGF0YSwgKGluZGV4LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKGluZGV4LmluZGV4T2YoJ2VjcmV0JykgPiAtMSB8fCBpbmRleC5pbmRleE9mKCdhc3N3b3JkJykgPiAtMSkgcmV0dXJuO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIGNiQmVmb3JlU2VuZFJlc3VsdC5kYXRhW2luZGV4XSA9IHZhbHVlLnRyaW0oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gY2JCZWZvcmVTZW5kUmVzdWx0O1xuXHRcdFx0fSxcblx0XHRcdG9uU3VjY2VzcyhyZXNwb25zZSkge1xuXHRcdFx0XHQkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG5cdFx0XHRcdCQuZWFjaChyZXNwb25zZS5tZXNzYWdlLCAoaW5kZXgsIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0aWYgKGluZGV4ID09PSAnZXJyb3InKSB7XG5cdFx0XHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24udHJhbnNpdGlvbignc2hha2UnKS5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuXHRcdFx0XHRcdFx0Rm9ybS4kZm9ybU9iai5hZnRlcihgPGRpdiBjbGFzcz1cInVpICR7aW5kZXh9IG1lc3NhZ2UgYWpheFwiPiR7dmFsdWV9PC9kaXY+YCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0Y29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTtcblx0XHRcdFx0ZXZlbnQuaW5pdEV2ZW50KCdDb25maWdEYXRhQ2hhbmdlZCcsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0d2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuXHRcdFx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybShyZXNwb25zZSk7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzXG5cdFx0XHRcdFx0JiYgcmVzcG9uc2UucmVsb2FkLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQmJiBGb3JtLiRzdWJtaXRNb2RlSW5wdXQudmFsKCkgPT09ICdTYXZlU2V0dGluZ3MnKSB7XG5cdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gZ2xvYmFsUm9vdFVybCArIHJlc3BvbnNlLnJlbG9hZDtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwoKSA9PT0gJ1NhdmVTZXR0aW5nc0FuZEFkZE5ldycpIHtcblx0XHRcdFx0XHRpZiAoRm9ybS5hZnRlclN1Ym1pdE1vZGlmeVVybC5sZW5ndGggPiAxKXtcblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IEZvcm0uYWZ0ZXJTdWJtaXRNb2RpZnlVcmw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnN0IGVtcHR5VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJ21vZGlmeScpO1xuXHRcdFx0XHRcdFx0bGV0IGFjdGlvbiA9ICdtb2RpZnknO1xuXHRcdFx0XHRcdFx0bGV0IHByZWZpeERhdGEgPSBlbXB0eVVybFsxXS5zcGxpdCgnLycpO1xuXHRcdFx0XHRcdFx0aWYocHJlZml4RGF0YS5sZW5ndGggPiAwKXtcblx0XHRcdFx0XHRcdFx0YWN0aW9uID0gYWN0aW9uICsgcHJlZml4RGF0YVswXTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGlmIChlbXB0eVVybC5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IGAke2VtcHR5VXJsWzBdfSR7YWN0aW9ufS9gO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwoKSA9PT0gJ1NhdmVTZXR0aW5nc0FuZEV4aXQnKSB7XG5cdFx0XHRcdFx0aWYgKEZvcm0uYWZ0ZXJTdWJtaXRJbmRleFVybC5sZW5ndGggPiAxKXtcblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IEZvcm0uYWZ0ZXJTdWJtaXRJbmRleFVybDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc3QgZW1wdHlVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnbW9kaWZ5Jyk7XG5cdFx0XHRcdFx0XHRpZiAoZW1wdHlVcmwubGVuZ3RoID4gMSkge1xuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBgJHtlbXB0eVVybFswXX1pbmRleC9gO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmIChyZXNwb25zZS5zdWNjZXNzXG5cdFx0XHRcdFx0XHQmJiByZXNwb25zZS5yZWxvYWQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IGdsb2JhbFJvb3RVcmwgKyByZXNwb25zZS5yZWxvYWQ7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiBGb3JtLmVuYWJsZURpcnJpdHkpIHtcblx0XHRcdFx0XHRGb3JtLmluaXRpYWxpemVEaXJyaXR5KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHR9LFxuXHRcdFx0b25GYWlsdXJlKHJlc3BvbnNlKSB7XG5cdFx0XHRcdEZvcm0uJGZvcm1PYmouYWZ0ZXIocmVzcG9uc2UpO1xuXHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b25cblx0XHRcdFx0XHQudHJhbnNpdGlvbignc2hha2UnKVxuXHRcdFx0XHRcdC5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuXHRcdFx0fSxcblxuXHRcdH0pO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiDQktC+0LfQstGA0LDRidGJ0LDQtdGCINCY0KHQotCY0J3QkCwg0LXRgdC70Lgg0LfQvdCw0YfQtdC90LjQtSDQndCVINGB0L7QvtGC0LLQtdGC0YHRgtCy0YPQtdGCIFJlZ2V4LlxuXHQgKiBAcGFyYW0gdmFsdWVcblx0ICogQHBhcmFtIHJlZ2V4XG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxuXHQgKi9cblx0bm90UmVnRXhwVmFsaWRhdGVSdWxlKHZhbHVlLCByZWdleCl7XG5cdFx0cmV0dXJuIHZhbHVlLm1hdGNoKHJlZ2V4KSAhPT0gbnVsbDtcblx0fVxufTtcblxuLy8gZXhwb3J0IGRlZmF1bHQgRm9ybTtcbiJdfQ==