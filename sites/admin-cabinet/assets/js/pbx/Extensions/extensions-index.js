"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ClipboardJS, SemanticLocalization, InputMaskPatterns, UserMessage, globalTranslate */
var extensionsIndex = {
  maskList: null,
  $extensionsList: $('#extensions-table'),
  $contentFrame: $('#content-frame'),
  initialize: function initialize() {
    $('.avatar').each(function () {
      if ($(this).attr('src') === '') {
        $(this).attr('src', "".concat(globalRootUrl, "assets/img/unknownPerson.jpg"));
      }
    });
    extensionsIndex.initializeInputmask($('input.mobile-number-input'));
    extensionsIndex.$extensionsList.DataTable({
      lengthChange: false,
      paging: false,
      columns: [{
        orderable: false,
        searchable: false,
        "width": "0"
      }, null, null, null, null, {
        orderable: false,
        searchable: false
      }],
      autoWidth: false,
      order: [1, 'asc'],
      language: SemanticLocalization.dataTableLocalisation,
      drawCallback: function drawCallback() {}
    });
    $('#add-new-button').appendTo($('div.eight.column:eq(0)'));
    $('.extension-row td').on('dblclick', function (e) {
      var id = $(e.target).closest('tr').attr('id');
      window.location = "".concat(globalRootUrl, "extensions/modify/").concat(id);
    });
    var clipboard = new ClipboardJS('.clipboard');
    $('.clipboard').popup({
      on: 'manual'
    });
    clipboard.on('success', function (e) {
      $(e.trigger).popup('show');
      setTimeout(function () {
        $(e.trigger).popup('hide');
      }, 1500);
      e.clearSelection();
    });
    clipboard.on('error', function (e) {
      console.error('Action:', e.action);
      console.error('Trigger:', e.trigger);
    });
    $('.extension-row .checkbox').checkbox({
      onChecked: function onChecked() {
        var number = $(this).attr('data-value');
        $.api({
          url: "".concat(globalRootUrl, "extensions/enable/").concat(number),
          on: 'now',
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(number, " .disability")).removeClass('disabled');
            }
          }
        });
      },
      onUnchecked: function onUnchecked() {
        var number = $(this).attr('data-value');
        $.api({
          url: "".concat(globalRootUrl, "extensions/disable/").concat(number),
          on: 'now',
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(number, " .disability")).addClass('disabled');
            }
          }
        });
      }
    });
    $('body').on('click', 'a.delete', function (e) {
      e.preventDefault();
      var extensionId = $(e.target).closest('tr').attr('id');
      extensionsIndex.deleteExtension(extensionId);
    });
  },

  /**
   * Deletes extension with id
   * @param extensionId
   */
  deleteExtension: function deleteExtension(extensionId) {
    $('.message.ajax').remove();
    $.api({
      url: "".concat(globalRootUrl, "extensions/delete/").concat(extensionId),
      on: 'now',
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0;
      },
      onSuccess: function onSuccess(response) {
        if (response.success === true) {
          extensionsIndex.$extensionsList.find("tr[id=".concat(extensionId, "]")).remove();
          Extensions.cbOnDataChanged();
        } else {
          UserMessage.showError(response.message.error, globalTranslate.ex_ImpossibleToDeleteExtension);
        }
      }
    });
  },

  /**
   * Makes formatted numbers visualisation
   */
  initializeInputmask: function initializeInputmask($el) {
    if (extensionsIndex.maskList === null) {
      // Prepares the table for sort
      extensionsIndex.maskList = $.masksSort(InputMaskPatterns, ['#'], /[0-9]|#/, 'mask');
    }

    $el.inputmasks({
      inputmask: {
        definitions: {
          '#': {
            validator: '[0-9]',
            cardinality: 1
          }
        }
      },
      match: /[0-9]/,
      replace: '9',
      list: extensionsIndex.maskList,
      listKey: 'mask'
    });
  }
};
$(document).ready(function () {
  extensionsIndex.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9FeHRlbnNpb25zL2V4dGVuc2lvbnMtaW5kZXguanMiXSwibmFtZXMiOlsiZXh0ZW5zaW9uc0luZGV4IiwibWFza0xpc3QiLCIkZXh0ZW5zaW9uc0xpc3QiLCIkIiwiJGNvbnRlbnRGcmFtZSIsImluaXRpYWxpemUiLCJlYWNoIiwiYXR0ciIsImdsb2JhbFJvb3RVcmwiLCJpbml0aWFsaXplSW5wdXRtYXNrIiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJhdXRvV2lkdGgiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJkcmF3Q2FsbGJhY2siLCJhcHBlbmRUbyIsIm9uIiwiZSIsImlkIiwidGFyZ2V0IiwiY2xvc2VzdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiY2xpcGJvYXJkIiwiQ2xpcGJvYXJkSlMiLCJwb3B1cCIsInRyaWdnZXIiLCJzZXRUaW1lb3V0IiwiY2xlYXJTZWxlY3Rpb24iLCJjb25zb2xlIiwiZXJyb3IiLCJhY3Rpb24iLCJjaGVja2JveCIsIm9uQ2hlY2tlZCIsIm51bWJlciIsImFwaSIsInVybCIsIm9uU3VjY2VzcyIsInJlc3BvbnNlIiwic3VjY2VzcyIsInJlbW92ZUNsYXNzIiwib25VbmNoZWNrZWQiLCJhZGRDbGFzcyIsInByZXZlbnREZWZhdWx0IiwiZXh0ZW5zaW9uSWQiLCJkZWxldGVFeHRlbnNpb24iLCJyZW1vdmUiLCJzdWNjZXNzVGVzdCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJmaW5kIiwiRXh0ZW5zaW9ucyIsImNiT25EYXRhQ2hhbmdlZCIsIlVzZXJNZXNzYWdlIiwic2hvd0Vycm9yIiwibWVzc2FnZSIsImdsb2JhbFRyYW5zbGF0ZSIsImV4X0ltcG9zc2libGVUb0RlbGV0ZUV4dGVuc2lvbiIsIiRlbCIsIm1hc2tzU29ydCIsIklucHV0TWFza1BhdHRlcm5zIiwiaW5wdXRtYXNrcyIsImlucHV0bWFzayIsImRlZmluaXRpb25zIiwidmFsaWRhdG9yIiwiY2FyZGluYWxpdHkiLCJtYXRjaCIsInJlcGxhY2UiLCJsaXN0IiwibGlzdEtleSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLGVBQWUsR0FBRztBQUN2QkMsRUFBQUEsUUFBUSxFQUFFLElBRGE7QUFFdkJDLEVBQUFBLGVBQWUsRUFBRUMsQ0FBQyxDQUFDLG1CQUFELENBRks7QUFHdkJDLEVBQUFBLGFBQWEsRUFBRUQsQ0FBQyxDQUFDLGdCQUFELENBSE87QUFJdkJFLEVBQUFBLFVBSnVCLHdCQUlWO0FBQ1pGLElBQUFBLENBQUMsQ0FBQyxTQUFELENBQUQsQ0FBYUcsSUFBYixDQUFrQixZQUFZO0FBQzdCLFVBQUlILENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUUksSUFBUixDQUFhLEtBQWIsTUFBd0IsRUFBNUIsRUFBZ0M7QUFDL0JKLFFBQUFBLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUUksSUFBUixDQUFhLEtBQWIsWUFBdUJDLGFBQXZCO0FBQ0E7QUFDRCxLQUpEO0FBS0FSLElBQUFBLGVBQWUsQ0FBQ1MsbUJBQWhCLENBQW9DTixDQUFDLENBQUMsMkJBQUQsQ0FBckM7QUFDQUgsSUFBQUEsZUFBZSxDQUFDRSxlQUFoQixDQUFnQ1EsU0FBaEMsQ0FBMEM7QUFDekNDLE1BQUFBLFlBQVksRUFBRSxLQUQyQjtBQUV6Q0MsTUFBQUEsTUFBTSxFQUFFLEtBRmlDO0FBR3pDQyxNQUFBQSxPQUFPLEVBQUUsQ0FDUjtBQUFDQyxRQUFBQSxTQUFTLEVBQUUsS0FBWjtBQUFtQkMsUUFBQUEsVUFBVSxFQUFFLEtBQS9CO0FBQXNDLGlCQUFTO0FBQS9DLE9BRFEsRUFFUixJ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QUFlLENBQUNLLFVBQWhCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDIzIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBDbGlwYm9hcmRKUywgU2VtYW50aWNMb2NhbGl6YXRpb24sIElucHV0TWFza1BhdHRlcm5zLCBVc2VyTWVzc2FnZSwgZ2xvYmFsVHJhbnNsYXRlICovXG5cbmNvbnN0IGV4dGVuc2lvbnNJbmRleCA9IHtcblx0bWFza0xpc3Q6IG51bGwsXG5cdCRleHRlbnNpb25zTGlzdDogJCgnI2V4dGVuc2lvbnMtdGFibGUnKSxcblx0JGNvbnRlbnRGcmFtZTogJCgnI2NvbnRlbnQtZnJhbWUnKSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQkKCcuYXZhdGFyJykuZWFjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRpZiAoJCh0aGlzKS5hdHRyKCdzcmMnKSA9PT0gJycpIHtcblx0XHRcdFx0JCh0aGlzKS5hdHRyKCdzcmMnLCBgJHtnbG9iYWxSb290VXJsfWFzc2V0cy9pbWcvdW5rbm93blBlcnNvbi5qcGdgKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRleHRlbnNpb25zSW5kZXguaW5pdGlhbGl6ZUlucHV0bWFzaygkKCdpbnB1dC5tb2JpbGUtbnVtYmVyLWlucHV0JykpO1xuXHRcdGV4dGVuc2lvbnNJbmRleC4kZXh0ZW5zaW9uc0xpc3QuRGF0YVRhYmxlKHtcblx0XHRcdGxlbmd0aENoYW5nZTogZmFsc2UsXG5cdFx0XHRwYWdpbmc6IGZhbHNlLFxuXHRcdFx0Y29sdW1uczogW1xuXHRcdFx0XHR7b3JkZXJhYmxlOiBmYWxzZSwgc2VhcmNoYWJsZTogZmFsc2UsIFwid2lkdGhcIjogXCIwXCJ9LFxuXHRcdFx0XHRudWxsLFxuXHRcdFx0XHRudWxsLFxuXHRcdFx0XHRudWxsLFxuXHRcdFx0XHRudWxsLFxuXHRcdFx0XHR7IG9yZGVyYWJsZTogZmFsc2UsIHNlYXJjaGFibGU6IGZhbHNlIH0sXG5cdFx0XHRdLFxuXHRcdFx0YXV0b1dpZHRoOiBmYWxzZSxcblx0XHRcdG9yZGVyOiBbMSwgJ2FzYyddLFxuXHRcdFx0bGFuZ3VhZ2U6IFNlbWFudGljTG9jYWxpemF0aW9uLmRhdGFUYWJsZUxvY2FsaXNhdGlvbixcblx0XHRcdGRyYXdDYWxsYmFjaygpIHtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHQkKCcjYWRkLW5ldy1idXR0b24nKS5hcHBlbmRUbygkKCdkaXYuZWlnaHQuY29sdW1uOmVxKDApJykpO1xuXG5cdFx0JCgnLmV4dGVuc2lvbi1yb3cgdGQnKS5vbignZGJsY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0Y29uc3QgaWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG5cdFx0XHR3aW5kb3cubG9jYXRpb24gPSBgJHtnbG9iYWxSb290VXJsfWV4dGVuc2lvbnMvbW9kaWZ5LyR7aWR9YDtcblx0XHR9KTtcblx0XHRjb25zdCBjbGlwYm9hcmQgPSBuZXcgQ2xpcGJvYXJkSlMoJy5jbGlwYm9hcmQnKTtcblx0XHQkKCcuY2xpcGJvYXJkJykucG9wdXAoe1xuXHRcdFx0b246ICdtYW51YWwnLFxuXHRcdH0pO1xuXHRcdGNsaXBib2FyZC5vbignc3VjY2VzcycsIChlKSA9PiB7XG5cdFx0XHQkKGUudHJpZ2dlcikucG9wdXAoJ3Nob3cnKTtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHQkKGUudHJpZ2dlcikucG9wdXAoJ2hpZGUnKTtcblx0XHRcdH0sIDE1MDApO1xuXHRcdFx0ZS5jbGVhclNlbGVjdGlvbigpO1xuXHRcdH0pO1xuXG5cdFx0Y2xpcGJvYXJkLm9uKCdlcnJvcicsIChlKSA9PiB7XG5cdFx0XHRjb25zb2xlLmVycm9yKCdBY3Rpb246JywgZS5hY3Rpb24pO1xuXHRcdFx0Y29uc29sZS5lcnJvcignVHJpZ2dlcjonLCBlLnRyaWdnZXIpO1xuXHRcdH0pO1xuXHRcdCQoJy5leHRlbnNpb24tcm93IC5jaGVja2JveCcpXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0Y29uc3QgbnVtYmVyID0gJCh0aGlzKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRcdFx0JC5hcGkoe1xuXHRcdFx0XHRcdFx0dXJsOiBgJHtnbG9iYWxSb290VXJsfWV4dGVuc2lvbnMvZW5hYmxlLyR7bnVtYmVyfWAsXG5cdFx0XHRcdFx0XHRvbjogJ25vdycsXG5cdFx0XHRcdFx0XHRvblN1Y2Nlc3MocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcblx0XHRcdFx0XHRcdFx0XHQkKGAjJHtudW1iZXJ9IC5kaXNhYmlsaXR5YCkucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdGNvbnN0IG51bWJlciA9ICQodGhpcykuYXR0cignZGF0YS12YWx1ZScpO1xuXHRcdFx0XHRcdCQuYXBpKHtcblx0XHRcdFx0XHRcdHVybDogYCR7Z2xvYmFsUm9vdFVybH1leHRlbnNpb25zL2Rpc2FibGUvJHtudW1iZXJ9YCxcblx0XHRcdFx0XHRcdG9uOiAnbm93Jyxcblx0XHRcdFx0XHRcdG9uU3VjY2VzcyhyZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuXHRcdFx0XHRcdFx0XHRcdCQoYCMke251bWJlcn0gLmRpc2FiaWxpdHlgKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXG5cdFx0JCgnYm9keScpLm9uKCdjbGljaycsICdhLmRlbGV0ZScsIChlKSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRjb25zdCBleHRlbnNpb25JZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJykuYXR0cignaWQnKTtcblx0XHRcdGV4dGVuc2lvbnNJbmRleC5kZWxldGVFeHRlbnNpb24oZXh0ZW5zaW9uSWQpO1xuXHRcdH0pO1xuXHR9LFxuXHQvKipcblx0ICogRGVsZXRlcyBleHRlbnNpb24gd2l0aCBpZFxuXHQgKiBAcGFyYW0gZXh0ZW5zaW9uSWRcblx0ICovXG5cdGRlbGV0ZUV4dGVuc2lvbihleHRlbnNpb25JZClcblx0e1xuXHRcdCQoJy5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcblx0XHQkLmFwaSh7XG5cdFx0XHR1cmw6IGAke2dsb2JhbFJvb3RVcmx9ZXh0ZW5zaW9ucy9kZWxldGUvJHtleHRlbnNpb25JZH1gLFxuXHRcdFx0b246ICdub3cnLFxuXHRcdFx0c3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcblx0XHRcdFx0Ly8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdCYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwO1xuXHRcdFx0fSxcblx0XHRcdG9uU3VjY2VzcyhyZXNwb25zZSkge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdGV4dGVuc2lvbnNJbmRleC4kZXh0ZW5zaW9uc0xpc3QuZmluZChgdHJbaWQ9JHtleHRlbnNpb25JZH1dYCkucmVtb3ZlKCk7XG5cdFx0XHRcdFx0RXh0ZW5zaW9ucy5jYk9uRGF0YUNoYW5nZWQoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRVc2VyTWVzc2FnZS5zaG93RXJyb3IocmVzcG9uc2UubWVzc2FnZS5lcnJvciwgZ2xvYmFsVHJhbnNsYXRlLmV4X0ltcG9zc2libGVUb0RlbGV0ZUV4dGVuc2lvbiApO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdH0pO1xuXHR9LFxuXHQvKipcblx0ICogTWFrZXMgZm9ybWF0dGVkIG51bWJlcnMgdmlzdWFsaXNhdGlvblxuXHQgKi9cblx0aW5pdGlhbGl6ZUlucHV0bWFzaygkZWwpIHtcblx0XHRpZiAoZXh0ZW5zaW9uc0luZGV4Lm1hc2tMaXN0ID09PSBudWxsKSB7XG5cdFx0XHQvLyBQcmVwYXJlcyB0aGUgdGFibGUgZm9yIHNvcnRcbiBcdFx0XHRleHRlbnNpb25zSW5kZXgubWFza0xpc3QgPSAkLm1hc2tzU29ydChJbnB1dE1hc2tQYXR0ZXJucywgWycjJ10sIC9bMC05XXwjLywgJ21hc2snKTtcblx0XHR9XG5cdFx0JGVsLmlucHV0bWFza3Moe1xuXHRcdFx0aW5wdXRtYXNrOiB7XG5cdFx0XHRcdGRlZmluaXRpb25zOiB7XG5cdFx0XHRcdFx0JyMnOiB7XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3I6ICdbMC05XScsXG5cdFx0XHRcdFx0XHRjYXJkaW5hbGl0eTogMSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9LFxuXHRcdFx0fSxcblx0XHRcdG1hdGNoOiAvWzAtOV0vLFxuXHRcdFx0cmVwbGFjZTogJzknLFxuXHRcdFx0bGlzdDogZXh0ZW5zaW9uc0luZGV4Lm1hc2tMaXN0LFxuXHRcdFx0bGlzdEtleTogJ21hc2snLFxuXHRcdH0pO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRleHRlbnNpb25zSW5kZXguaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==