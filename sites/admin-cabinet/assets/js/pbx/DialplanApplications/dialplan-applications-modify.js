"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, ace, Form, Extensions */

/**
 * The DialplanApplication object.
 *  Manages the operations and behaviors of the Dialplan applications in the UI.
 *
 * @module DialplanApplication
 */
var dialplanApplication = {
  $number: $('#extension'),
  defaultExtension: '',

  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#dialplan-application-form'),
  $typeSelectDropDown: $('#dialplan-application-form .type-select'),
  $tabMenuItems: $('#application-code-menu .item'),
  // Ace editor instance
  editor: '',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.da_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'regExp',
        value: '/^(|[0-9#+\\*|X]{1,64})$/',
        prompt: globalTranslate.da_ValidateExtensionNumber
      }, {
        type: 'empty',
        prompt: globalTranslate.da_ValidateExtensionIsEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.da_ValidateExtensionDouble
      }]
    }
  },

  /**
   * Initializes the DialplanApplication.
   * Sets up tabs, dropdowns, form and Ace editor.
   * Sets up change handlers for extension number and editor contents.
   */
  initialize: function initialize() {
    dialplanApplication.$tabMenuItems.tab();

    if (dialplanApplication.$formObj.form('get value', 'name').length === 0) {
      dialplanApplication.$tabMenuItems.tab('change tab', 'main');
    }

    dialplanApplication.$typeSelectDropDown.dropdown({
      onChange: dialplanApplication.changeAceMode
    }); // Add handler to dynamically check if the input number is available

    dialplanApplication.$number.on('change', function () {
      var newNumber = dialplanApplication.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(dialplanApplication.defaultExtension, newNumber);
    }); // Initialize UI components

    dialplanApplication.initializeForm();
    dialplanApplication.initializeAce();
    dialplanApplication.changeAceMode();
    dialplanApplication.defaultExtension = dialplanApplication.$formObj.form('get value', 'extension'); //  Add handlers for fullscreen mode buttons

    $('.fullscreen-toggle-btn').on('click', function () {
      var container = $(this).siblings('.application-code')[0];
      dialplanApplication.toggleFullScreen(container);
    }); // Add handler to recalculate sizes when exiting fullscreen mode

    document.addEventListener('fullscreenchange', dialplanApplication.adjustEditorHeight);
  },

  /**
   * Enable/disable fullscreen mode for a specific block.
   *
   * @param {HTMLElement} container - The container to expand to fullscreen.
   */
  toggleFullScreen: function toggleFullScreen(container) {
    if (!document.fullscreenElement) {
      container.requestFullscreen()["catch"](function (err) {
        console.error("Error attempting to enable full-screen mode: ".concat(err.message));
      });
    } else {
      document.exitFullscreen();
    }
  },

  /**
   * Recalculate editor heights when the screen mode changes.
   */
  adjustEditorHeight: function adjustEditorHeight() {
    dialplanApplication.editor.resize();
  },

  /**
   * Initializes the Ace editor instance.
   * Sets up Ace editor with a monokai theme and custom options.
   * Attaches change handler to the editor session.
   */
  initializeAce: function initializeAce() {
    var applicationLogic = dialplanApplication.$formObj.form('get value', 'applicationlogic');
    var aceHeight = window.innerHeight - 380;
    var rowsCount = Math.round(aceHeight / 16.3);
    $(window).load(function () {
      $('.application-code').css('min-height', "".concat(aceHeight, "px"));
    });
    dialplanApplication.editor = ace.edit('application-code');
    dialplanApplication.editor.getSession().setValue(applicationLogic);
    dialplanApplication.editor.setTheme('ace/theme/monokai');
    dialplanApplication.editor.resize();
    dialplanApplication.editor.getSession().on('change', function () {
      // Trigger change event to acknowledge the modification
      Form.dataChanged();
    });
    dialplanApplication.editor.setOptions({
      maxLines: rowsCount,
      showPrintMargin: false,
      showLineNumbers: false
    });
  },

  /**
   * Changes the Ace editor mode and settings based on the 'type' form value.
   * If the 'type' is 'php', PHP mode is set, and line numbers are shown.
   * Otherwise, Julia mode is set, and line numbers are hidden.
   * The editor theme is set to Monokai in all cases.
   */
  changeAceMode: function changeAceMode() {
    // Retrieve 'type' value from the form
    var mode = dialplanApplication.$formObj.form('get value', 'type');
    var NewMode;

    if (mode === 'php') {
      // If 'type' is 'php', set the editor mode to PHP and show line numbers
      NewMode = ace.require('ace/mode/php').Mode;
      dialplanApplication.editor.setOptions({
        showLineNumbers: true
      });
    } else {
      // If 'type' is not 'php', set the editor mode to Julia and hide line numbers
      NewMode = ace.require('ace/mode/julia').Mode;
      dialplanApplication.editor.setOptions({
        showLineNumbers: false
      });
    } // Set the new mode and theme for the editor


    dialplanApplication.editor.session.setMode(new NewMode());
    dialplanApplication.editor.setTheme('ace/theme/monokai');
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = dialplanApplication.$formObj.form('get values');
    result.data.applicationlogic = dialplanApplication.editor.getValue();
    return result;
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = dialplanApplication.$formObj;
    Form.url = "".concat(globalRootUrl, "dialplan-applications/save"); // Form submission URL

    Form.validateRules = dialplanApplication.validateRules; // Form validation rules

    Form.cbBeforeSendForm = dialplanApplication.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = dialplanApplication.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Checks if the number is taken by another account
 * @returns {boolean} True if the parameter has the 'hidden' class, false otherwise
 */

$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};
/**
 *  Initialize Dialplan Application modify form on document ready
 */


$(document).ready(function () {
  dialplanApplication.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9EaWFscGxhbkFwcGxpY2F0aW9ucy9kaWFscGxhbi1hcHBsaWNhdGlvbnMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImRpYWxwbGFuQXBwbGljYXRpb24iLCIkbnVtYmVyIiwiJCIsImRlZmF1bHRFeHRlbnNpb24iLCIkZm9ybU9iaiIsIiR0eXBlU2VsZWN0RHJvcERvd24iLCIkdGFiTWVudUl0ZW1zIiwiZWRpdG9yIiwidmFsaWRhdGVSdWxlcyIsIm5hbWUiLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiZGFfVmFsaWRhdGVOYW1lSXNFbXB0eSIsImV4dGVuc2lvbiIsInZhbHVlIiwiZGFfVmFsaWRhdGVFeHRlbnNpb25OdW1iZXIiLCJkYV9WYWxpZGF0ZUV4dGVuc2lvbklzRW1wdHkiLCJkYV9WYWxpZGF0ZUV4dGVuc2lvbkRvdWJsZSIsImluaXRpYWxpemUiLCJ0YWIiLCJmb3JtIiwibGVuZ3RoIiwiZHJvcGRvd24iLCJvbkNoYW5nZSIsImNoYW5nZUFjZU1vZGUiLCJvbiIsIm5ld051bWJlciIsIkV4dGVuc2lvbnMiLCJjaGVja0F2YWlsYWJpbGl0eSIsImluaXRpYWxpemVGb3JtIiwiaW5pdGlhbGl6ZUFjZSIsImNvbnRhaW5lciIsInNpYmxpbmdzIiwidG9nZ2xlRnVsbFNjcmVlbiIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImFkanVzdEVkaXRvckhlaWdodCIsImZ1bGxzY3JlZW5FbGVtZW50IiwicmVxdWVzdEZ1bGxzY3JlZW4iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXhpdEZ1bGxzY3JlZW4iLCJyZXNpemUiLCJhcHBsaWNhdGlvbkxvZ2ljIiwiYWNlSGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJyb3dzQ291bnQiLCJNYXRoIiwicm91bmQiLCJsb2FkIiwiY3NzIiwiYWNlIiwiZWRpdCIsImdldFNlc3Npb24iLCJzZXRWYWx1ZSIsInNldFRoZW1lIiwiRm9ybSIsImRhdGFDaGFuZ2VkIiwic2V0T3B0aW9ucyIsIm1heExpbmVzIiwic2hvd1ByaW50TWFyZ2luIiwic2hvd0xpbmVOdW1iZXJzIiwibW9kZSIsIk5ld01vZGUiLCJyZXF1aXJlIiwiTW9kZSIsInNlc3Npb24iLCJzZXRNb2RlIiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZGF0YSIsImFwcGxpY2F0aW9ubG9naWMiLCJnZXRWYWx1ZSIsImNiQWZ0ZXJTZW5kRm9ybSIsInJlc3BvbnNlIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZXhpc3RSdWxlIiwicGFyYW1ldGVyIiwiaGFzQ2xhc3MiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQU1BLG1CQUFtQixHQUFHO0FBRXhCQyxFQUFBQSxPQUFPLEVBQUVDLENBQUMsQ0FBQyxZQUFELENBRmM7QUFHeEJDLEVBQUFBLGdCQUFnQixFQUFFLEVBSE07O0FBS3hCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFFBQVEsRUFBRUYsQ0FBQyxDQUFDLDRCQUFELENBVGE7QUFXeEJHLEVBQUFBLG1CQUFtQixFQUFFSCxDQUFDLENBQUMseUNBQUQsQ0FYRTtBQWF4QkksRUFBQUEsYUFBYSxFQUFFSixDQUFDLENBQUMsOEJBQUQsQ0FiUTtBQWV4QjtBQUNBSyxFQUFBQSxNQUFNLEVBQUUsRUFoQmdCOztBQWtCeEI7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxhQUFhLEVBQUU7QUFDWEMsSUFBQUEsSUFBSSxFQUFFO0FBQ0ZDLE1BQUFBLFVBQVUsRUFBRSxNQURWO0FBRUZDLE1BQUFBLEtBQUssRUFBRSxDQUNIO0FBQ0lDLFFBQUFBLElBQUksRUFBRSxP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QVFxRSxTQUFSO0FBQUEsU0FBc0JwRixDQUFDLFlBQUtvRixTQUFMLEVBQUQsQ0FBbUJDLFFBQW5CLENBQTRCLFFBQTVCLENBQXRCO0FBQUEsQ0FBckM7QUFFQTtBQUNBO0FBQ0E7OztBQUNBckYsQ0FBQyxDQUFDbUMsUUFBRCxDQUFELENBQVltRCxLQUFaLENBQWtCLFlBQU07QUFDcEJ4RixFQUFBQSxtQkFBbUIsQ0FBQ3FCLFVBQXBCO0FBQ0gsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDIzIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgYWNlLCBGb3JtLCBFeHRlbnNpb25zICovXG5cbi8qKlxuICogVGhlIERpYWxwbGFuQXBwbGljYXRpb24gb2JqZWN0LlxuICogIE1hbmFnZXMgdGhlIG9wZXJhdGlvbnMgYW5kIGJlaGF2aW9ycyBvZiB0aGUgRGlhbHBsYW4gYXBwbGljYXRpb25zIGluIHRoZSBVSS5cbiAqXG4gKiBAbW9kdWxlIERpYWxwbGFuQXBwbGljYXRpb25cbiAqL1xuY29uc3QgZGlhbHBsYW5BcHBsaWNhdGlvbiA9IHtcblxuICAgICRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcbiAgICBkZWZhdWx0RXh0ZW5zaW9uOiAnJyxcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNkaWFscGxhbi1hcHBsaWNhdGlvbi1mb3JtJyksXG5cbiAgICAkdHlwZVNlbGVjdERyb3BEb3duOiAkKCcjZGlhbHBsYW4tYXBwbGljYXRpb24tZm9ybSAudHlwZS1zZWxlY3QnKSxcblxuICAgICR0YWJNZW51SXRlbXM6ICQoJyNhcHBsaWNhdGlvbi1jb2RlLW1lbnUgLml0ZW0nKSxcblxuICAgIC8vIEFjZSBlZGl0b3IgaW5zdGFuY2VcbiAgICBlZGl0b3I6ICcnLFxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0gZmllbGRzIGJlZm9yZSBzdWJtaXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVJ1bGVzOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICduYW1lJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5kYV9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBleHRlbnNpb246IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdleHRlbnNpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZWdFeHAnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJy9eKHxbMC05IytcXFxcKnxYXXsxLDY0fSkkLycsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmRhX1ZhbGlkYXRlRXh0ZW5zaW9uTnVtYmVyLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5kYV9WYWxpZGF0ZUV4dGVuc2lvbklzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdleGlzdFJ1bGVbZXh0ZW5zaW9uLWVycm9yXScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmRhX1ZhbGlkYXRlRXh0ZW5zaW9uRG91YmxlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgRGlhbHBsYW5BcHBsaWNhdGlvbi5cbiAgICAgKiBTZXRzIHVwIHRhYnMsIGRyb3Bkb3ducywgZm9ybSBhbmQgQWNlIGVkaXRvci5cbiAgICAgKiBTZXRzIHVwIGNoYW5nZSBoYW5kbGVycyBmb3IgZXh0ZW5zaW9uIG51bWJlciBhbmQgZWRpdG9yIGNvbnRlbnRzLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uJHRhYk1lbnVJdGVtcy50YWIoKTtcbiAgICAgICAgaWYgKGRpYWxwbGFuQXBwbGljYXRpb24uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ25hbWUnKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uJHRhYk1lbnVJdGVtcy50YWIoJ2NoYW5nZSB0YWInLCAnbWFpbicpO1xuICAgICAgICB9XG4gICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uJHR5cGVTZWxlY3REcm9wRG93bi5kcm9wZG93bih7XG4gICAgICAgICAgICBvbkNoYW5nZTogZGlhbHBsYW5BcHBsaWNhdGlvbi5jaGFuZ2VBY2VNb2RlLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgaGFuZGxlciB0byBkeW5hbWljYWxseSBjaGVjayBpZiB0aGUgaW5wdXQgbnVtYmVyIGlzIGF2YWlsYWJsZVxuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld051bWJlciA9IGRpYWxwbGFuQXBwbGljYXRpb24uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuICAgICAgICAgICAgRXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShkaWFscGxhbkFwcGxpY2F0aW9uLmRlZmF1bHRFeHRlbnNpb24sIG5ld051bWJlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgVUkgY29tcG9uZW50c1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmluaXRpYWxpemVGb3JtKCk7XG4gICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uaW5pdGlhbGl6ZUFjZSgpO1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmNoYW5nZUFjZU1vZGUoKTtcblxuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmRlZmF1bHRFeHRlbnNpb24gPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdleHRlbnNpb24nKTtcblxuICAgICAgICAvLyAgQWRkIGhhbmRsZXJzIGZvciBmdWxsc2NyZWVuIG1vZGUgYnV0dG9uc1xuICAgICAgICAkKCcuZnVsbHNjcmVlbi10b2dnbGUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gJCh0aGlzKS5zaWJsaW5ncygnLmFwcGxpY2F0aW9uLWNvZGUnKVswXTtcbiAgICAgICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24udG9nZ2xlRnVsbFNjcmVlbihjb250YWluZXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgaGFuZGxlciB0byByZWNhbGN1bGF0ZSBzaXplcyB3aGVuIGV4aXRpbmcgZnVsbHNjcmVlbiBtb2RlXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBkaWFscGxhbkFwcGxpY2F0aW9uLmFkanVzdEVkaXRvckhlaWdodCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIGZ1bGxzY3JlZW4gbW9kZSBmb3IgYSBzcGVjaWZpYyBibG9jay5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGNvbnRhaW5lciAtIFRoZSBjb250YWluZXIgdG8gZXhwYW5kIHRvIGZ1bGxzY3JlZW4uXG4gICAgICovXG4gICAgdG9nZ2xlRnVsbFNjcmVlbihjb250YWluZXIpIHtcbiAgICAgICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkge1xuICAgICAgICAgICAgY29udGFpbmVyLnJlcXVlc3RGdWxsc2NyZWVuKCkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBhdHRlbXB0aW5nIHRvIGVuYWJsZSBmdWxsLXNjcmVlbiBtb2RlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJlY2FsY3VsYXRlIGVkaXRvciBoZWlnaHRzIHdoZW4gdGhlIHNjcmVlbiBtb2RlIGNoYW5nZXMuXG4gICAgICovXG4gICAgYWRqdXN0RWRpdG9ySGVpZ2h0KCkge1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5yZXNpemUoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlIEFjZSBlZGl0b3IgaW5zdGFuY2UuXG4gICAgICogU2V0cyB1cCBBY2UgZWRpdG9yIHdpdGggYSBtb25va2FpIHRoZW1lIGFuZCBjdXN0b20gb3B0aW9ucy5cbiAgICAgKiBBdHRhY2hlcyBjaGFuZ2UgaGFuZGxlciB0byB0aGUgZWRpdG9yIHNlc3Npb24uXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUFjZSgpIHtcbiAgICAgICAgY29uc3QgYXBwbGljYXRpb25Mb2dpYyA9IGRpYWxwbGFuQXBwbGljYXRpb24uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2FwcGxpY2F0aW9ubG9naWMnKTtcbiAgICAgICAgY29uc3QgYWNlSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMzgwO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLnJvdW5kKGFjZUhlaWdodCAvIDE2LjMpO1xuICAgICAgICAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcuYXBwbGljYXRpb24tY29kZScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuICAgICAgICB9KTtcbiAgICAgICAgZGlhbHBsYW5BcHBsaWNhdGlvbi5lZGl0b3IgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZScpO1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUoYXBwbGljYXRpb25Mb2dpYyk7XG4gICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uZWRpdG9yLnNldFRoZW1lKCdhY2UvdGhlbWUvbW9ub2thaScpO1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5yZXNpemUoKTtcbiAgICAgICAgZGlhbHBsYW5BcHBsaWNhdGlvbi5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBUcmlnZ2VyIGNoYW5nZSBldmVudCB0byBhY2tub3dsZWRnZSB0aGUgbW9kaWZpY2F0aW9uXG4gICAgICAgICAgICBGb3JtLmRhdGFDaGFuZ2VkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIG1heExpbmVzOiByb3dzQ291bnQsXG4gICAgICAgICAgICBzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuICAgICAgICAgICAgc2hvd0xpbmVOdW1iZXJzOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIEFjZSBlZGl0b3IgbW9kZSBhbmQgc2V0dGluZ3MgYmFzZWQgb24gdGhlICd0eXBlJyBmb3JtIHZhbHVlLlxuICAgICAqIElmIHRoZSAndHlwZScgaXMgJ3BocCcsIFBIUCBtb2RlIGlzIHNldCwgYW5kIGxpbmUgbnVtYmVycyBhcmUgc2hvd24uXG4gICAgICogT3RoZXJ3aXNlLCBKdWxpYSBtb2RlIGlzIHNldCwgYW5kIGxpbmUgbnVtYmVycyBhcmUgaGlkZGVuLlxuICAgICAqIFRoZSBlZGl0b3IgdGhlbWUgaXMgc2V0IHRvIE1vbm9rYWkgaW4gYWxsIGNhc2VzLlxuICAgICAqL1xuICAgIGNoYW5nZUFjZU1vZGUoKSB7XG4gICAgICAgIC8vIFJldHJpZXZlICd0eXBlJyB2YWx1ZSBmcm9tIHRoZSBmb3JtXG4gICAgICAgIGNvbnN0IG1vZGUgPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICd0eXBlJyk7XG4gICAgICAgIGxldCBOZXdNb2RlO1xuXG4gICAgICAgIGlmIChtb2RlID09PSAncGhwJykge1xuICAgICAgICAgICAgLy8gSWYgJ3R5cGUnIGlzICdwaHAnLCBzZXQgdGhlIGVkaXRvciBtb2RlIHRvIFBIUCBhbmQgc2hvdyBsaW5lIG51bWJlcnNcbiAgICAgICAgICAgIE5ld01vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvcGhwJykuTW9kZTtcbiAgICAgICAgICAgIGRpYWxwbGFuQXBwbGljYXRpb24uZWRpdG9yLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIHNob3dMaW5lTnVtYmVyczogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgJ3R5cGUnIGlzIG5vdCAncGhwJywgc2V0IHRoZSBlZGl0b3IgbW9kZSB0byBKdWxpYSBhbmQgaGlkZSBsaW5lIG51bWJlcnNcbiAgICAgICAgICAgIE5ld01vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvanVsaWEnKS5Nb2RlO1xuICAgICAgICAgICAgZGlhbHBsYW5BcHBsaWNhdGlvbi5lZGl0b3Iuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgc2hvd0xpbmVOdW1iZXJzOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRoZSBuZXcgbW9kZSBhbmQgdGhlbWUgZm9yIHRoZSBlZGl0b3JcbiAgICAgICAgZGlhbHBsYW5BcHBsaWNhdGlvbi5lZGl0b3Iuc2Vzc2lvbi5zZXRNb2RlKG5ldyBOZXdNb2RlKCkpO1xuICAgICAgICBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZm9ybSBpcyBzZW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIC0gVGhlIGN1cnJlbnQgc2V0dGluZ3Mgb2YgdGhlIGZvcm1cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSAtIFRoZSB1cGRhdGVkIHNldHRpbmdzIG9mIHRoZSBmb3JtXG4gICAgICovXG4gICAgY2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcbiAgICAgICAgcmVzdWx0LmRhdGEgPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcbiAgICAgICAgcmVzdWx0LmRhdGEuYXBwbGljYXRpb25sb2dpYyA9IGRpYWxwbGFuQXBwbGljYXRpb24uZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBhZnRlciB0aGUgZm9ybSBoYXMgYmVlbiBzZW50LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgYWZ0ZXIgdGhlIGZvcm0gaXMgc2VudFxuICAgICAqL1xuICAgIGNiQWZ0ZXJTZW5kRm9ybShyZXNwb25zZSkge1xuXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBmb3JtIHdpdGggY3VzdG9tIHNldHRpbmdzXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUZvcm0oKSB7XG4gICAgICAgIEZvcm0uJGZvcm1PYmogPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqO1xuICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9ZGlhbHBsYW4tYXBwbGljYXRpb25zL3NhdmVgOyAvLyBGb3JtIHN1Ym1pc3Npb24gVVJMXG4gICAgICAgIEZvcm0udmFsaWRhdGVSdWxlcyA9IGRpYWxwbGFuQXBwbGljYXRpb24udmFsaWRhdGVSdWxlczsgLy8gRm9ybSB2YWxpZGF0aW9uIHJ1bGVzXG4gICAgICAgIEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IGRpYWxwbGFuQXBwbGljYXRpb24uY2JCZWZvcmVTZW5kRm9ybTsgLy8gQ2FsbGJhY2sgYmVmb3JlIGZvcm0gaXMgc2VudFxuICAgICAgICBGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IGRpYWxwbGFuQXBwbGljYXRpb24uY2JBZnRlclNlbmRGb3JtOyAvLyBDYWxsYmFjayBhZnRlciBmb3JtIGlzIHNlbnRcbiAgICAgICAgRm9ybS5pbml0aWFsaXplKCk7XG4gICAgfSxcbn07XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBudW1iZXIgaXMgdGFrZW4gYnkgYW5vdGhlciBhY2NvdW50XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFyYW1ldGVyIGhhcyB0aGUgJ2hpZGRlbicgY2xhc3MsIGZhbHNlIG90aGVyd2lzZVxuICovXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZXhpc3RSdWxlID0gKHZhbHVlLCBwYXJhbWV0ZXIpID0+ICQoYCMke3BhcmFtZXRlcn1gKS5oYXNDbGFzcygnaGlkZGVuJyk7XG5cbi8qKlxuICogIEluaXRpYWxpemUgRGlhbHBsYW4gQXBwbGljYXRpb24gbW9kaWZ5IGZvcm0gb24gZG9jdW1lbnQgcmVhZHlcbiAqL1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIGRpYWxwbGFuQXBwbGljYXRpb24uaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==