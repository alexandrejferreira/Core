"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */

/**
 * Module customFile
 * This module manages file interactions in a UI, such as loading file content from a server and handling user input.
 * @module customFile
 */
var customFile = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#custom-file-form'),

  /**
   * jQuery objects
   * This section defines references to DOM elements that the module interacts with.
   */
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),

  /**
   * jQuery element for the main content container.
   * @type {jQuery}
   */
  $mainContainer: $('#main-content-container'),

  /**
   * Ace editor instances
   * `editor` is for input and `viewer` is for display, and they are initialized in `initializeAce`.
   */
  editor: '',
  viewer: '',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },

  /**
   * Initializes the customFile module.
   * Sets up the dropdown, initializes Ace editor, form, and retrieves file content from the server.
   */
  initialize: function initialize() {
    customFile.$mainContainer.removeClass('container');
    customFile.$typeSelectDropDown.dropdown({
      onChange: function onChange() {
        // Hide or show code depending on the file type
        customFile.hideShowCode(); // Get the content of the file from the server

        customFile.getFileContentFromServer();
      }
    }); // Initialize Ace editor

    customFile.initializeAce(); // Initialize form

    customFile.initializeForm(); // Get the content of the file from the server

    customFile.getFileContentFromServer();
  },

  /**
   * Handles the visibility and content of code based on the 'mode' form value.
   * Adjusts the Ace editor settings accordingly.
   */
  hideShowCode: function hideShowCode() {
    // Calculate ace editor height and rows count
    var aceHeight = window.innerHeight - 475;
    var rowsCount = Math.round(aceHeight / 16.3); // Set minimum height for the code sections on window load
    // $(window).load(function () {

    $('.application-code').css('min-height', "".concat(aceHeight, "px")); //});
    // Retrieve 'mode' value from the form

    var mode = customFile.$formObj.form('get value', 'mode'); // Handle code visibility and content based on the 'mode'

    switch (mode) {
      case 'none':
        // If 'mode' is 'none', show server code and hide custom code
        customFile.viewer.navigateFileStart();
        customFile.$appCodeFromServer.show();
        customFile.$appCode.hide();
        customFile.viewer.setOptions({
          minLines: rowsCount
        });
        customFile.viewer.resize();
        break;

      case 'append':
        // If 'mode' is 'append', show both server and custom code, append custom code to server code
        customFile.$appCodeFromServer.show();
        customFile.viewer.navigateFileEnd();
        customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
        customFile.$appCode.show();
        customFile.editor.setOptions({
          minLines: rowsCount
        });
        customFile.editor.getSession().on('change', function () {
          // Trigger change event to acknowledge the modification
          Form.dataChanged();
        });
        break;

      case 'override':
        // If 'mode' is 'override', show custom code and hide server code, replace server code with custom code
        customFile.editor.navigateFileStart();
        customFile.$appCodeFromServer.hide();
        var changedContent = customFile.$formObj.form('get value', 'content');

        if (changedContent.length > 0) {
          customFile.editor.getSession().setValue(changedContent);
        } else {
          customFile.editor.getSession().setValue(customFile.viewer.getValue());
        }

        customFile.$appCode.show();
        customFile.editor.setOptions({
          minLines: rowsCount
        });
        customFile.editor.resize();
        customFile.editor.getSession().on('change', function () {
          // Trigger change event to acknowledge the modification
          Form.dataChanged();
        });
        break;

      default:
        // Handle any other 'mode' values
        break;
    }
  },

  /**
   * Callback function that handles the response from the server containing the file's content.
   * It will update the 'viewer' with the file's content and adjust the code display.
   */
  cbGetFileContentFromServer: function cbGetFileContentFromServer(response) {
    if (response !== undefined) {
      customFile.viewer.getSession().setValue(response.data.content);
      customFile.hideShowCode();
    }
  },

  /**
   * Fetches file content from the server based on the file path and mode of operation.
   */
  getFileContentFromServer: function getFileContentFromServer() {
    var filePath = customFile.$formObj.form('get value', 'filepath');
    var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
    var data = {
      filename: filePath,
      needOriginal: mode,
      needLogfile: false
    };
    PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
  },

  /**
   * Initializes Ace editor instances for both 'editor' and 'viewer'.
   */
  initializeAce: function initializeAce() {
    var IniMode = ace.require('ace/mode/julia').Mode;

    customFile.viewer = ace.edit('application-code-readonly');
    customFile.viewer.session.setMode(new IniMode());
    customFile.viewer.setTheme('ace/theme/monokai');
    customFile.viewer.setOptions({
      showPrintMargin: false,
      readOnly: true
    });
    customFile.viewer.resize();
    customFile.editor = ace.edit('application-code');
    customFile.editor.setTheme('ace/theme/monokai');
    customFile.editor.session.setMode(new IniMode());
    customFile.editor.setOptions({
      showPrintMargin: false
    });
    customFile.editor.resize();
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = customFile.$formObj.form('get values');

    switch (customFile.$formObj.form('get value', 'mode')) {
      case 'append':
      case 'override':
        result.data.content = customFile.editor.getValue();
        break;

      default:
        result.data.content = '';
    }

    return result;
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = customFile.$formObj;
    Form.url = "".concat(globalRootUrl, "custom-files/save"); // Form submission URL

    Form.validateRules = customFile.validateRules; // Form validation rules

    Form.cbBeforeSendForm = customFile.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = customFile.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
}; // Initialize the custom files modify form when the document is ready.

$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCIkbWFpbkNvbnRhaW5lciIsImVkaXRvciIsInZpZXdlciIsInZhbGlkYXRlUnVsZXMiLCJuYW1lIiwiaWRlbnRpZmllciIsInJ1bGVzIiwidHlwZSIsInByb21wdCIsImdsb2JhbFRyYW5zbGF0ZSIsImNmX1ZhbGlkYXRlTmFtZUlzRW1wdHkiLCJpbml0aWFsaXplIiwicmVtb3ZlQ2xhc3MiLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwiaGlkZVNob3dDb2RlIiwiZ2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyIiwiaW5pdGlhbGl6ZUFjZSIsImluaXRpYWxpemVGb3JtIiwiYWNlSGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJyb3dzQ291bnQiLCJNYXRoIiwicm91bmQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWluTGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImdldFNlc3Npb24iLCJvbiIsIkZvcm0iLCJkYXRhQ2hhbmdlZCIsImNoYW5nZWRDb250ZW50IiwibGVuZ3RoIiwiZ2V0VmFsdWUiLCJjYkdldEZpbGVDb250ZW50RnJvbVNlcnZlciIsInJlc3BvbnNlIiwidW5kZWZpbmVkIiwiZGF0YSIsImNvbnRlbnQiLCJmaWxlUGF0aCIsImZpbGVuYW1lIiwibmVlZE9yaWdpbmFsIiwibmVlZExvZ2ZpbGUiLCJQYnhBcGkiLCJHZXRGaWxlQ29udGVudCIsIkluaU1vZGUiLCJhY2UiLCJyZXF1aXJlIiwiTW9kZSIsImVkaXQiLCJzZXNzaW9uIiwic2V0TW9kZSIsInNldFRoZW1lIiwic2hvd1ByaW50TWFyZ2luIiwicmVhZE9ubHkiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJjYkFmdGVyU2VuZEZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSxVQUFVLEdBQUc7QUFFZjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxRQUFRLEVBQUVDLENBQUMsQ0FBQyxtQkFBRCxDQU5JOztBQVFmO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLG1CQUFtQixFQUFFRCxDQUFDLENBQUMsZ0NBQUQsQ0FaUDtBQWFmRSxFQUFBQSxRQUFRLEVBQUVGLENBQUMsQ0FBQyxtQkFBRCxDQWJJO0FBY2ZHLEVBQUFBLGtCQUFrQixFQUFFSCxDQUFDLENBQUMsNEJBQUQsQ0FkTjs7QUFnQmY7QUFDSjtBQUNBO0FBQ0E7QUFDSUksRUFBQUEsY0FBYyxFQUFFSixDQUFDLENBQUMseUJBQUQsQ0FwQkY7O0FBc0JmO0FBQ0o7QUFDQTtBQUNBO0FBQ0lLLEVBQUFBLE1BQU0sRUFBRSxFQTFCTztBQTJCZkMsRUFBQUEsTUFBTSxFQUFFLEVBM0JPOztBQTZCZjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLGFBQWEsRUFBRTtBQUNYQyxJQUFBQSxJQUFJLEVBQUU7QUFDRkMsTUFBQUEsVUFBVSxFQUFFLFVBRFY7QUFFRkMsTUFBQUEsS0FBSyxFQUFFLENBQ0g7QUFDSUMsUUFBQUEsSUFBSSxFQUFFLE9BRFY7QUFFSUMsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNDO0FBRjVCLE9BREc7QUFGTDtBQURLLEdBbENBOztBQThDZjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxVQWxEZSx3QkFrREY7QUFDVGpCLElBQUFBLFVBQVUsQ0FBQ00sY0FBWCxDQUEwQlksV0FBMUIsQ0FBc0MsV0FBdEM7QUFFQWxCLElBQUFBLFVBQVUsQ0FBQ0csbUJBQVgsQ0FBK0JnQixRQUEvQixDQUF3QztBQUNwQ0MsTUFBQUEsUUFEb0Msc0JBQ3pCO0FBQ1A7QUFDQXBCLFFBQUFBLFVBQVUsQ0FBQ3FCLFlBQVgsR0FGTyxDQUlQOztBQUNBckIsUUFBQUEsVUFBVSxDQUFDc0Isd0JBQVg7QUFDSDtBQVBtQyxLQUF4QyxFQUhTLENBYVQ7O0FBQ0F0QixJQUFBQSxVQUFVLENBQUN1QixhQUFYLEdBZFMsQ0FnQlQ7O0FBQ0F2QixJQUFBQSxVQUFVLENBQUN3QixjQUFYLEdBakJTLENBbUJUOztBQUNBeEIsSUFBQUEsVUFBVSxDQUFDc0Isd0JBQVg7QUFDSCxHQXZFYzs7QUF5RWY7QUFDSjtBQUNBO0FBQ0E7QUFDSUQsRUFBQUEsWUE3RWUsMEJBNkVBO0FBQ1g7QUFDQSxRQUFNSSxTQUFTLEdBQUdDLE1BQU0sQ0FBQ0MsV0FBUCxHQUFxQixHQUF2QztBQUNBLFFBQU1DLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdMLFNBQVMsR0FBRyxJQUF2QixDQUFsQixDQUhXLENBS1g7QUFDQTs7QUFDSXZCLElBQUFBLENBQUMsQ0FBQyxtQkFBRCxDQUFELENBQXVCNkIsR0FBdkIsQ0FBMkIsWUFBM0IsWUFBNENOLFNBQTVDLFNBUE8sQ0FRWDtBQUVBOztBQUNBLFFBQU1PLElBQUksR0FBR2hDLFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQmdDLElBQXBCLENBQXlCLFdBQXpCLEVBQXNDLE1BQXRDLENBQWIsQ0FYVyxDQWFYOztBQUNBLFlBQVFELElBQVI7QUFDSSxXQUFLLE1BQUw7QUFDSTtBQUNBaEMsUUFBQUEsVUFBVSxDQUFDUSxNQUFYLENBQWtCMEIsaUJBQWxCO0FBQ0FsQyxRQUFBQSxVQUFVLENBQUNLLGtCQUFYLENBQThCOEIsSUFBOUI7QUFDQW5DLFFBQUFBLFVBQVUsQ0FBQ0ksUUFBWCxDQUFvQmdDLElBQXBCO0FBQ0FwQyxRQUFBQSxVQUFVLENBQUNRLE1BQVgsQ0FBa0I2QixVQUFsQixDQUE2QjtBQUN6QkMsVUFBQUEsUUFBUSxFQUFFVjtBQURlLFNBQTdCO0FBR0E1QixRQUFBQSxVQUFVLENBQUNRLE1BQVgsQ0FBa0IrQixNQUFsQjtBQUNBOztBQUNKLFdBQUssUUFBTDtBQUNJO0FBQ0F2QyxRQUFBQSxVQUFVLENBQUNLLGtCQUFYLENBQThCOEIsSUFBOUI7QUFDQW5DLFFBQUFBLFVBQVUsQ0FBQ1EsTUFBWCxDQUFrQmdDLGVBQWxCO0FBQ0F4QyxRQUFBQSxVQUFVLENBQUNPLE1BQVgsQ0FBa0JrQyxRQUFsQixDQUEyQnpDLFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQmdDLElBQXBCLENBQXlCLFdBQXpCLEVBQXNDLFNBQXRDLENBQTNCO0FBQ0FqQyxRQUFBQSxVQUFVLENBQUNJLFFBQVgsQ0FBb0IrQixJQUFwQjtBQUNBbkMsUUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCOEIsVUFBbEIsQ0FBNkI7QUFDekJDLFVBQUFBLFFBQVEsRUFBRVY7QUFEZSxTQUE3QjtBQUdBNUIsUUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCbUMsVUFBbEIsR0FBK0JDLEVBQS9CLENBQWtDLFFBQWxDLEVBQTRDLFlBQU07QUFDOUM7QUFDQUMsVUFBQUEsSUFBSSxDQUFDQyxXQUFMO0FBQ0gsU0FIRDtBQUlBOztBQUNKLFdBQUssVUFBTDtBQUNJO0FBQ0E3QyxRQUFBQSxVQUFVLENBQUNPLE1BQVgsQ0FBa0IyQixpQkFBbEI7QUFDQWxDLFFBQUFBLFVBQVUsQ0FBQ0ssa0JBQVgsQ0FBOEIrQixJQUE5QjtBQUNBLFlBQU1VLGNBQWMsR0FBRzlDLFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQmdDLElBQXBCLENBQXlCLFdBQXpCLEVBQXNDLFNBQXRDLENBQXZCOztBQUNBLFlBQUlhLGNBQWMsQ0FBQ0MsTUFBZixHQUF3QixDQUE1QixFQUErQjtBQUMzQi9DLFVBQUFBLFVBQVUsQ0FBQ08sTUFBWCxDQUFrQm1DLFVBQWxCLEdBQStCRCxRQUEvQixDQUF3Q0ssY0FBeEM7QUFDSCxTQUZELE1BRU87QUFDSDlDLFVBQUFBLFVBQVUsQ0FBQ08sTUFBWCxDQUFrQm1DLFVBQWxCLEdBQStCRCxRQUEvQixDQUF3Q3pDLFVBQVUsQ0FBQ1EsTUFBWCxDQUFrQndDLFFBQWxCLEVBQXhDO0FBQ0g7O0FBQ0RoRCxRQUFBQSxVQUFVLENBQUNJLFFBQVgsQ0FBb0IrQixJQUFwQjtBQUNBbkMsUUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCOEIsVUFBbEIsQ0FBNkI7QUFDekJDLFVBQUFBLFFBQVEsRUFBRVY7QUFEZSxTQUE3QjtBQUdBNUIsUUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCZ0MsTUFBbEI7QUFDQXZDLFFBQUFBLFVBQVUsQ0FBQ08sTUFBWCxDQUFrQm1DLFVBQWxCLEdBQStCQyxFQUEvQixDQUFrQyxRQUFsQyxFQUE0QyxZQUFNO0FBQzlDO0FBQ0FDLFVBQUFBLElBQUksQ0FBQ0MsV0FBTDtBQUNILFNBSEQ7QUFJQTs7QUFDSjtBQUNJO0FBQ0E7QUEvQ1I7QUFpREgsR0E1SWM7O0FBOElmO0FBQ0o7QUFDQTtBQUNBO0FBQ0lJLEVBQUFBLDBCQWxKZSxzQ0FrSllDLFFBbEpaLEVBa0pzQjtBQUNqQyxRQUFJQSxRQUFRLEtBQUtDLFNBQWpCLEVBQTRCO0FBQ3hCbkQsTUFBQUEsVUFBVSxDQUFDUSxNQUFYLENBQWtCa0MsVUFBbEIsR0FBK0JELFFBQS9CLENBQXdDUyxRQUFRLENBQUNFLElBQVQsQ0FBY0MsT0FBdEQ7QUFDQXJELE1BQUFBLFVBQVUsQ0FBQ3FCLFlBQVg7QUFDSDtBQUNKLEdBdkpjOztBQXlKZjtBQUNKO0FBQ0E7QUFDSUMsRUFBQUEsd0JBNUplLHNDQTRKWTtBQUN2QixRQUFNZ0MsUUFBUSxHQUFHdEQsVUFBVSxDQUFDQyxRQUFYLENBQW9CZ0MsSUFBcEIsQ0FBeUIsV0FBekIsRUFBc0MsVUFBdEMsQ0FBakI7QUFDQSxRQUFNRCxJQUFJLEdBQUdoQyxVQUFVLENBQUNDLFFBQVgsQ0FBb0JnQyxJQUFwQixDQUF5QixXQUF6QixFQUFzQyxNQUF0QyxNQUFrRCxVQUEvRDtBQUNBLFFBQU1tQixJQUFJLEdBQUc7QUFBQ0csTUFBQUEsUUFBUSxFQUFFRCxRQUFYO0FBQXFCRSxNQUFBQSxZQUFZLEVBQUV4QixJQUFuQztBQUF5Q3lCLE1BQUFBLFdBQVcsRUFBRTtBQUF0RCxLQUFiO0FBQ0FDLElBQUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQlAsSUFBdEIsRUFBNEJwRCxVQUFVLENBQUNpRCwwQkFBdkM7QUFDSCxHQWpLYzs7QUFtS2Y7QUFDSjtBQUNBO0FBQ0kxQixFQUFBQSxhQXRLZSwyQkFzS0M7QUFDWixRQUFNcUMsT0FBTyxHQUFHQyxHQUFHLENBQUNDLE9BQUosQ0FBWSxnQkFBWixFQUE4QkMsSUFBOUM7O0FBQ0EvRCxJQUFBQSxVQUFVLENBQUNRLE1BQVgsR0FBb0JxRCxHQUFHLENBQUNHLElBQUosQ0FBUywyQkFBVCxDQUFwQjtBQUNBaEUsSUFBQUEsVUFBVSxDQUFDUSxNQUFYLENBQWtCeUQsT0FBbEIsQ0FBMEJDLE9BQTFCLENBQWtDLElBQUlOLE9BQUosRUFBbEM7QUFDQTVELElBQUFBLFVBQVUsQ0FBQ1EsTUFBWCxDQUFrQjJELFFBQWxCLENBQTJCLG1CQUEzQjtBQUNBbkUsSUFBQUEsVUFBVSxDQUFDUSxNQUFYLENBQWtCNkIsVUFBbEIsQ0FBNkI7QUFDekIrQixNQUFBQSxlQUFlLEVBQUUsS0FEUTtBQUV6QkMsTUFBQUEsUUFBUSxFQUFFO0FBRmUsS0FBN0I7QUFJQXJFLElBQUFBLFVBQVUsQ0FBQ1EsTUFBWCxDQUFrQitCLE1BQWxCO0FBRUF2QyxJQUFBQSxVQUFVLENBQUNPLE1BQVgsR0FBb0JzRCxHQUFHLENBQUNHLElBQUosQ0FBUyxrQkFBVCxDQUFwQjtBQUNBaEUsSUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCNEQsUUFBbEIsQ0FBMkIsbUJBQTNCO0FBQ0FuRSxJQUFBQSxVQUFVLENBQUNPLE1BQVgsQ0FBa0IwRCxPQUFsQixDQUEwQkMsT0FBMUIsQ0FBa0MsSUFBSU4sT0FBSixFQUFsQztBQUNBNUQsSUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCOEIsVUFBbEIsQ0FBNkI7QUFDekIrQixNQUFBQSxlQUFlLEVBQUU7QUFEUSxLQUE3QjtBQUdBcEUsSUFBQUEsVUFBVSxDQUFDTyxNQUFYLENBQWtCZ0MsTUFBbEI7QUFDSCxHQXhMYzs7QUEwTGY7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNJK0IsRUFBQUEsZ0JBL0xlLDRCQStMRUMsUUEvTEYsRUErTFk7QUFDdkIsUUFBTUMsTUFBTSxHQUFHRCxRQUFmO0FBQ0FDLElBQUFBLE1BQU0sQ0FBQ3BCLElBQVAsR0FBY3BELFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQmdDLElBQXBCLENBQXlCLFlBQXpCLENBQWQ7O0FBQ0EsWUFBUWpDLFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQmdDLElBQXBCLENBQXlCLFdBQXpCLEVBQXNDLE1BQXRDLENBQVI7QUFDSSxXQUFLLFFBQUw7QUFDQSxXQUFLLFVBQUw7QUFDSXVDLFFBQUFBLE1BQU0sQ0FBQ3BCLElBQVAsQ0FBWUMsT0FBWixHQUFzQnJELFVBQVUsQ0FBQ08sTUFBWCxDQUFrQnlDLFFBQWxCLEVBQXRCO0FBQ0E7O0FBQ0o7QUFDSXdCLFFBQUFBLE1BQU0sQ0FBQ3BCLElBQVAsQ0FBWUMsT0FBWixHQUFzQixFQUF0QjtBQU5SOztBQVFBLFdBQU9tQixNQUFQO0FBQ0gsR0EzTWM7O0FBNk1mO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLGVBak5lLDJCQWlOQ3ZCLFFBak5ELEVBaU5XLENBRXpCLENBbk5jOztBQW9OZjtBQUNKO0FBQ0E7QUFDSTFCLEVBQUFBLGNBdk5lLDRCQXVORTtBQUNib0IsSUFBQUEsSUFBSSxDQUFDM0MsUUFBTCxHQUFnQkQsVUFBVSxDQUFDQyxRQUEzQjtBQUNBMkMsSUFBQUEsSUFBSSxDQUFDOEIsR0FBTCxhQUFjQyxhQUFkLHVCQUZhLENBRW1DOztBQUNoRC9CLElBQUFBLElBQUksQ0FBQ25DLGFBQUwsR0FBcUJULFVBQVUsQ0FBQ1MsYUFBaEMsQ0FIYSxDQUdrQzs7QUFDL0NtQyxJQUFBQSxJQUFJLENBQUMwQixnQkFBTCxHQUF3QnRFLFVBQVUsQ0FBQ3NFLGdCQUFuQyxDQUphLENBSXdDOztBQUNyRDFCLElBQUFBLElBQUksQ0FBQzZCLGVBQUwsR0FBdUJ6RSxVQUFVLENBQUN5RSxlQUFsQyxDQUxhLENBS3NDOztBQUNuRDdCLElBQUFBLElBQUksQ0FBQzNCLFVBQUw7QUFDSDtBQTlOYyxDQUFuQixDLENBaU9BOztBQUNBZixDQUFDLENBQUMwRSxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3BCN0UsRUFBQUEsVUFBVSxDQUFDaUIsVUFBWDtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCxnbG9iYWxUcmFuc2xhdGUsIGFjZSwgRm9ybSwgUGJ4QXBpICovXG5cblxuLyoqXG4gKiBNb2R1bGUgY3VzdG9tRmlsZVxuICogVGhpcyBtb2R1bGUgbWFuYWdlcyBmaWxlIGludGVyYWN0aW9ucyBpbiBhIFVJLCBzdWNoIGFzIGxvYWRpbmcgZmlsZSBjb250ZW50IGZyb20gYSBzZXJ2ZXIgYW5kIGhhbmRsaW5nIHVzZXIgaW5wdXQuXG4gKiBAbW9kdWxlIGN1c3RvbUZpbGVcbiAqL1xuY29uc3QgY3VzdG9tRmlsZSA9IHtcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNjdXN0b20tZmlsZS1mb3JtJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgb2JqZWN0c1xuICAgICAqIFRoaXMgc2VjdGlvbiBkZWZpbmVzIHJlZmVyZW5jZXMgdG8gRE9NIGVsZW1lbnRzIHRoYXQgdGhlIG1vZHVsZSBpbnRlcmFjdHMgd2l0aC5cbiAgICAgKi9cbiAgICAkdHlwZVNlbGVjdERyb3BEb3duOiAkKCcjY3VzdG9tLWZpbGUtZm9ybSAudHlwZS1zZWxlY3QnKSxcbiAgICAkYXBwQ29kZTogJCgnI2FwcGxpY2F0aW9uLWNvZGUnKSxcbiAgICAkYXBwQ29kZUZyb21TZXJ2ZXI6ICQoJyNhcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5JyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIG1haW4gY29udGVudCBjb250YWluZXIuXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkbWFpbkNvbnRhaW5lcjogJCgnI21haW4tY29udGVudC1jb250YWluZXInKSxcblxuICAgIC8qKlxuICAgICAqIEFjZSBlZGl0b3IgaW5zdGFuY2VzXG4gICAgICogYGVkaXRvcmAgaXMgZm9yIGlucHV0IGFuZCBgdmlld2VyYCBpcyBmb3IgZGlzcGxheSwgYW5kIHRoZXkgYXJlIGluaXRpYWxpemVkIGluIGBpbml0aWFsaXplQWNlYC5cbiAgICAgKi9cbiAgICBlZGl0b3I6ICcnLFxuICAgIHZpZXdlcjogJycsXG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgZm9ybSBmaWVsZHMgYmVmb3JlIHN1Ym1pc3Npb24uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgICAqL1xuICAgIHZhbGlkYXRlUnVsZXM6IHtcbiAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgaWRlbnRpZmllcjogJ2ZpbGVwYXRoJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jZl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgY3VzdG9tRmlsZSBtb2R1bGUuXG4gICAgICogU2V0cyB1cCB0aGUgZHJvcGRvd24sIGluaXRpYWxpemVzIEFjZSBlZGl0b3IsIGZvcm0sIGFuZCByZXRyaWV2ZXMgZmlsZSBjb250ZW50IGZyb20gdGhlIHNlcnZlci5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICBjdXN0b21GaWxlLiRtYWluQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdjb250YWluZXInKTtcblxuICAgICAgICBjdXN0b21GaWxlLiR0eXBlU2VsZWN0RHJvcERvd24uZHJvcGRvd24oe1xuICAgICAgICAgICAgb25DaGFuZ2UoKSB7XG4gICAgICAgICAgICAgICAgLy8gSGlkZSBvciBzaG93IGNvZGUgZGVwZW5kaW5nIG9uIHRoZSBmaWxlIHR5cGVcbiAgICAgICAgICAgICAgICBjdXN0b21GaWxlLmhpZGVTaG93Q29kZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb250ZW50IG9mIHRoZSBmaWxlIGZyb20gdGhlIHNlcnZlclxuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuZ2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIEFjZSBlZGl0b3JcbiAgICAgICAgY3VzdG9tRmlsZS5pbml0aWFsaXplQWNlKCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBmb3JtXG4gICAgICAgIGN1c3RvbUZpbGUuaW5pdGlhbGl6ZUZvcm0oKTtcblxuICAgICAgICAvLyBHZXQgdGhlIGNvbnRlbnQgb2YgdGhlIGZpbGUgZnJvbSB0aGUgc2VydmVyXG4gICAgICAgIGN1c3RvbUZpbGUuZ2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIHZpc2liaWxpdHkgYW5kIGNvbnRlbnQgb2YgY29kZSBiYXNlZCBvbiB0aGUgJ21vZGUnIGZvcm0gdmFsdWUuXG4gICAgICogQWRqdXN0cyB0aGUgQWNlIGVkaXRvciBzZXR0aW5ncyBhY2NvcmRpbmdseS5cbiAgICAgKi9cbiAgICBoaWRlU2hvd0NvZGUoKSB7XG4gICAgICAgIC8vIENhbGN1bGF0ZSBhY2UgZWRpdG9yIGhlaWdodCBhbmQgcm93cyBjb3VudFxuICAgICAgICBjb25zdCBhY2VIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSA0NzU7XG4gICAgICAgIGNvbnN0IHJvd3NDb3VudCA9IE1hdGgucm91bmQoYWNlSGVpZ2h0IC8gMTYuMyk7XG5cbiAgICAgICAgLy8gU2V0IG1pbmltdW0gaGVpZ2h0IGZvciB0aGUgY29kZSBzZWN0aW9ucyBvbiB3aW5kb3cgbG9hZFxuICAgICAgICAvLyAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcuYXBwbGljYXRpb24tY29kZScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuICAgICAgICAvL30pO1xuXG4gICAgICAgIC8vIFJldHJpZXZlICdtb2RlJyB2YWx1ZSBmcm9tIHRoZSBmb3JtXG4gICAgICAgIGNvbnN0IG1vZGUgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJyk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNvZGUgdmlzaWJpbGl0eSBhbmQgY29udGVudCBiYXNlZCBvbiB0aGUgJ21vZGUnXG4gICAgICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgICAgICAgY2FzZSAnbm9uZSc6XG4gICAgICAgICAgICAgICAgLy8gSWYgJ21vZGUnIGlzICdub25lJywgc2hvdyBzZXJ2ZXIgY29kZSBhbmQgaGlkZSBjdXN0b20gY29kZVxuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUudmlld2VyLm5hdmlnYXRlRmlsZVN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgY3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuJGFwcENvZGUuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUudmlld2VyLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBtaW5MaW5lczogcm93c0NvdW50LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUudmlld2VyLnJlc2l6ZSgpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdhcHBlbmQnOlxuICAgICAgICAgICAgICAgIC8vIElmICdtb2RlJyBpcyAnYXBwZW5kJywgc2hvdyBib3RoIHNlcnZlciBhbmQgY3VzdG9tIGNvZGUsIGFwcGVuZCBjdXN0b20gY29kZSB0byBzZXJ2ZXIgY29kZVxuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLnNob3coKTtcbiAgICAgICAgICAgICAgICBjdXN0b21GaWxlLnZpZXdlci5uYXZpZ2F0ZUZpbGVFbmQoKTtcbiAgICAgICAgICAgICAgICBjdXN0b21GaWxlLmVkaXRvci5zZXRWYWx1ZShjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdjb250ZW50JykpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuZWRpdG9yLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBtaW5MaW5lczogcm93c0NvdW50LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuZWRpdG9yLmdldFNlc3Npb24oKS5vbignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIGNoYW5nZSBldmVudCB0byBhY2tub3dsZWRnZSB0aGUgbW9kaWZpY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgIEZvcm0uZGF0YUNoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ292ZXJyaWRlJzpcbiAgICAgICAgICAgICAgICAvLyBJZiAnbW9kZScgaXMgJ292ZXJyaWRlJywgc2hvdyBjdXN0b20gY29kZSBhbmQgaGlkZSBzZXJ2ZXIgY29kZSwgcmVwbGFjZSBzZXJ2ZXIgY29kZSB3aXRoIGN1c3RvbSBjb2RlXG4gICAgICAgICAgICAgICAgY3VzdG9tRmlsZS5lZGl0b3IubmF2aWdhdGVGaWxlU3RhcnQoKTtcbiAgICAgICAgICAgICAgICBjdXN0b21GaWxlLiRhcHBDb2RlRnJvbVNlcnZlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlZENvbnRlbnQgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdjb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYW5nZWRDb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFZhbHVlKGNoYW5nZWRDb250ZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21GaWxlLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUoY3VzdG9tRmlsZS52aWV3ZXIuZ2V0VmFsdWUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuZWRpdG9yLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBtaW5MaW5lczogcm93c0NvdW50LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGN1c3RvbUZpbGUuZWRpdG9yLnJlc2l6ZSgpXG4gICAgICAgICAgICAgICAgY3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgY2hhbmdlIGV2ZW50IHRvIGFja25vd2xlZGdlIHRoZSBtb2RpZmljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgRm9ybS5kYXRhQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYW55IG90aGVyICdtb2RlJyB2YWx1ZXNcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgdGhlIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciBjb250YWluaW5nIHRoZSBmaWxlJ3MgY29udGVudC5cbiAgICAgKiBJdCB3aWxsIHVwZGF0ZSB0aGUgJ3ZpZXdlcicgd2l0aCB0aGUgZmlsZSdzIGNvbnRlbnQgYW5kIGFkanVzdCB0aGUgY29kZSBkaXNwbGF5LlxuICAgICAqL1xuICAgIGNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjdXN0b21GaWxlLnZpZXdlci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUocmVzcG9uc2UuZGF0YS5jb250ZW50KTtcbiAgICAgICAgICAgIGN1c3RvbUZpbGUuaGlkZVNob3dDb2RlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyBmaWxlIGNvbnRlbnQgZnJvbSB0aGUgc2VydmVyIGJhc2VkIG9uIHRoZSBmaWxlIHBhdGggYW5kIG1vZGUgb2Ygb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIGdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpIHtcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdmaWxlcGF0aCcpO1xuICAgICAgICBjb25zdCBtb2RlID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpICE9PSAnb3ZlcnJpZGUnO1xuICAgICAgICBjb25zdCBkYXRhID0ge2ZpbGVuYW1lOiBmaWxlUGF0aCwgbmVlZE9yaWdpbmFsOiBtb2RlLCBuZWVkTG9nZmlsZTogZmFsc2V9O1xuICAgICAgICBQYnhBcGkuR2V0RmlsZUNvbnRlbnQoZGF0YSwgY3VzdG9tRmlsZS5jYkdldEZpbGVDb250ZW50RnJvbVNlcnZlcik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIEFjZSBlZGl0b3IgaW5zdGFuY2VzIGZvciBib3RoICdlZGl0b3InIGFuZCAndmlld2VyJy5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplQWNlKCkge1xuICAgICAgICBjb25zdCBJbmlNb2RlID0gYWNlLnJlcXVpcmUoJ2FjZS9tb2RlL2p1bGlhJykuTW9kZTtcbiAgICAgICAgY3VzdG9tRmlsZS52aWV3ZXIgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpO1xuICAgICAgICBjdXN0b21GaWxlLnZpZXdlci5zZXNzaW9uLnNldE1vZGUobmV3IEluaU1vZGUoKSk7XG4gICAgICAgIGN1c3RvbUZpbGUudmlld2VyLnNldFRoZW1lKCdhY2UvdGhlbWUvbW9ub2thaScpO1xuICAgICAgICBjdXN0b21GaWxlLnZpZXdlci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIHNob3dQcmludE1hcmdpbjogZmFsc2UsXG4gICAgICAgICAgICByZWFkT25seTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgY3VzdG9tRmlsZS52aWV3ZXIucmVzaXplKCk7XG5cbiAgICAgICAgY3VzdG9tRmlsZS5lZGl0b3IgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZScpO1xuICAgICAgICBjdXN0b21GaWxlLmVkaXRvci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcbiAgICAgICAgY3VzdG9tRmlsZS5lZGl0b3Iuc2Vzc2lvbi5zZXRNb2RlKG5ldyBJbmlNb2RlKCkpO1xuICAgICAgICBjdXN0b21GaWxlLmVkaXRvci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIHNob3dQcmludE1hcmdpbjogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgICBjdXN0b21GaWxlLmVkaXRvci5yZXNpemUoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZm9ybSBpcyBzZW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIC0gVGhlIGN1cnJlbnQgc2V0dGluZ3Mgb2YgdGhlIGZvcm1cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSAtIFRoZSB1cGRhdGVkIHNldHRpbmdzIG9mIHRoZSBmb3JtXG4gICAgICovXG4gICAgY2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcbiAgICAgICAgcmVzdWx0LmRhdGEgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcbiAgICAgICAgc3dpdGNoIChjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJykpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FwcGVuZCc6XG4gICAgICAgICAgICBjYXNlICdvdmVycmlkZSc6XG4gICAgICAgICAgICAgICAgcmVzdWx0LmRhdGEuY29udGVudCA9IGN1c3RvbUZpbGUuZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhLmNvbnRlbnQgPSAnJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGZvcm0gaGFzIGJlZW4gc2VudC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIGFmdGVyIHRoZSBmb3JtIGlzIHNlbnRcbiAgICAgKi9cbiAgICBjYkFmdGVyU2VuZEZvcm0ocmVzcG9uc2UpIHtcblxuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgZm9ybSB3aXRoIGN1c3RvbSBzZXR0aW5nc1xuICAgICAqL1xuICAgIGluaXRpYWxpemVGb3JtKCkge1xuICAgICAgICBGb3JtLiRmb3JtT2JqID0gY3VzdG9tRmlsZS4kZm9ybU9iajtcbiAgICAgICAgRm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWN1c3RvbS1maWxlcy9zYXZlYDsgLy8gRm9ybSBzdWJtaXNzaW9uIFVSTFxuICAgICAgICBGb3JtLnZhbGlkYXRlUnVsZXMgPSBjdXN0b21GaWxlLnZhbGlkYXRlUnVsZXM7IC8vIEZvcm0gdmFsaWRhdGlvbiBydWxlc1xuICAgICAgICBGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQmVmb3JlU2VuZEZvcm07IC8vIENhbGxiYWNrIGJlZm9yZSBmb3JtIGlzIHNlbnRcbiAgICAgICAgRm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQWZ0ZXJTZW5kRm9ybTsgLy8gQ2FsbGJhY2sgYWZ0ZXIgZm9ybSBpcyBzZW50XG4gICAgICAgIEZvcm0uaW5pdGlhbGl6ZSgpO1xuICAgIH0sXG59O1xuXG4vLyBJbml0aWFsaXplIHRoZSBjdXN0b20gZmlsZXMgbW9kaWZ5IGZvcm0gd2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgY3VzdG9tRmlsZS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19