"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */
var customFile = {
  $formObj: $('#custom-file-form'),
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),
  $dirrtyField: $('#dirrty'),
  editor: '',
  viewer: '',
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },
  initialize: function initialize() {
    customFile.$typeSelectDropDown.dropdown({
      onChange: function onChange() {
        customFile.hideShowCode();
        customFile.getFileContentFromServer();
      }
    });
    customFile.initializeAce();
    customFile.initializeForm();
    customFile.getFileContentFromServer();
  },
  hideShowCode: function hideShowCode() {
    var aceHeight = window.innerHeight - 475;
    var rowsCount = Math.round(aceHeight / 16.3);
    $(window).load(function () {
      $('.application-code-readonly').css('min-height', "".concat(aceHeight, "px"));
      $('.application-code').css('min-height', "".concat(aceHeight, "px"));
    });
    var mode = customFile.$formObj.form('get value', 'mode');

    switch (mode) {
      case 'none':
        customFile.viewer.navigateFileStart();
        customFile.$appCodeFromServer.show();
        customFile.$appCode.hide();
        customFile.viewer.setOptions({
          maxLines: rowsCount
        });
        customFile.viewer.resize();
        break;

      case 'append':
        customFile.$appCodeFromServer.show();
        customFile.viewer.navigateFileEnd();
        customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
        customFile.$appCode.show();
        customFile.editor.getSession().on('change', function () {
          customFile.$dirrtyField.val(Math.random());
          customFile.$dirrtyField.trigger('change');
        });
        break;

      case 'override':
        customFile.editor.navigateFileStart();
        customFile.$appCodeFromServer.hide();
        var changedContent = customFile.$formObj.form('get value', 'content');

        if (changedContent.length > 0) {
          customFile.editor.getSession().setValue(changedContent);
        } else {
          customFile.editor.getSession().setValue(customFile.viewer.getValue());
        }

        customFile.$appCode.show();
        customFile.editor.setOptions({
          maxLines: rowsCount
        });
        customFile.editor.resize();
        customFile.editor.getSession().on('change', function () {
          customFile.$dirrtyField.val(Math.random());
          customFile.$dirrtyField.trigger('change');
        });
        break;

      default:
        break;
    }
  },
  cbGetFileContentFromServer: function cbGetFileContentFromServer(response) {
    if (response !== undefined) {
      customFile.viewer.getSession().setValue(response.data.content);
      customFile.hideShowCode();
    }
  },
  getFileContentFromServer: function getFileContentFromServer() {
    var filePath = customFile.$formObj.form('get value', 'filepath');
    var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
    var data = {
      filename: filePath,
      needOriginal: mode,
      needLogfile: false
    };
    PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
  },
  initializeAce: function initializeAce() {
    var IniMode = ace.require('ace/mode/julia').Mode;

    customFile.viewer = ace.edit('application-code-readonly');
    customFile.viewer.session.setMode(new IniMode());
    customFile.viewer.setTheme('ace/theme/monokai');
    customFile.viewer.setOptions({
      showPrintMargin: false,
      readOnly: true
    });
    customFile.viewer.resize();
    customFile.editor = ace.edit('application-code');
    customFile.editor.setTheme('ace/theme/monokai');
    customFile.editor.session.setMode(new IniMode());
    customFile.editor.setOptions({
      showPrintMargin: false
    });
    customFile.editor.resize();
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = customFile.$formObj.form('get values');

    switch (customFile.$formObj.form('get value', 'mode')) {
      case 'append':
      case 'override':
        result.data.content = customFile.editor.getValue();
        break;

      default:
        result.data.content = '';
    }

    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {},
  initializeForm: function initializeForm() {
    Form.$formObj = customFile.$formObj;
    Form.url = "".concat(globalRootUrl, "custom-files/save");
    Form.validateRules = customFile.validateRules;
    Form.cbBeforeSendForm = customFile.cbBeforeSendForm;
    Form.cbAfterSendForm = customFile.cbAfterSendForm;
    Form.initialize();
  }
};
$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCIkZGlycnR5RmllbGQiLCJlZGl0b3IiLCJ2aWV3ZXIiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjZl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJoaWRlU2hvd0NvZGUiLCJnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsInJvd3NDb3VudCIsIk1hdGgiLCJyb3VuZCIsImxvYWQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWF4TGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImdldFNlc3Npb24iLCJvbiIsInZhbCIsInJhbmRvbSIsInRyaWdnZXIiLCJjaGFuZ2VkQ29udGVudCIsImxlbmd0aCIsImdldFZhbHVlIiwiY2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJyZXNwb25zZSIsInVuZGVmaW5lZCIsImRhdGEiLCJjb250ZW50IiwiZmlsZVBhdGgiLCJmaWxlbmFtZSIsIm5lZWRPcmlnaW5hbCIsIm5lZWRMb2dmaWxlIiwiUGJ4QXBpIiwiR2V0RmlsZUNvbnRlbnQiLCJJbmlNb2RlIiwiYWNlIiwicmVxdWlyZSIsIk1vZGUiLCJlZGl0Iiwic2Vzc2lvbiIsInNldE1vZGUiLCJzZXRUaGVtZSIsInNob3dQcmludE1hcmdpbiIsInJlYWRPbmx5IiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiY2JBZnRlclNlbmRGb3JtIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQSxJQUFNQSxVQUFVLEdBQUc7QUFDbEJDLEVBQUFBLFFBQVEsRUFBRUMsQ0FBQyxDQUFDLG1CQUFELENBRE87QUFFbEJDLEVBQUFBLG1CQUFtQixFQUFFRCxDQUFDLENBQUMsZ0NBQUQsQ0FGSjtBQUdsQkUsRUFBQUEsUUFBUSxFQUFFRixDQUFDLENBQUMsbUJBQUQsQ0FITztBQUlsQkcsRUFBQUEsa0JBQWtCLEVBQUVILENBQUMsQ0FBQyw0QkFBRCxDQUpIO0FBS2xCSSxFQUFBQSxZQUFZLEVBQUVKLENBQUMsQ0FBQyxTQUFELENBTEc7QUFNbEJLLEVBQUFBLE1BQU0sRUFBRSxFQU5VO0FBT2xCQyxFQUFBQSxNQUFNLEVBQUUsRUFQVTtBQVFsQkMsRUFBQUEsYUFBYSxFQUFFO0FBQ2RDLElBQUFBLElBQUksRUFBRTtBQUNMQyxNQUFBQSxVQUFVLEVBQUUsVUFEUDtBQUVMQyxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDQyxRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0M7QUFGekIsT0FETTtBQUZGO0FBRFEsR0FSRztBQW1CbEJDLEVBQUFBLFVBbkJrQix3QkFtQkw7QUFDWmpCLElBQUFBLFVBQVUsQ0FBQ0csbUJBQVgsQ0FBK0JlLFFBQS9CLENBQXdDO0FBQ3ZDQyxNQUFBQSxRQUR1QyxzQkFDNUI7QUFDVm5CLFFBQUFBLFVBQVUsQ0FBQ29CLFlBQVg7QUFDQXBCLFFBQUFBLFVBQVUsQ0FBQ3FCLHdCQUFYO0FBQ0E7QUFKc0MsS0FB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ZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCxnbG9iYWxUcmFuc2xhdGUsIGFjZSwgRm9ybSwgUGJ4QXBpICovXG5cbmNvbnN0IGN1c3RvbUZpbGUgPSB7XG5cdCRmb3JtT2JqOiAkKCcjY3VzdG9tLWZpbGUtZm9ybScpLFxuXHQkdHlwZVNlbGVjdERyb3BEb3duOiAkKCcjY3VzdG9tLWZpbGUtZm9ybSAudHlwZS1zZWxlY3QnKSxcblx0JGFwcENvZGU6ICQoJyNhcHBsaWNhdGlvbi1jb2RlJyksXG5cdCRhcHBDb2RlRnJvbVNlcnZlcjogJCgnI2FwcGxpY2F0aW9uLWNvZGUtcmVhZG9ubHknKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdGVkaXRvcjogJycsXG5cdHZpZXdlcjogJycsXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRuYW1lOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZmlsZXBhdGgnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY2ZfVmFsaWRhdGVOYW1lSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRjdXN0b21GaWxlLiR0eXBlU2VsZWN0RHJvcERvd24uZHJvcGRvd24oe1xuXHRcdFx0b25DaGFuZ2UoKSB7XG5cdFx0XHRcdGN1c3RvbUZpbGUuaGlkZVNob3dDb2RlKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZ2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0Y3VzdG9tRmlsZS5pbml0aWFsaXplQWNlKCk7XG5cdFx0Y3VzdG9tRmlsZS5pbml0aWFsaXplRm9ybSgpO1xuXHRcdGN1c3RvbUZpbGUuZ2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCk7XG5cdH0sXG5cdGhpZGVTaG93Q29kZSgpIHtcblx0XHRjb25zdCBhY2VIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQtNDc1O1xuXHRcdGNvbnN0IHJvd3NDb3VudCA9IE1hdGgucm91bmQoYWNlSGVpZ2h0LzE2LjMpO1xuXHRcdCQod2luZG93KS5sb2FkKGZ1bmN0aW9uKCkge1xuXHRcdFx0JCgnLmFwcGxpY2F0aW9uLWNvZGUtcmVhZG9ubHknKS5jc3MoJ21pbi1oZWlnaHQnLCBgJHthY2VIZWlnaHR9cHhgKTtcblx0XHRcdCQoJy5hcHBsaWNhdGlvbi1jb2RlJykuY3NzKCdtaW4taGVpZ2h0JywgYCR7YWNlSGVpZ2h0fXB4YCk7XG5cdFx0fSk7XG5cdFx0Y29uc3QgbW9kZSA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ21vZGUnKTtcblx0XHRzd2l0Y2ggKG1vZGUpIHtcblx0XHRcdGNhc2UgJ25vbmUnOlxuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5uYXZpZ2F0ZUZpbGVTdGFydCgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlRnJvbVNlcnZlci5zaG93KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGUuaGlkZSgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRPcHRpb25zKHtcblx0XHRcdFx0XHRtYXhMaW5lczogcm93c0NvdW50LFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIucmVzaXplKClcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdhcHBlbmQnOlxuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlRnJvbVNlcnZlci5zaG93KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLm5hdmlnYXRlRmlsZUVuZCgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRWYWx1ZShjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdjb250ZW50JykpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdvdmVycmlkZSc6XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLm5hdmlnYXRlRmlsZVN0YXJ0KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLmhpZGUoKTtcblx0XHRcdFx0Y29uc3QgY2hhbmdlZENvbnRlbnQgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdjb250ZW50Jyk7XG5cdFx0XHRcdGlmIChjaGFuZ2VkQ29udGVudC5sZW5ndGg+MCl7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFZhbHVlKGNoYW5nZWRDb250ZW50KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUoY3VzdG9tRmlsZS52aWV3ZXIuZ2V0VmFsdWUoKSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZS5zaG93KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldE9wdGlvbnMoe1xuXHRcdFx0XHRcdG1heExpbmVzOiByb3dzQ291bnQsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5yZXNpemUoKVxuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5nZXRTZXNzaW9uKCkub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdFx0XHRjdXN0b21GaWxlLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSxcblx0Y2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIocmVzcG9uc2UpIHtcblx0XHRpZiAocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIuZ2V0U2Vzc2lvbigpLnNldFZhbHVlKHJlc3BvbnNlLmRhdGEuY29udGVudCk7XG5cdFx0XHRjdXN0b21GaWxlLmhpZGVTaG93Q29kZSgpO1xuXHRcdH1cblx0fSxcblx0Z2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCkge1xuXHRcdGNvbnN0IGZpbGVQYXRoID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZmlsZXBhdGgnKTtcblx0XHRjb25zdCBtb2RlID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpICE9PSAnb3ZlcnJpZGUnO1xuXHRcdGNvbnN0IGRhdGEgPSB7IGZpbGVuYW1lOiBmaWxlUGF0aCwgbmVlZE9yaWdpbmFsOiBtb2RlLCBuZWVkTG9nZmlsZTogZmFsc2UgfTtcblx0XHRQYnhBcGkuR2V0RmlsZUNvbnRlbnQoZGF0YSwgY3VzdG9tRmlsZS5jYkdldEZpbGVDb250ZW50RnJvbVNlcnZlcik7XG5cdH0sXG5cdGluaXRpYWxpemVBY2UoKSB7XG5cdFx0Y29uc3QgSW5pTW9kZSA9IGFjZS5yZXF1aXJlKCdhY2UvbW9kZS9qdWxpYScpLk1vZGU7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRPcHRpb25zKHtcblx0XHRcdHNob3dQcmludE1hcmdpbjogZmFsc2UsXG5cdFx0XHRyZWFkT25seTogdHJ1ZVxuXHRcdH0pO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnJlc2l6ZSgpO1xuXG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3IgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZScpO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldFRoZW1lKCdhY2UvdGhlbWUvbW9ub2thaScpO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRPcHRpb25zKHtcblx0XHRcdHNob3dQcmludE1hcmdpbjogZmFsc2UsXG5cdFx0fSk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3IucmVzaXplKCk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHN3aXRjaCAoY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpKSB7XG5cdFx0XHRjYXNlICdhcHBlbmQnOlxuXHRcdFx0Y2FzZSAnb3ZlcnJpZGUnOlxuXHRcdFx0XHRyZXN1bHQuZGF0YS5jb250ZW50ID0gY3VzdG9tRmlsZS5lZGl0b3IuZ2V0VmFsdWUoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXN1bHQuZGF0YS5jb250ZW50ID0gJyc7XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gY3VzdG9tRmlsZS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y3VzdG9tLWZpbGVzL3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGN1c3RvbUZpbGUudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0Y3VzdG9tRmlsZS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19