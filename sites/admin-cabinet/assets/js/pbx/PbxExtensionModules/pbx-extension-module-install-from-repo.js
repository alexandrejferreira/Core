"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2024 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, PbxApi, globalPBXLicense, globalTranslate, UserMessage, globalPBXVersion, installStatusLoopWorker */

/**
 * Represents list of extension modules.
 * @class instalationFromRepo
 * @memberof module:PbxExtensionModules
 */
var installationFromRepo = {
  pbxVersion: globalPBXVersion.replace(/-dev/i, ''),
  pbxLicense: globalPBXLicense.trim(),

  /**
   * jQuery object for the button which responsible for update all installed modules
   * @type {jQuery}
   */
  $btnUpdateAllModules: $('#update-all-modules-button'),

  /**
   * The progress bar block.
   * @type {jQuery}
   */
  $progressBarBlock: $('#upload-progress-bar-block'),

  /**
   * Initialize extensionModules list
   */
  initialize: function initialize() {
    installationFromRepo.initializeButtonEvents();
    installationFromRepo.$progressBarBlock.hide();
    installationFromRepo.$btnUpdateAllModules.hide(); // Until at least one update available
  },
  initializeButtonEvents: function initializeButtonEvents() {
    /**
     * Event handler for the download link click event.
     * @param {Event} e - The click event object.
     */
    $(document).on('click', 'a.download, a.update', function (e) {
      e.preventDefault();
      $('a.button').addClass('disabled');
      var $currentButton = $(e.target).closest('a.button');
      var params = {
        uniqid: $currentButton.data('uniqid'),
        releaseId: $currentButton.data('releaseid'),
        channelId: installStatusLoopWorker.channelId
      };
      $("#modal-".concat(params.uniqid)).modal('hide');
      var $moduleButtons = $("a[data-uniqid=".concat(params.uniqid));
      $moduleButtons.removeClass('disabled');
      $moduleButtons.find('i').removeClass('download').removeClass('redo').addClass('spinner loading');
      installStatusLoopWorker.updateProgressBar(params.uniqid, globalTranslate.ext_GetReleaseInProgress, 0);
      $('tr.table-error-messages').remove();
      $('tr.error').removeClass('error');

      if (installationFromRepo.pbxLicense === '') {
        window.location = "".concat(globalRootUrl, "pbx-extension-modules/index#/licensing");
      } else {
        PbxApi.ModulesInstallFromRepo(params, function (response) {
          console.log(response);
          installStatusLoopWorker.initialize();
        });
      }
    });
    installationFromRepo.$btnUpdateAllModules.on('click', installationFromRepo.updateAllModules);
  },

  /**
   * Callback function after click on the update all modules button
   */
  updateAllModules: function updateAllModules(e) {
    e.preventDefault();
    $('a.button').addClass('disabled');
    var $currentButton = $(e.target).closest('a');
    $currentButton.removeClass('disabled');
    $currentButton.closest('i.icon').removeClass('redo').addClass('spinner loading');
    var params = {
      channelId: installStatusLoopWorker.channelId
    };
    PbxApi.ModulesUpdateAll(params, function (response) {
      console.log(response);
      installStatusLoopWorker.initialize();
    });
  }
}; // When the document is ready, initialize the external modules table

$(document).ready(function () {
  installationFromRepo.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9QYnhFeHRlbnNpb25Nb2R1bGVzL3BieC1leHRlbnNpb24tbW9kdWxlLWluc3RhbGwtZnJvbS1yZXBvLmpzIl0sIm5hbWVzIjpbImluc3RhbGxhdGlvbkZyb21SZXBvIiwicGJ4VmVyc2lvbiIsImdsb2JhbFBCWFZlcnNpb24iLCJyZXBsYWNlIiwicGJ4TGljZW5zZSIsImdsb2JhbFBCWExpY2Vuc2UiLCJ0cmltIiwiJGJ0blVwZGF0ZUFsbE1vZHVsZXMiLCIkIiwiJHByb2dyZXNzQmFyQmxvY2siLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZUJ1dHRvbkV2ZW50cyIsImhpZGUiLCJkb2N1bWVudCIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCIkY3VycmVudEJ1dHRvbiIsInRhcmdldCIsImNsb3Nlc3QiLCJwYXJhbXMiLCJ1bmlxaWQiLCJkYXRhIiwicmVsZWFzZUlkIiwiY2hhbm5lbElkIiwiaW5zdGFsbFN0YXR1c0xvb3BXb3JrZXIiLCJtb2RhbCIsIiRtb2R1bGVCdXR0b25zIiwicmVtb3ZlQ2xhc3MiLCJmaW5kIiwidXBkYXRlUHJvZ3Jlc3NCYXIiLCJnbG9iYWxUcmFuc2xhdGUiLCJleHRfR2V0UmVsZWFzZUluUHJvZ3Jlc3MiLCJyZW1vdmUiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImdsb2JhbFJvb3RVcmwiLCJQYnhBcGkiLCJNb2R1bGVzSW5zdGFsbEZyb21SZXBvIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwidXBkYXRlQWxsTW9kdWxlcyIsIk1vZHVsZXNVcGRhdGVBbGwiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSxvQkFBb0IsR0FBRztBQUV6QkMsRUFBQUEsVUFBVSxF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QkF5RVI1QixDQXpFUSxFQXlFTjtBQUNmQSxJQUFBQSxDQUFDLENBQUNDLGNBQUY7QUFDQVIsSUFBQUEsQ0FBQyxDQUFDLFVBQUQsQ0FBRCxDQUFjUyxRQUFkLENBQXVCLFVBQXZCO0FBQ0EsUUFBTUMsY0FBYyxHQUFHVixDQUFDLENBQUNPLENBQUMsQ0FBQ0ksTUFBSCxDQUFELENBQVlDLE9BQVosQ0FBb0IsR0FBcEIsQ0FBdkI7QUFDQUYsSUFBQUEsY0FBYyxDQUFDVyxXQUFmLENBQTJCLFVBQTNCO0FBQ0FYLElBQUFBLGNBQWMsQ0FBQ0UsT0FBZixDQUF1QixRQUF2QixFQUNLUyxXQURMLENBQ2lCLE1BRGpCLEVBRUtaLFFBRkwsQ0FFYyxpQkFGZDtBQUdBLFFBQU1JLE1BQU0sR0FBRztBQUNYSSxNQUFBQSxTQUFTLEVBQUVDLHVCQUF1QixDQUFDRDtBQUR4QixLQUFmO0FBR0FhLElBQUFBLE1BQU0sQ0FBQ00sZ0JBQVAsQ0FBd0J2QixNQUF4QixFQUFnQyxVQUFDbUIsUUFBRCxFQUFjO0FBQzFDQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsUUFBWjtBQUNBZCxNQUFBQSx1QkFBdUIsQ0FBQ2hCLFVBQXhCO0FBQ0gsS0FIRDtBQUlIO0FBeEZ3QixDQUE3QixDLENBNEZBOztBQUNBRixDQUFDLENBQUNLLFFBQUQsQ0FBRCxDQUFZZ0MsS0FBWixDQUFrQixZQUFNO0FBQ3BCN0MsRUFBQUEsb0JBQW9CLENBQUNVLFVBQXJCO0FBQ0gsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDI0IEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBQYnhBcGksIGdsb2JhbFBCWExpY2Vuc2UsIGdsb2JhbFRyYW5zbGF0ZSwgVXNlck1lc3NhZ2UsIGdsb2JhbFBCWFZlcnNpb24sIGluc3RhbGxTdGF0dXNMb29wV29ya2VyICovXG5cbi8qKlxuICogUmVwcmVzZW50cyBsaXN0IG9mIGV4dGVuc2lvbiBtb2R1bGVzLlxuICogQGNsYXNzIGluc3RhbGF0aW9uRnJvbVJlcG9cbiAqIEBtZW1iZXJvZiBtb2R1bGU6UGJ4RXh0ZW5zaW9uTW9kdWxlc1xuICovXG5jb25zdCBpbnN0YWxsYXRpb25Gcm9tUmVwbyA9IHtcblxuICAgIHBieFZlcnNpb246IGdsb2JhbFBCWFZlcnNpb24ucmVwbGFjZSgvLWRldi9pLCAnJyksXG5cbiAgICBwYnhMaWNlbnNlOiBnbG9iYWxQQlhMaWNlbnNlLnRyaW0oKSxcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBidXR0b24gd2hpY2ggcmVzcG9uc2libGUgZm9yIHVwZGF0ZSBhbGwgaW5zdGFsbGVkIG1vZHVsZXNcbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRidG5VcGRhdGVBbGxNb2R1bGVzOiAkKCcjdXBkYXRlLWFsbC1tb2R1bGVzLWJ1dHRvbicpLFxuXG4gICAgLyoqXG4gICAgICogVGhlIHByb2dyZXNzIGJhciBibG9jay5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRwcm9ncmVzc0JhckJsb2NrOiAkKCcjdXBsb2FkLXByb2dyZXNzLWJhci1ibG9jaycpLFxuXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGV4dGVuc2lvbk1vZHVsZXMgbGlzdFxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGluc3RhbGxhdGlvbkZyb21SZXBvLmluaXRpYWxpemVCdXR0b25FdmVudHMoKTtcblxuICAgICAgICBpbnN0YWxsYXRpb25Gcm9tUmVwby4kcHJvZ3Jlc3NCYXJCbG9jay5oaWRlKCk7XG4gICAgICAgIGluc3RhbGxhdGlvbkZyb21SZXBvLiRidG5VcGRhdGVBbGxNb2R1bGVzLmhpZGUoKTsgLy8gVW50aWwgYXQgbGVhc3Qgb25lIHVwZGF0ZSBhdmFpbGFibGVcbiAgICB9LFxuXG4gICAgaW5pdGlhbGl6ZUJ1dHRvbkV2ZW50cygpe1xuICAgICAgICAvKipcbiAgICAgICAgICogRXZlbnQgaGFuZGxlciBmb3IgdGhlIGRvd25sb2FkIGxpbmsgY2xpY2sgZXZlbnQuXG4gICAgICAgICAqIEBwYXJhbSB7RXZlbnR9IGUgLSBUaGUgY2xpY2sgZXZlbnQgb2JqZWN0LlxuICAgICAgICAgKi9cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywnYS5kb3dubG9hZCwgYS51cGRhdGUnLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJCgnYS5idXR0b24nKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIGNvbnN0ICRjdXJyZW50QnV0dG9uID0gJChlLnRhcmdldCkuY2xvc2VzdCgnYS5idXR0b24nKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICB1bmlxaWQ6ICRjdXJyZW50QnV0dG9uLmRhdGEoJ3VuaXFpZCcpLFxuICAgICAgICAgICAgICAgIHJlbGVhc2VJZDogJGN1cnJlbnRCdXR0b24uZGF0YSgncmVsZWFzZWlkJyksXG4gICAgICAgICAgICAgICAgY2hhbm5lbElkOiBpbnN0YWxsU3RhdHVzTG9vcFdvcmtlci5jaGFubmVsSWRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICQoYCNtb2RhbC0ke3BhcmFtcy51bmlxaWR9YCkubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgICAgIGNvbnN0ICRtb2R1bGVCdXR0b25zID0gJChgYVtkYXRhLXVuaXFpZD0ke3BhcmFtcy51bmlxaWR9YCk7XG5cbiAgICAgICAgICAgICRtb2R1bGVCdXR0b25zLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgJG1vZHVsZUJ1dHRvbnMuZmluZCgnaScpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdkb3dubG9hZCcpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdyZWRvJylcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3NwaW5uZXIgbG9hZGluZycpO1xuXG4gICAgICAgICAgICBpbnN0YWxsU3RhdHVzTG9vcFdvcmtlci51cGRhdGVQcm9ncmVzc0JhcihwYXJhbXMudW5pcWlkLCBnbG9iYWxUcmFuc2xhdGUuZXh0X0dldFJlbGVhc2VJblByb2dyZXNzLCAwKTtcblxuICAgICAgICAgICAgJCgndHIudGFibGUtZXJyb3ItbWVzc2FnZXMnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoJ3RyLmVycm9yJykucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICBpZiAoaW5zdGFsbGF0aW9uRnJvbVJlcG8ucGJ4TGljZW5zZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBgJHtnbG9iYWxSb290VXJsfXBieC1leHRlbnNpb24tbW9kdWxlcy9pbmRleCMvbGljZW5zaW5nYDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgUGJ4QXBpLk1vZHVsZXNJbnN0YWxsRnJvbVJlcG8ocGFyYW1zLCAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBpbnN0YWxsU3RhdHVzTG9vcFdvcmtlci5pbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGluc3RhbGxhdGlvbkZyb21SZXBvLiRidG5VcGRhdGVBbGxNb2R1bGVzLm9uKCdjbGljaycsIGluc3RhbGxhdGlvbkZyb21SZXBvLnVwZGF0ZUFsbE1vZHVsZXMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBhZnRlciBjbGljayBvbiB0aGUgdXBkYXRlIGFsbCBtb2R1bGVzIGJ1dHRvblxuICAgICAqL1xuICAgIHVwZGF0ZUFsbE1vZHVsZXMoZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgJCgnYS5idXR0b24nKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgY29uc3QgJGN1cnJlbnRCdXR0b24gPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdhJyk7XG4gICAgICAgICRjdXJyZW50QnV0dG9uLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAkY3VycmVudEJ1dHRvbi5jbG9zZXN0KCdpLmljb24nKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdyZWRvJylcbiAgICAgICAgICAgIC5hZGRDbGFzcygnc3Bpbm5lciBsb2FkaW5nJyk7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgIGNoYW5uZWxJZDogaW5zdGFsbFN0YXR1c0xvb3BXb3JrZXIuY2hhbm5lbElkXG4gICAgICAgIH07XG4gICAgICAgIFBieEFwaS5Nb2R1bGVzVXBkYXRlQWxsKHBhcmFtcywgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICBpbnN0YWxsU3RhdHVzTG9vcFdvcmtlci5pbml0aWFsaXplKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbn07XG5cbi8vIFdoZW4gdGhlIGRvY3VtZW50IGlzIHJlYWR5LCBpbml0aWFsaXplIHRoZSBleHRlcm5hbCBtb2R1bGVzIHRhYmxlXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgaW5zdGFsbGF0aW9uRnJvbVJlcG8uaW5pdGlhbGl6ZSgpO1xufSk7XG4iXX0=