"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2024 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, PbxApi, globalTranslate */

/**
 * Represents the extension module popup.
 * @class extensionModuleDetail
 * @memberof module:PbxExtensionModules
 */
var extensionModuleDetail = {
  /**
   * jQuery object for the module detail form.
   * @type {jQuery}
   */
  $moduleDetailPopupTpl: $('#module-details-template'),

  /**
   * jQuery object for the module detail form.
   * @type {jQuery}
   */
  $moduleDetailPopup: undefined,

  /**
   * Initialize extensionModuleDetail
   */
  initialize: function initialize() {
    // The table rows which activate a detail popup.
    $(document).on('click', 'tr.new-module-row', function (event) {
      event.preventDefault();
      var params = {};
      var $target = $(event.target);

      if ($target.closest('td').hasClass('show-details-on-click')) {
        params.uniqid = $target.closest('tr').data('id');

        if (params.uniqid !== undefined) {
          // Module detail popup form
          extensionModuleDetail.$moduleDetailPopup = extensionModuleDetail.$moduleDetailPopupTpl.clone(true);
          extensionModuleDetail.$moduleDetailPopup.attr('id', 'modal-' + params.uniqid); // Show the popup

          extensionModuleDetail.$moduleDetailPopup.modal({
            position: 'center',
            closable: true
          }).modal('show');
          PbxApi.ModulesGetModuleInfo(params, extensionModuleDetail.cbAfterGetModuleDetails);
        }
      }
    });
  },
  initializeSlider: function initializeSlider(modalForm) {
    modalForm.find('.slides .right').on('click', function () {
      modalForm.find('.slide').siblings('.active:not(:last-of-type)').removeClass('active').next().addClass('active');
    });
    modalForm.find('.slides .left').on('click', function () {
      modalForm.find('.slide').siblings('.active:not(:first-of-type)').removeClass('active').prev().addClass('active');
    });
  },
  cbAfterGetModuleDetails: function cbAfterGetModuleDetails(result, response) {
    if (result) {
      var repoData = response.data;
      var $newPopup = extensionModuleDetail.$moduleDetailPopup; // Module name

      if (repoData.name !== undefined) {
        $newPopup.find('.module-name').text(repoData.name);
      } // Module logo


      if (repoData.logotype && repoData.logotype !== '') {
        $newPopup.find('.module-logo').attr('src', repoData.logotype);
      } else {
        $newPopup.find('.module-logo').replaceWith('<i class="icon puzzle"></i>');
      } // Module uniqid


      if (repoData.uniqid !== undefined) {
        $newPopup.find('.module-id').text(repoData.uniqid); // Install last release button

        $newPopup.find('.main-install-button').data('uniqid', repoData.uniqid);
      } // Total count of installations


      if (repoData.downloads !== undefined) {
        $newPopup.find('.module-count-installed').html(repoData.downloads);
      } // Last release version


      if (repoData.releases[0].version !== undefined) {
        $newPopup.find('.module-latest-release').text(repoData.releases[0].version);
        var currentVersion = $("tr.module-row[data-id=".concat(repoData.uniqid, "]")).data('version');

        if (currentVersion !== undefined) {
          $('a.main-install-button span.button-text').text(globalTranslate.ext_UpdateModuleShort);
        }
      } // Developer


      var developerView = extensionModuleDetail.prepareDeveloperView(repoData);
      $newPopup.find('.module-publisher').html(developerView); // Commercial

      if (repoData.commercial !== undefined) {
        var commercialView = extensionModuleDetail.prepareCommercialView(repoData.commercial);
        $newPopup.find('.module-commercial').html(commercialView);
      } // Release size


      if (repoData.releases[0].size !== undefined) {
        var sizeText = extensionModuleDetail.convertBytesToReadableFormat(repoData.releases[0].size);
        $newPopup.find('.module-latest-release-size').text(sizeText);
      } // Screenshots


      if (repoData.screenshots !== undefined && repoData.screenshots.length > 0) {
        var screenshotsView = extensionModuleDetail.prepareScreenshotsView(repoData.screenshots);
        $newPopup.find('.module-screenshots').html(screenshotsView);
      } else {
        $newPopup.find('.module-screenshots').remove();
      } // Description


      var descriptionView = extensionModuleDetail.prepareDescriptionView(repoData);
      $newPopup.find('.module-description').html(descriptionView); // Changelog

      var changelogView = extensionModuleDetail.prepareChangeLogView(repoData);
      $newPopup.find('.module-changelog').html(changelogView); // Initialize images slider

      extensionModuleDetail.initializeSlider($newPopup); // Total count of installations

      if (repoData.eula) {
        $newPopup.find('.module-eula').html(UserMessage.convertToText(repoData.eula));
      } else {
        $newPopup.find('a[data-tab="eula"]').hide();
      } // Initialize tab menu


      $newPopup.find('.module-details-menu .item').tab();
      $newPopup.find('.dimmer').removeClass('active');
    }
  },
  convertBytesToReadableFormat: function convertBytesToReadableFormat(bytes) {
    var megabytes = bytes / (1024 * 1024);
    var roundedMegabytes = megabytes.toFixed(2);
    return "".concat(roundedMegabytes, " Mb");
  },
  prepareCommercialView: function prepareCommercialView(commercial) {
    if (commercial === '1') {
      return '<i class="ui donate icon"></i> ' + globalTranslate.ext_CommercialModule;
    }

    return '<i class="puzzle piece icon"></i> ' + globalTranslate.ext_FreeModule;
  },
  prepareScreenshotsView: function prepareScreenshotsView(screenshots) {
    var html = '            <div class="ui container slides">\n' + '                <i class="big left angle icon"></i>\n' + '                <i class="big right angle icon"></i>';
    $.each(screenshots, function (index, screenshot) {
      if (index > 0) {
        html += "<div class=\"slide\"><img class=\"ui fluid image\" src=\"".concat(screenshot.url, "\" alt=\"").concat(screenshot.name, "\"></div>");
      } else {
        html += "<div class=\"slide active\"><img class=\"ui fluid image\" src=\"".concat(screenshot.url, "\" alt=\"").concat(screenshot.name, "\"></div>");
      }
    });
    html += '</div>';
    return html;
  },
  prepareDescriptionView: function prepareDescriptionView(repoData) {
    var html = "<div class=\"ui header\">".concat(repoData.name, "</div>");
    html += "<p>".concat(repoData.description, "</p>");
    html += "<div class=\"ui header\">".concat(globalTranslate.ext_UsefulLinks, "</div>");
    html += '<ul class="ui list">';
    html += "<li class=\"item\"><a href=\"".concat(repoData.promo_link, "\" target=\"_blank\">").concat(globalTranslate.ext_ExternalDescription, "</a></li>");
    html += '</ul>';
    return html;
  },
  prepareDeveloperView: function prepareDeveloperView(repoData) {
    var html = '';
    html += "".concat(repoData.developer);
    return html;
  },
  prepareChangeLogView: function prepareChangeLogView(repoData) {
    var html = '';
    $.each(repoData.releases, function (index, release) {
      var sizeText = extensionModuleDetail.convertBytesToReadableFormat(release.size);
      var changeLogText = UserMessage.convertToText(release.changelog);
      html += "<div class=\"ui header\">".concat(globalTranslate.ext_InstallModuleReleaseTag, ": ").concat(release.version, "</div>");
      html += "<div class=\"\"><i class=\"icon grey download\"></i> ".concat(release.downloads, "</div>");
      html += "<p>".concat(changeLogText, "</p>");
      html += "<a href=\"#\" class=\"ui icon labeled basic blue button download\"\n               data-uniqid = \"".concat(repoData.uniqid, "\"\n               data-releaseid =\"").concat(release.releaseID, "\">\n                <i class=\"icon download\"></i>\n                ").concat(globalTranslate.ext_InstallModuleVersion, " ").concat(release.version, " (").concat(sizeText, ")\n            </a>");
    });
    return html;
  }
}; // When the document is ready, initialize the external modules detail page

$(document).ready(function () {
  extensionModuleDetail.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9QYnhFeHRlbnNpb25Nb2R1bGVzL3BieC1leHRlbnNpb24tbW9kdWxlLWRldGFpbC5qcyJdLCJuYW1lcyI6WyJleHRlbnNpb25Nb2R1bGVEZXRhaWwiLCIkbW9kdWxlRGV0YWlsUG9wdXBUcGwiLCIkIiwiJG1vZHVsZURldGFpbFBvcHVwIiwidW5kZWZpbmVkIiwiaW5pdGlhbGl6ZSIsImRvY3VtZW50Iiwib24iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwicGFyYW1zIiwiJHRhcmdldCIsInRhcmdldCIsImNsb3Nlc3QiLCJoYXNDbGFzcyIsInVuaXFpZCIsImRhdGEiLCJjbG9uZSIsImF0dHIiLCJtb2RhbCIsInBvc2l0aW9uIiwiY2xvc2FibGUiLCJQYnhBcGkiLCJNb2R1bGVzR2V0TW9kdWxlSW5mbyIsImNiQWZ0ZXJHZXRNb2R1bGVEZXRhaWxzIiwiaW5pdGlhbGl6ZVNsaWRlciIsIm1vZGFsRm9ybSIsImZpbmQiLCJzaWJsaW5ncyIsInJlbW92ZUNsYXNzIiwibmV4dCIsImFkZENsYXNzIiwicHJldiIsInJlc3VsdCIsInJlc3BvbnNlIiwicmVwb0RhdGEiLCIkbmV3UG9wdXAiLCJuYW1lIiwidGV4dCIsImxvZ290eXBlIiwicmVwbGFjZVdpdGgiLCJkb3dubG9hZHMiLCJodG1sIiwicmVsZWFzZXMiLCJ2ZXJzaW9uIiwiY3VycmVudFZlcnNpb24iLCJnbG9iYWxUcmFuc2xhdGUiLCJleHRfVXBkYXRlTW9kdWxlU2hvcnQiLCJkZXZlbG9wZXJWaWV3IiwicHJlcGFyZURldmVsb3BlclZpZXciLCJjb21tZXJjaWFsIiwiY29tbWVyY2lhbFZpZXciLCJwcmVwYXJlQ29tbWVyY2lhbFZpZXciLCJzaXplIiwic2l6ZVRleHQiLCJjb252ZXJ0Qnl0ZXNUb1JlYWRhYmxlRm9ybWF0Iiwic2NyZWVuc2hvdHMiLCJsZW5ndGgiLCJzY3JlZW5zaG90c1ZpZXciLCJwcmVwYXJlU2NyZWVuc2hvdHNWaWV3IiwicmVtb3ZlIiwiZGVzY3JpcHRpb25WaWV3IiwicHJlcGFyZURlc2NyaXB0aW9uVmlldyIsImNoYW5nZWxvZ1ZpZXciLCJwcmVwYXJlQ2hhbmdlTG9nVmlldyIsImV1bGEiLCJVc2VyTWVzc2FnZSIsImNvbnZlcnRUb1RleHQiLCJoaWRlIiwidGFiIiwiYnl0ZXMiLCJtZWdhYnl0ZXMiLCJyb3VuZGVkTWVnYWJ5dGVzIiwidG9GaXhlZCIsImV4dF9Db21tZXJjaWFsTW9kdWxlIiwiZXh0X0ZyZWVNb2R1bGUiLCJlYWNoIiwiaW5kZXgiLCJzY3JlZW5zaG90IiwidXJsIiwiZGVzY3JpcHRpb24iLCJleHRfVXNlZnVsTGlua3MiLCJwcm9tb19saW5rIiwiZXh0X0V4dGVybmFsRGVzY3JpcHRpb24iLCJkZXZlbG9wZXIiLCJyZWxlYXNlIiwiY2hhbmdlTG9nVGV4dCIsImNoYW5nZWxvZyIsImV4dF9JbnN0YWxsTW9kdWxlUmVsZWFzZVRhZyIsInJlbGVhc2VJRCIsImV4dF9JbnN0YWxsTW9kdWxlVmVyc2lvbiIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQU1BLHFCQUFxQixHQUFHO0FBQzFCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLHFCQUFxQixFQUFFQyxDQUFDLENBQUMsMEJBQUQsQ0FMRTs7QUFPMUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsa0JBQWtCLEVBQUVDLFNBWE07O0FBYzFCO0FBQ0o7QUFDQTtBQUNJQyxFQUFBQSxVQWpCMEIsd0JBaUJiO0FBQ1Q7QUFDQUgsSUFBQUEsQ0FBQyxDQUFDSSxRQUFELENBQUQsQ0FBWUMsRUFBWixDQUFlLE9BQWYsRUFBd0IsbUJBQXhCLEVBQTZDLFVBQUNDLEtBQUQsRUFBUztBQUNsREEsTUFBQUEsS0FBSyxDQUFDQyxjQUFOO0FBQ0EsVUFBTUMsTUFBTSxH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QVEsQ0FBQ2lELFNBQWhCLENBQUo7QUFDQSxXQUFPMUMsSUFBUDtBQUNILEdBN0x5QjtBQThMMUJzQixFQUFBQSxvQkE5TDBCLGdDQThMTDdCLFFBOUxLLEVBOExLO0FBQzNCLFFBQUlPLElBQUksR0FBRyxFQUFYO0FBQ0F4QyxJQUFBQSxDQUFDLENBQUMwRSxJQUFGLENBQU96QyxRQUFRLENBQUNRLFFBQWhCLEVBQTBCLFVBQVVrQyxLQUFWLEVBQWlCUSxPQUFqQixFQUEwQjtBQUNoRCxVQUFNL0IsUUFBUSxHQUFHdEQscUJBQXFCLENBQUN1RCw0QkFBdEIsQ0FBbUQ4QixPQUFPLENBQUNoQyxJQUEzRCxDQUFqQjtBQUNBLFVBQU1pQyxhQUFhLEdBQUdwQixXQUFXLENBQUNDLGFBQVosQ0FBMEJrQixPQUFPLENBQUNFLFNBQWxDLENBQXRCO0FBQ0E3QyxNQUFBQSxJQUFJLHVDQUE0QkksZUFBZSxDQUFDMEMsMkJBQTVDLGVBQTRFSCxPQUFPLENBQUN6QyxPQUFwRixXQUFKO0FBQ0FGLE1BQUFBLElBQUksbUVBQXNEMkMsT0FBTyxDQUFDNUMsU0FBOUQsV0FBSjtBQUNBQyxNQUFBQSxJQUFJLGlCQUFRNEMsYUFBUixTQUFKO0FBQ0E1QyxNQUFBQSxJQUFJLGlIQUNnQlAsUUFBUSxDQUFDcEIsTUFEekIsa0RBRWtCc0UsT0FBTyxDQUFDSSxTQUYxQixtRkFJRTNDLGVBQWUsQ0FBQzRDLHdCQUpsQixjQUk4Q0wsT0FBTyxDQUFDekMsT0FKdEQsZUFJa0VVLFFBSmxFLHdCQUFKO0FBTUgsS0FaRDtBQWFBLFdBQU9aLElBQVA7QUFDSDtBQTlNeUIsQ0FBOUIsQyxDQWlOQTs7QUFDQXhDLENBQUMsQ0FBQ0ksUUFBRCxDQUFELENBQVlxRixLQUFaLENBQWtCLFlBQU07QUFDcEIzRixFQUFBQSxxQkFBcUIsQ0FBQ0ssVUFBdEI7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjQgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIFBieEFwaSwgZ2xvYmFsVHJhbnNsYXRlICovXG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgZXh0ZW5zaW9uIG1vZHVsZSBwb3B1cC5cbiAqIEBjbGFzcyBleHRlbnNpb25Nb2R1bGVEZXRhaWxcbiAqIEBtZW1iZXJvZiBtb2R1bGU6UGJ4RXh0ZW5zaW9uTW9kdWxlc1xuICovXG5jb25zdCBleHRlbnNpb25Nb2R1bGVEZXRhaWwgPSB7XG4gICAgLyoqXG4gICAgICogalF1ZXJ5IG9iamVjdCBmb3IgdGhlIG1vZHVsZSBkZXRhaWwgZm9ybS5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRtb2R1bGVEZXRhaWxQb3B1cFRwbDogJCgnI21vZHVsZS1kZXRhaWxzLXRlbXBsYXRlJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgb2JqZWN0IGZvciB0aGUgbW9kdWxlIGRldGFpbCBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJG1vZHVsZURldGFpbFBvcHVwOiB1bmRlZmluZWQsXG5cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgZXh0ZW5zaW9uTW9kdWxlRGV0YWlsXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgLy8gVGhlIHRhYmxlIHJvd3Mgd2hpY2ggYWN0aXZhdGUgYSBkZXRhaWwgcG9wdXAuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICd0ci5uZXctbW9kdWxlLXJvdycsIChldmVudCk9PntcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7fTtcbiAgICAgICAgICAgIGNvbnN0ICR0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgICAgICBpZiAoJHRhcmdldC5jbG9zZXN0KCd0ZCcpLmhhc0NsYXNzKCdzaG93LWRldGFpbHMtb24tY2xpY2snKSl7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVuaXFpZCA9ICR0YXJnZXQuY2xvc2VzdCgndHInKS5kYXRhKCdpZCcpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMudW5pcWlkIT09dW5kZWZpbmVkKXtcblxuICAgICAgICAgICAgICAgICAgICAvLyBNb2R1bGUgZGV0YWlsIHBvcHVwIGZvcm1cbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uTW9kdWxlRGV0YWlsLiRtb2R1bGVEZXRhaWxQb3B1cCA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC4kbW9kdWxlRGV0YWlsUG9wdXBUcGwuY2xvbmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZURldGFpbC4kbW9kdWxlRGV0YWlsUG9wdXAuYXR0cignaWQnLCAnbW9kYWwtJytwYXJhbXMudW5pcWlkKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBwb3B1cFxuICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25Nb2R1bGVEZXRhaWwuJG1vZHVsZURldGFpbFBvcHVwXG4gICAgICAgICAgICAgICAgICAgICAgICAubW9kYWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAubW9kYWwoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgUGJ4QXBpLk1vZHVsZXNHZXRNb2R1bGVJbmZvKHBhcmFtcywgZXh0ZW5zaW9uTW9kdWxlRGV0YWlsLmNiQWZ0ZXJHZXRNb2R1bGVEZXRhaWxzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgaW5pdGlhbGl6ZVNsaWRlcihtb2RhbEZvcm0pe1xuICAgICAgICBtb2RhbEZvcm0uZmluZCgnLnNsaWRlcyAucmlnaHQnKVxuICAgICAgICAgICAgLm9uKCdjbGljaycsICgpPT4ge1xuICAgICAgICAgICAgICAgIG1vZGFsRm9ybS5maW5kKCcuc2xpZGUnKVxuICAgICAgICAgICAgICAgICAgICAuc2libGluZ3MoJy5hY3RpdmU6bm90KDpsYXN0LW9mLXR5cGUpJylcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAubmV4dCgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBtb2RhbEZvcm0uZmluZCgnLnNsaWRlcyAubGVmdCcpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgKCk9PiB7XG4gICAgICAgICAgICAgICAgbW9kYWxGb3JtLmZpbmQoJy5zbGlkZScpXG4gICAgICAgICAgICAgICAgICAgIC5zaWJsaW5ncygnLmFjdGl2ZTpub3QoOmZpcnN0LW9mLXR5cGUpJylcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAucHJldigpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuICAgIGNiQWZ0ZXJHZXRNb2R1bGVEZXRhaWxzKHJlc3VsdCwgcmVzcG9uc2UpIHtcbiAgICAgICAgaWYocmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zdCByZXBvRGF0YSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgICAgICAgIGNvbnN0ICRuZXdQb3B1cCA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC4kbW9kdWxlRGV0YWlsUG9wdXA7XG5cbiAgICAgICAgICAgIC8vIE1vZHVsZSBuYW1lXG4gICAgICAgICAgICBpZiAocmVwb0RhdGEubmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtbmFtZScpLnRleHQocmVwb0RhdGEubmFtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1vZHVsZSBsb2dvXG4gICAgICAgICAgICBpZiAocmVwb0RhdGEubG9nb3R5cGUgJiYgcmVwb0RhdGEubG9nb3R5cGUhPT0nJykge1xuICAgICAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcubW9kdWxlLWxvZ28nKS5hdHRyKCdzcmMnLCByZXBvRGF0YS5sb2dvdHlwZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcubW9kdWxlLWxvZ28nKS5yZXBsYWNlV2l0aCgnPGkgY2xhc3M9XCJpY29uIHB1enpsZVwiPjwvaT4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTW9kdWxlIHVuaXFpZFxuICAgICAgICAgICAgaWYgKHJlcG9EYXRhLnVuaXFpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtaWQnKS50ZXh0KHJlcG9EYXRhLnVuaXFpZCk7XG5cbiAgICAgICAgICAgICAgICAvLyBJbnN0YWxsIGxhc3QgcmVsZWFzZSBidXR0b25cbiAgICAgICAgICAgICAgICAkbmV3UG9wdXAuZmluZCgnLm1haW4taW5zdGFsbC1idXR0b24nKS5kYXRhKCd1bmlxaWQnLCByZXBvRGF0YS51bmlxaWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUb3RhbCBjb3VudCBvZiBpbnN0YWxsYXRpb25zXG4gICAgICAgICAgICBpZiAocmVwb0RhdGEuZG93bmxvYWRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkbmV3UG9wdXAuZmluZCgnLm1vZHVsZS1jb3VudC1pbnN0YWxsZWQnKS5odG1sKHJlcG9EYXRhLmRvd25sb2Fkcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExhc3QgcmVsZWFzZSB2ZXJzaW9uXG4gICAgICAgICAgICBpZiAocmVwb0RhdGEucmVsZWFzZXNbMF0udmVyc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtbGF0ZXN0LXJlbGVhc2UnKS50ZXh0KHJlcG9EYXRhLnJlbGVhc2VzWzBdLnZlcnNpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWZXJzaW9uID0gJChgdHIubW9kdWxlLXJvd1tkYXRhLWlkPSR7cmVwb0RhdGEudW5pcWlkfV1gKS5kYXRhKCd2ZXJzaW9uJyk7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWZXJzaW9uIT09dW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICAgICAgJCgnYS5tYWluLWluc3RhbGwtYnV0dG9uIHNwYW4uYnV0dG9uLXRleHQnKS50ZXh0KGdsb2JhbFRyYW5zbGF0ZS5leHRfVXBkYXRlTW9kdWxlU2hvcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV2ZWxvcGVyXG4gICAgICAgICAgICBjb25zdCBkZXZlbG9wZXJWaWV3ID0gZXh0ZW5zaW9uTW9kdWxlRGV0YWlsLnByZXBhcmVEZXZlbG9wZXJWaWV3KHJlcG9EYXRhKTtcbiAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcubW9kdWxlLXB1Ymxpc2hlcicpLmh0bWwoZGV2ZWxvcGVyVmlldyk7XG5cbiAgICAgICAgICAgIC8vIENvbW1lcmNpYWxcbiAgICAgICAgICAgIGlmIChyZXBvRGF0YS5jb21tZXJjaWFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21tZXJjaWFsVmlldyA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC5wcmVwYXJlQ29tbWVyY2lhbFZpZXcocmVwb0RhdGEuY29tbWVyY2lhbCk7XG4gICAgICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtY29tbWVyY2lhbCcpLmh0bWwoY29tbWVyY2lhbFZpZXcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZWxlYXNlIHNpemVcbiAgICAgICAgICAgIGlmIChyZXBvRGF0YS5yZWxlYXNlc1swXS5zaXplICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzaXplVGV4dCA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC5jb252ZXJ0Qnl0ZXNUb1JlYWRhYmxlRm9ybWF0KHJlcG9EYXRhLnJlbGVhc2VzWzBdLnNpemUpO1xuICAgICAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcubW9kdWxlLWxhdGVzdC1yZWxlYXNlLXNpemUnKS50ZXh0KHNpemVUZXh0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2NyZWVuc2hvdHNcbiAgICAgICAgICAgIGlmIChyZXBvRGF0YS5zY3JlZW5zaG90cyAhPT0gdW5kZWZpbmVkICYmIHJlcG9EYXRhLnNjcmVlbnNob3RzLmxlbmd0aD4wKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyZWVuc2hvdHNWaWV3ID0gZXh0ZW5zaW9uTW9kdWxlRGV0YWlsLnByZXBhcmVTY3JlZW5zaG90c1ZpZXcocmVwb0RhdGEuc2NyZWVuc2hvdHMpO1xuICAgICAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcubW9kdWxlLXNjcmVlbnNob3RzJykuaHRtbChzY3JlZW5zaG90c1ZpZXcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbmV3UG9wdXAuZmluZCgnLm1vZHVsZS1zY3JlZW5zaG90cycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZXNjcmlwdGlvblxuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb25WaWV3ID0gZXh0ZW5zaW9uTW9kdWxlRGV0YWlsLnByZXBhcmVEZXNjcmlwdGlvblZpZXcocmVwb0RhdGEpO1xuICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtZGVzY3JpcHRpb24nKS5odG1sKGRlc2NyaXB0aW9uVmlldyk7XG5cbiAgICAgICAgICAgIC8vIENoYW5nZWxvZ1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlbG9nVmlldyA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC5wcmVwYXJlQ2hhbmdlTG9nVmlldyhyZXBvRGF0YSk7XG4gICAgICAgICAgICAkbmV3UG9wdXAuZmluZCgnLm1vZHVsZS1jaGFuZ2Vsb2cnKS5odG1sKGNoYW5nZWxvZ1ZpZXcpO1xuXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIGltYWdlcyBzbGlkZXJcbiAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZURldGFpbC5pbml0aWFsaXplU2xpZGVyKCRuZXdQb3B1cCk7XG5cbiAgICAgICAgICAgIC8vIFRvdGFsIGNvdW50IG9mIGluc3RhbGxhdGlvbnNcbiAgICAgICAgICAgIGlmIChyZXBvRGF0YS5ldWxhKSB7XG4gICAgICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtZXVsYScpLmh0bWwoVXNlck1lc3NhZ2UuY29udmVydFRvVGV4dChyZXBvRGF0YS5ldWxhKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCdhW2RhdGEtdGFiPVwiZXVsYVwiXScpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0YWIgbWVudVxuICAgICAgICAgICAgJG5ld1BvcHVwLmZpbmQoJy5tb2R1bGUtZGV0YWlscy1tZW51IC5pdGVtJykudGFiKCk7XG5cbiAgICAgICAgICAgICRuZXdQb3B1cC5maW5kKCcuZGltbWVyJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAgY29udmVydEJ5dGVzVG9SZWFkYWJsZUZvcm1hdChieXRlcykge1xuICAgICAgICBjb25zdCBtZWdhYnl0ZXMgPSBieXRlcyAvICgxMDI0KjEwMjQpO1xuICAgICAgICBjb25zdCByb3VuZGVkTWVnYWJ5dGVzID0gbWVnYWJ5dGVzLnRvRml4ZWQoMik7XG4gICAgICAgIHJldHVybiBgJHtyb3VuZGVkTWVnYWJ5dGVzfSBNYmA7XG4gICAgfSxcbiAgICBwcmVwYXJlQ29tbWVyY2lhbFZpZXcoY29tbWVyY2lhbCkge1xuICAgICAgICBpZihjb21tZXJjaWFsPT09JzEnKXtcbiAgICAgICAgICAgIHJldHVybiAnPGkgY2xhc3M9XCJ1aSBkb25hdGUgaWNvblwiPjwvaT4gJytnbG9iYWxUcmFuc2xhdGUuZXh0X0NvbW1lcmNpYWxNb2R1bGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICc8aSBjbGFzcz1cInB1enpsZSBwaWVjZSBpY29uXCI+PC9pPiAnK2dsb2JhbFRyYW5zbGF0ZS5leHRfRnJlZU1vZHVsZTtcbiAgICB9LFxuICAgIHByZXBhcmVTY3JlZW5zaG90c1ZpZXcoc2NyZWVuc2hvdHMpIHtcbiAgICAgICAgbGV0IGh0bWwgPVxuICAgICAgICAgICAgJyAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1aSBjb250YWluZXIgc2xpZGVzXCI+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiYmlnIGxlZnQgYW5nbGUgaWNvblwiPjwvaT5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJiaWcgcmlnaHQgYW5nbGUgaWNvblwiPjwvaT4nO1xuICAgICAgICAkLmVhY2goc2NyZWVuc2hvdHMsIGZ1bmN0aW9uIChpbmRleCwgc2NyZWVuc2hvdCkge1xuICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCJzbGlkZVwiPjxpbWcgY2xhc3M9XCJ1aSBmbHVpZCBpbWFnZVwiIHNyYz1cIiR7c2NyZWVuc2hvdC51cmx9XCIgYWx0PVwiJHtzY3JlZW5zaG90Lm5hbWV9XCI+PC9kaXY+YDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz1cInNsaWRlIGFjdGl2ZVwiPjxpbWcgY2xhc3M9XCJ1aSBmbHVpZCBpbWFnZVwiIHNyYz1cIiR7c2NyZWVuc2hvdC51cmx9XCIgYWx0PVwiJHtzY3JlZW5zaG90Lm5hbWV9XCI+PC9kaXY+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7XG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG4gICAgcHJlcGFyZURlc2NyaXB0aW9uVmlldyhyZXBvRGF0YSkge1xuICAgICAgICBsZXQgaHRtbCA9IGA8ZGl2IGNsYXNzPVwidWkgaGVhZGVyXCI+JHtyZXBvRGF0YS5uYW1lfTwvZGl2PmA7XG4gICAgICAgIGh0bWwgKz0gYDxwPiR7cmVwb0RhdGEuZGVzY3JpcHRpb259PC9wPmA7XG4gICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCJ1aSBoZWFkZXJcIj4ke2dsb2JhbFRyYW5zbGF0ZS5leHRfVXNlZnVsTGlua3N9PC9kaXY+YDtcbiAgICAgICAgaHRtbCArPSAnPHVsIGNsYXNzPVwidWkgbGlzdFwiPic7XG4gICAgICAgIGh0bWwgKz0gYDxsaSBjbGFzcz1cIml0ZW1cIj48YSBocmVmPVwiJHtyZXBvRGF0YS5wcm9tb19saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7Z2xvYmFsVHJhbnNsYXRlLmV4dF9FeHRlcm5hbERlc2NyaXB0aW9ufTwvYT48L2xpPmA7XG4gICAgICAgIGh0bWwgKz0gJzwvdWw+JztcbiAgICAgICAgcmV0dXJuIGh0bWw7XG4gICAgfSxcbiAgICBwcmVwYXJlRGV2ZWxvcGVyVmlldyhyZXBvRGF0YSkge1xuICAgICAgICBsZXQgaHRtbCA9ICcnO1xuICAgICAgICBodG1sICs9IGAke3JlcG9EYXRhLmRldmVsb3Blcn1gO1xuICAgICAgICByZXR1cm4gaHRtbDtcbiAgICB9LFxuICAgIHByZXBhcmVDaGFuZ2VMb2dWaWV3KHJlcG9EYXRhKSB7XG4gICAgICAgIGxldCBodG1sID0gJyc7XG4gICAgICAgICQuZWFjaChyZXBvRGF0YS5yZWxlYXNlcywgZnVuY3Rpb24gKGluZGV4LCByZWxlYXNlKSB7XG4gICAgICAgICAgICBjb25zdCBzaXplVGV4dCA9IGV4dGVuc2lvbk1vZHVsZURldGFpbC5jb252ZXJ0Qnl0ZXNUb1JlYWRhYmxlRm9ybWF0KHJlbGVhc2Uuc2l6ZSk7XG4gICAgICAgICAgICBjb25zdCBjaGFuZ2VMb2dUZXh0ID0gVXNlck1lc3NhZ2UuY29udmVydFRvVGV4dChyZWxlYXNlLmNoYW5nZWxvZyk7XG4gICAgICAgICAgICBodG1sKz1gPGRpdiBjbGFzcz1cInVpIGhlYWRlclwiPiR7Z2xvYmFsVHJhbnNsYXRlLmV4dF9JbnN0YWxsTW9kdWxlUmVsZWFzZVRhZ306ICR7cmVsZWFzZS52ZXJzaW9ufTwvZGl2PmA7XG4gICAgICAgICAgICBodG1sKz1gPGRpdiBjbGFzcz1cIlwiPjxpIGNsYXNzPVwiaWNvbiBncmV5IGRvd25sb2FkXCI+PC9pPiAke3JlbGVhc2UuZG93bmxvYWRzfTwvZGl2PmA7XG4gICAgICAgICAgICBodG1sKz1gPHA+JHtjaGFuZ2VMb2dUZXh0fTwvcD5gO1xuICAgICAgICAgICAgaHRtbCs9YDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJ1aSBpY29uIGxhYmVsZWQgYmFzaWMgYmx1ZSBidXR0b24gZG93bmxvYWRcIlxuICAgICAgICAgICAgICAgZGF0YS11bmlxaWQgPSBcIiR7cmVwb0RhdGEudW5pcWlkfVwiXG4gICAgICAgICAgICAgICBkYXRhLXJlbGVhc2VpZCA9XCIke3JlbGVhc2UucmVsZWFzZUlEfVwiPlxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiaWNvbiBkb3dubG9hZFwiPjwvaT5cbiAgICAgICAgICAgICAgICAke2dsb2JhbFRyYW5zbGF0ZS5leHRfSW5zdGFsbE1vZHVsZVZlcnNpb259ICR7cmVsZWFzZS52ZXJzaW9ufSAoJHtzaXplVGV4dH0pXG4gICAgICAgICAgICA8L2E+YDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH1cbn1cblxuLy8gV2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHksIGluaXRpYWxpemUgdGhlIGV4dGVybmFsIG1vZHVsZXMgZGV0YWlsIHBhZ2VcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBleHRlbnNpb25Nb2R1bGVEZXRhaWwuaW5pdGlhbGl6ZSgpO1xufSk7XG4iXX0=