"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright © 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate, Extensions,Form, SoundFilesSelector */
// Проверка нет ли ошибки занятого другой учеткой номера
$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};

var callQueue = {
  defaultExtension: '',
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  AvailableMembersList: [],
  $formObj: $('#queue-form'),
  $accordions: $('#queue-form .ui.accordion'),
  $dropDowns: $('#queue-form .dropdown'),
  $errorMessages: $('#form-error-messages'),
  $checkBoxes: $('#queue-form .checkbox'),
  forwardingSelect: '#queue-form .forwarding-select',
  $deleteRowButton: $('.delete-row-button'),
  $periodicAnnounceDropdown: $('#queue-form .periodic-announce-sound-id-select'),
  memberRow: '#queue-form .member-row',
  $extensionSelectDropdown: $('#extensionselect'),
  $extensionsTable: $('#extensionsTable'),
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cq_ValidateNameEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cq_ValidateExtensionNumber
      }, {
        type: 'empty',
        prompt: globalTranslate.cq_ValidateExtensionEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.cq_ValidateExtensionDouble
      }]
    }
  },
  initialize: function initialize() {
    Extensions.getPhoneExtensions(callQueue.setAvailableQueueMembers);
    callQueue.defaultExtension = $('#extension').val();
    callQueue.$accordions.accordion();
    callQueue.$dropDowns.dropdown();
    callQueue.$checkBoxes.checkbox();
    callQueue.$periodicAnnounceDropdown.dropdown({
      onChange: function onChange(value) {
        if (parseInt(value, 10) === -1) {
          callQueue.$periodicAnnounceDropdown.dropdown('clear');
        }
      }
    });
    $(callQueue.forwardingSelect).dropdown(Extensions.getDropdownSettingsWithEmpty()); // Динамическая прововерка свободен ли внутренний номер

    callQueue.$number.on('change', function () {
      var newNumber = callQueue.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(callQueue.defaultNumber, newNumber);
    });
    callQueue.initializeDragAndDropExtensionTableRows(); // Удаление строки из таблицы участников очереди

    callQueue.$deleteRowButton.on('click', function (e) {
      $(e.target).closest('tr').remove();
      callQueue.reinitializeExtensionSelect();
      callQueue.updateExtensionTableView();
      callQueue.$dirrtyField.val(Math.random());
      callQueue.$dirrtyField.trigger('change');
      e.preventDefault();
      return false;
    });
    $('#queue-form .audio-message-select').dropdown(SoundFilesSelector.getDropdownSettingsWithEmpty());
    callQueue.initializeForm();
  },
  setAvailableQueueMembers: function setAvailableQueueMembers(arrResult) {
    $.each(arrResult.results, function (index, extension) {
      callQueue.AvailableMembersList.push({
        number: extension.value,
        callerid: extension.name
      });
    });
    callQueue.reinitializeExtensionSelect();
    callQueue.updateExtensionTableView();
  },
  // Вернуть список доступных членов очереди
  getAvailableQueueMembers: function getAvailableQueueMembers() {
    var result = [];
    callQueue.AvailableMembersList.forEach(function (member) {
      if ($(".member-row#".concat(member.number)).length === 0) {
        result.push({
          name: member.callerid,
          value: member.number
        });
      }
    }); // result.sort((a, b) => ((a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0)));

    return result;
  },
  // Пересобрать членов очереди с учетом уже выбранных
  reinitializeExtensionSelect: function reinitializeExtensionSelect() {
    callQueue.$extensionSelectDropdown.dropdown({
      action: 'hide',
      forceSelection: false,
      onChange: function onChange(value, text) {
        if (value) {
          var $tr = $('.member-row-tpl').last();
          var $clone = $tr.clone(true);
          $clone.removeClass('member-row-tpl').addClass('member-row').show();
          $clone.attr('id', value);
          $clone.find('.number').html(value);
          $clone.find('.callerid').html(text);

          if ($(callQueue.memberRow).last().length === 0) {
            $tr.after($clone);
          } else {
            $(callQueue.memberRow).last().after($clone);
          }

          callQueue.reinitializeExtensionSelect();
          callQueue.updateExtensionTableView();
          callQueue.$dirrtyField.val(Math.random());
          callQueue.$dirrtyField.trigger('change');
        }
      },
      values: callQueue.getAvailableQueueMembers()
    });
  },
  // Включить возможность перетаскивания элементов таблицы участников очереди
  initializeDragAndDropExtensionTableRows: function initializeDragAndDropExtensionTableRows() {
    callQueue.$extensionsTable.tableDnD({
      onDragClass: 'hoveringRow',
      dragHandle: '.dragHandle',
      onDrop: function onDrop() {
        callQueue.$dirrtyField.val(Math.random());
        callQueue.$dirrtyField.trigger('change');
      }
    });
  },
  // Отобразить заглушку если в таблице 0 строк
  updateExtensionTableView: function updateExtensionTableView() {
    var dummy = "<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">".concat(globalTranslate.cq_AddQueueMembers, "</td></tr>");

    if ($(callQueue.memberRow).length === 0) {
      $('#extensionsTable tbody').append(dummy);
    } else {
      $('#extensionsTable tbody .dummy').remove();
    }
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = callQueue.$formObj.form('get values');
    var arrMembers = [];
    $(callQueue.memberRow).each(function (index, obj) {
      if ($(obj).attr('id')) {
        arrMembers.push({
          number: $(obj).attr('id'),
          priority: index
        });
      }
    });

    if (arrMembers.length === 0) {
      result = false;
      callQueue.$errorMessages.html(globalTranslate.cq_ValidateNoExtensions);
      callQueue.$formObj.addClass('error');
    } else {
      result.data.members = JSON.stringify(arrMembers);
    }

    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    callQueue.defaultNumber = callQueue.$number.val();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = callQueue.$formObj;
    Form.url = "".concat(globalRootUrl, "call-queues/save");
    Form.validateRules = callQueue.validateRules;
    Form.cbBeforeSendForm = callQueue.cbBeforeSendForm;
    Form.cbAfterSendForm = callQueue.cbAfterSendForm;
    Form.initialize();
  }
};
$(document).ready(function () {
  callQueue.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DYWxsUXVldWVzL2NhbGxxdWV1ZS1tb2RpZnkuanMiXSwibmFtZXMiOlsiJCIsImZuIiwiZm9ybSIsInNldHRpbmdzIiwicnVsZXMiLCJleGlzdFJ1bGUiLCJ2YWx1ZSIsInBhcmFtZXRlciIsImhhc0NsYXNzIiwiY2FsbFF1ZXVlIiwiZGVmYXVsdEV4dGVuc2lvbiIsIiRudW1iZXIiLCIkZGlycnR5RmllbGQiLCJBdmFpbGFibGVNZW1iZXJzTGlzdCIsIiRmb3JtT2JqIiwiJGFjY29yZGlvbnMiLCIkZHJvcERvd25zIiwiJGVycm9yTWVzc2FnZXMiLCIkY2hlY2tCb3hlcyIsImZvcndhcmRpbmdTZWxlY3QiLCIkZGVsZXRlUm93QnV0dG9uIiwiJHBlcmlvZGljQW5ub3VuY2VEcm9wZG93biIsIm1lbWJlclJvdyIsIiRleHRlbnNpb25TZWxlY3REcm9wZG93biIsIiRleHRlbnNpb25zVGFibGUiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiY3FfVmFsaWRhdGVOYW1lRW1wdHkiLCJleHRlbnNpb24iLCJjcV9WYWxpZGF0ZUV4dGVuc2lvbk51bWJlciIsImNxX1ZhbGlkYXRlRXh0ZW5zaW9uRW1wdHkiLCJjcV9WYWxpZGF0ZUV4dGVuc2lvbkRvdWJsZSIsImluaXRpYWxpemUiLCJFeHRlbnNpb25zIiwiZ2V0UGhvbmVFeHRlbnNpb25zIiwic2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzIiwidmFsIiwiYWNjb3JkaW9uIiwiZHJvcGRvd24iLCJjaGVja2JveCIsIm9uQ2hhbmdlIiwicGFyc2VJbnQiLCJnZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5Iiwib24iLCJuZXdOdW1iZXIiLCJjaGVja0F2YWlsYWJpbGl0eSIsImRlZmF1bHROdW1iZXIiLCJpbml0aWFsaXplRHJhZ0FuZERyb3BFeHRlbnNpb25UYWJsZVJvd3MiLCJlIiwidGFyZ2V0IiwiY2xvc2VzdCIsInJlbW92ZSIsInJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCIsInVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldyIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwicHJldmVudERlZmF1bHQiLCJTb3VuZEZpbGVzU2VsZWN0b3IiLCJpbml0aWFsaXplRm9ybSIsImFyclJlc3VsdCIsImVhY2giLCJyZXN1bHRzIiwiaW5kZXgiLCJwdXNoIiwibnVtYmVyIiwiY2FsbGVyaWQiLCJnZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMiLCJyZXN1bHQiLCJmb3JFYWNoIiwibWVtYmVyIiwibGVuZ3RoIiwiYWN0aW9uIiwiZm9yY2VTZWxlY3Rpb24iLCJ0ZXh0IiwiJHRyIiwibGFzdCIsIiRjbG9uZSIsImNsb25lIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInNob3ciLCJhdHRyIiwiZmluZCIsImh0bWwiLCJhZnRlciIsInZhbHVlcyIsInRhYmxlRG5EIiwib25EcmFnQ2xhc3MiLCJkcmFnSGFuZGxlIiwib25Ecm9wIiwiZHVtbXkiLCJjcV9BZGRRdWV1ZU1lbWJlcnMiLCJhcHBlbmQiLCJjYkJlZm9yZVNlbmRGb3JtIiwiZGF0YSIsImFyck1lbWJlcnMiLCJvYmoiLCJwcmlvcml0eSIsImNxX1ZhbGlkYXRlTm9FeHRlbnNpb25zIiwibWVtYmVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBO0FBQ0FBLENBQUMsQ0FBQ0MsRUFBRixDQUFLQyxJQUFMLENBQVVDLFFBQVYsQ0FBbUJDLEtBQW5CLENBQXlCQyxTQUF6QixHQUFxQyxVQUFDQyxLQUFELEVBQVFDLFNBQVI7QUFBQSxTQUFzQlAsQ0FBQyxZQUFLTyxTQUFMLEVBQUQsQ0FBbUJDLFFBQW5CLENBQTRCLFFBQTVCLENBQXRCO0FBQUEsQ0FBckM7O0FBRUEsSUFBTUMsU0FBUyxHQUFHO0FBQ2pCQyxFQUFBQSxnQkFBZ0IsRUFBRSxFQUREO0FBRWpCQyxFQUFBQSxPQUFPLEVBQUVYLENBQUMsQ0FBQyxZQUFELENBRk87QUFHakJZLEVBQUFBLFlBQVksRUFBRVosQ0FBQyxDQUFDLFNBQUQsQ0FIRTtBQUlqQmEsRUFBQUEsb0JBQW9CLEVBQUUsRUFKTDtBQUtqQkMsRUFBQUEsUUFBUSxFQUFFZCxDQUFDLENBQUMsYUFBRCxDQUxNO0FBTWpCZSxFQUFBQSxXQUFXLEVBQUVmLENBQUMsQ0FBQywyQkFBRCxDQU5HO0FBT2pCZ0IsRUFBQUEsVUFBVSxFQUFFaEIsQ0FBQyxDQUFDLHVCQUFELENBUEk7QUFRakJpQixFQUFBQSxjQUFjLEVBQUVqQixDQUFDLENBQUMsc0JBQUQsQ0FSQTtBQVNqQmtCLEVBQUFBLFdBQVcsRUFBRWxCLENBQUMsQ0FBQyx1QkFBRCxDQVRHO0FBVWpCbUIsRUFBQUEsZ0JBQWdCLEVBQUUsZ0NBVkQ7QUFXakJDLEVBQUFBLGdCQUFnQixFQUFFcEIsQ0FBQyxDQUFDLG9CQUFELENBWEY7QUFZakJxQixFQUFBQSx5QkFBeUIsRUFBRXJCLENBQUMsQ0FBQyxnREFBRCxDQVpYO0FBYWpCc0IsRUFBQUEsU0FBUyxFQUFFLHlCQWJNO0FBY2pCQyxFQUFBQSx3QkFBd0IsRUFBRXZCLENBQUMsQ0FBQyxrQkFBRCxDQWRWO0FBZWpCd0IsRUFBQUEsZ0JBQWdCLEVBQUV4QixDQUFDLENBQUMsa0JBQUQsQ0FmRjtBQWdCakJ5QixFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsSUFBSSxFQUFFO0FBQ0xDLE1BQUFBLFVBQVUsRUFBRSxNQURQO0FBRUx2QixNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDd0IsUUFBQUEsSUFBSSxFQUFFLE9BRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNDO0FBRnpCLE9BRE07QUFGRixLQURRO0FBVWRDLElBQUFBLFNBQVMsRUFBRTtBQUNWTCxNQUFBQSxVQUFVLEVBQUUsV0FERjtBQUVWdkIsTUFBQUEsS0FBSyxFQUFFLENBQ047QUFDQ3dCLFFBQUFBLElBQUksRUFBRSxRQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDRztBQUZ6QixPQURNLEVBS047QUFDQ0wsUUFBQUEsSUFBSSxFQUFFLE9BRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNJO0FBRnpCLE9BTE0sRUFTTjtBQUNDTixRQUFBQSxJQUFJLEVBQUUsNEJBRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNLO0FBRnpCLE9BVE07QUFGRztBQVZHLEdBaEJFO0FBNENqQkMsRUFBQUEsVUE1Q2lCLHdCQTRDSjtBQUNaQyxJQUFBQSxVQUFVLENBQUNDLGtCQUFYLENBQThCN0IsU0FBUyxDQUFDOEIsd0JBQXhDO0FBQ0E5QixJQUFBQSxTQUFTLENBQUNDLGdCQUFWLEdBQTZCVixDQUFDLENBQUMsWUFBRCxDQUFELENBQWdCd0MsR0FBaEIsRUFBN0I7QUFDQS9CLElBQUFBLFNBQVMsQ0FBQ00sV0FBVixDQUFzQjBCLFNBQXRCO0FBQ0FoQyxJQUFBQSxTQUFTLENBQUNPLFVBQVYsQ0FBcUIwQixRQUFyQjtBQUNBakMsSUFBQUEsU0FBUyxDQUFDUyxXQUFWLENBQXNCeUIsUUFBdEI7QUFDQWxDLElBQUFBLFNBQVMsQ0FBQ1kseUJBQVYsQ0FBb0NxQixRQUFwQyxDQUE2QztBQUM1Q0UsTUFBQUEsUUFENEMsb0JBQ25DdEMsS0FEbUMsRUFDNUI7QUFDZixZQUFJdUMsUUFBUSxDQUFDdkMsS0FBRCxFQUFRLEVBQVIsQ0FBUixLQUF3QixDQUFDLENBQTdCLEVBQWdDO0FBQy9CRyxVQUFBQSxTQUFTLENBQUNZLHlCQUFWLENBQW9DcUIsUUFBcEMsQ0FBNkMsT0FBN0M7QUFDQTtBQUNEO0FBTDJDLEtBQTdDO0FBT0ExQyxJQUFBQSxDQUFDLENBQUNTLFNBQVMsQ0FBQ1UsZ0JBQVgsQ0FBRCxDQUE4QnVCLFFBQTlCLENBQXVDTCxVQUFVLENBQUNTLDRCQUFYLEVBQXZDLEVBYlksQ0FjWjs7QUFDQXJDLElBQUFBLFNBQVMsQ0FBQ0UsT0FBVixDQUFrQm9DLEVBQWxCLENBQXFCLFFBQXJCLEVBQStCLFlBQU07QUFDcEMsVUFBTUMsU0FBUyxHQUFHdkMsU0FBUyxDQUFDSyxRQUFWLENBQW1CWixJQUFuQixDQUF3QixXQUF4QixFQUFxQyxXQUFyQyxDQUFsQjtBQUNBbUMsTUFBQUEsVUFBVSxDQUFDWSxpQkFBWCxDQUE2QnhDLFNBQVMsQ0FBQ3lDLGFBQXZDLEVBQXNERixTQUF0RDtBQUNBLEtBSEQ7QUFLQXZDLElBQUFBLFNBQVMsQ0FBQzBDLHVDQUFWLEdBcEJZLENBc0JaOztBQUNBMUMsSUFBQUEsU0FBUyxDQUFDVyxnQkFBVixDQUEyQjJCLEVBQTNCLENBQThCLE9BQTlCLEVBQXVDLFVBQUNLLENBQUQsRUFBTztBQUM3Q3BELE1BQUFBLENBQUMsQ0FBQ29ELENBQUMsQ0FBQ0MsTUFBSCxDQUFELENBQVlDLE9BQVosQ0FBb0IsSUFBcEIsRUFBMEJDLE1BQTFCO0FBQ0E5QyxNQUFBQSxTQUFTLENBQUMrQywyQkFBVjtBQUNBL0MsTUFBQUEsU0FBUyxDQUFDZ0Qsd0JBQVY7QUFDQWhELE1BQUFBLFNBQVMsQ0FBQ0csWUFBVixDQUF1QjRCLEdBQXZCLENBQTJCa0IsSUFBSSxDQUFDQyxNQUFMLEVBQTNCO0FBQ0FsRCxNQUFBQSxTQUFTLENBQUNHLFlBQVYsQ0FBdUJnRCxPQUF2QixDQUErQixRQUEvQjtBQUNBUixNQUFBQSxDQUFDLENBQUNTLGNBQUY7QUFDQSxhQUFPLEtBQVA7QUFDQSxLQVJEO0FBVUE3RCxJQUFBQSxDQUFDLENBQUMsbUNBQUQsQ0FBRCxDQUF1QzBDLFFBQXZDLENBQWdEb0Isa0JBQWtCLENBQUNoQiw0QkFBbkIsRUFBaEQ7QUFDQXJDLElBQUFBLFNBQVMsQ0FBQ3NELGNBQVY7QUFDQSxHQS9FZ0I7QUFnRmpCeEIsRUFBQUEsd0JBaEZpQixvQ0FnRlF5QixTQWhGUixFQWdGbUI7QUFDbkNoRSxJQUFBQSxDQUFDLENBQUNpRSxJQUFGLENBQU9ELFNBQVMsQ0FBQ0UsT0FBakIsRUFBMEIsVUFBQ0MsS0FBRCxFQUFRbkMsU0FBUixFQUFzQjtBQUMvQ3ZCLE1BQUFBLFNBQVMsQ0FBQ0ksb0JBQVYsQ0FBK0J1RCxJQUEvQixDQUFvQztBQUNuQ0MsUUFBQUEsTUFBTSxFQUFFckMsU0FBUyxDQUFDMUIsS0FEaUI7QUFFbkNnRSxRQUFBQSxRQUFRLEVBQUV0QyxTQUFTLENBQUNOO0FBRmUsT0FBcEM7QUFJQSxLQUxEO0FBTUFqQixJQUFBQSxTQUFTLENBQUMrQywyQkFBVjtBQUNBL0MsSUFBQUEsU0FBUyxDQUFDZ0Qsd0JBQVY7QUFDQSxHQXpGZ0I7QUEwRmpCO0FBQ0FjLEVBQUFBLHdCQTNGaUIsc0NBMkZVO0FBQzFCLFFBQU1DLE1BQU0sR0FBRyxFQUFmO0FBQ0EvRCxJQUFBQSxTQUFTLENBQUNJLG9CQUFWLENBQStCNEQsT0FBL0IsQ0FBdUMsVUFBQ0MsTUFBRCxFQUFZO0FBQ2xELFVBQUkxRSxDQUFDLHVCQUFnQjBFLE1BQU0sQ0FBQ0wsTUFBdkIsRUFBRCxDQUFrQ00sTUFBbEMsS0FBNkMsQ0FBakQsRUFBb0Q7QUFDbkRILFFBQUFBLE1BQU0sQ0FBQ0osSUFBUCxDQUFZO0FBQ1gxQyxVQUFBQSxJQUFJLEVBQUVnRCxNQUFNLENBQUNKLFFBREY7QUFFWGhFLFVBQUFBLEtBQUssRUFBRW9FLE1BQU0sQ0FBQ0w7QUFGSCxTQUFaO0FBSUE7QUFDRCxLQVBELEVBRjBCLENBVTFCOztBQUNBLFdBQU9HLE1BQVA7QUFDQSxHQXZHZ0I7QUF3R2pCO0FBQ0FoQixFQUFBQSwyQkF6R2lCLHlDQXlHYTtBQUM3Qi9DLElBQUFBLFNBQVMsQ0FBQ2Msd0JBQVYsQ0FBbUNtQixRQUFuQyxDQUE0QztBQUMzQ2tDLE1BQUFBLE1BQU0sRUFBRSxNQURtQztBQUUzQ0MsTUFBQUEsY0FBYyxFQUFFLEtBRjJCO0FBRzNDakMsTUFBQUEsUUFIMkMsb0JBR2xDdEMsS0FIa0MsRUFHM0J3RSxJQUgyQixFQUdyQjtBQUNyQixZQUFJeEUsS0FBSixFQUFXO0FBQ1YsY0FBTXlFLEdBQUcsR0FBRy9FLENBQUMsQ0FBQyxpQkFBRCxDQUFELENBQXFCZ0YsSUFBckIsRUFBWjtBQUNBLGNBQU1DLE1BQU0sR0FBR0YsR0FBRyxDQUFDRyxLQUFKLENBQVUsSUFBVixDQUFmO0FBQ0FELFVBQUFBLE1BQU0sQ0FDSkUsV0FERixDQUNjLGdCQURkLEVBRUVDLFFBRkYsQ0FFVyxZQUZYLEVBR0VDLElBSEY7QUFJQUosVUFBQUEsTUFBTSxDQUFDSyxJQUFQLENBQVksSUFBWixFQUFrQmhGLEtBQWxCO0FBQ0EyRSxVQUFBQSxNQUFNLENBQUNNLElBQVAsQ0FBWSxTQUFaLEVBQXVCQyxJQUF2QixDQUE0QmxGLEtBQTVCO0FBQ0EyRSxVQUFBQSxNQUFNLENBQUNNLElBQVAsQ0FBWSxXQUFaLEVBQXlCQyxJQUF6QixDQUE4QlYsSUFBOUI7O0FBQ0EsY0FBSTlFLENBQUMsQ0FBQ1MsU0FBUyxDQUFDYSxTQUFYLENBQUQsQ0FBdUIwRCxJQUF2QixHQUE4QkwsTUFBOUIsS0FBeUMsQ0FBN0MsRUFBZ0Q7QUFDL0NJLFlBQUFBLEdBQUcsQ0FBQ1UsS0FBSixDQUFVUixNQUFWO0FBQ0EsV0FGRCxNQUVPO0FBQ05qRixZQUFBQSxDQUFDLENBQUNTLFNBQVMsQ0FBQ2EsU0FBWCxDQUFELENBQXVCMEQsSUFBdkIsR0FBOEJTLEtBQTlCLENBQW9DUixNQUFwQztBQUNBOztBQUVEeEUsVUFBQUEsU0FBUyxDQUFDK0MsMkJBQVY7QUFDQS9DLFVBQUFBLFNBQVMsQ0FBQ2dELHdCQUFWO0FBQ0FoRCxVQUFBQSxTQUFTLENBQUNHLFlBQVYsQ0FBdUI0QixHQUF2QixDQUEyQmtCLElBQUksQ0FBQ0MsTUFBTCxFQUEzQjtBQUNBbEQsVUFBQUEsU0FBUyxDQUFDRyxZQUFWLENBQXVCZ0QsT0FBdkIsQ0FBK0IsUUFBL0I7QUFDQTtBQUNELE9BekIwQztBQTBCM0M4QixNQUFBQSxNQUFNLEVBQUVqRixTQUFTLENBQUM4RCx3QkFBVjtBQTFCbUMsS0FBNUM7QUE2QkEsR0F2SWdCO0FBdUlkO0FBRUhwQixFQUFBQSx1Q0F6SWlCLHFEQXlJeUI7QUFDekMxQyxJQUFBQSxTQUFTLENBQUNlLGdCQUFWLENBQTJCbUUsUUFBM0IsQ0FBb0M7QUFDbkNDLE1BQUFBLFdBQVcsRUFBRSxhQURzQjtBQUVuQ0MsTUFBQUEsVUFBVSxFQUFFLGFBRnVCO0FBR25DQyxNQUFBQSxNQUFNLEVBQUUsa0JBQU07QUFDYnJGLFFBQUFBLFNBQVMsQ0FBQ0csWUFBVixDQUF1QjRCLEdBQXZCLENBQTJCa0IsSUFBSSxDQUFDQyxNQUFMLEVBQTNCO0FBQ0FsRCxRQUFBQSxTQUFTLENBQUNHLFlBQVYsQ0FBdUJnRCxPQUF2QixDQUErQixRQUEvQjtBQUNBO0FBTmtDLEtBQXBDO0FBUUEsR0FsSmdCO0FBb0pqQjtBQUNBSCxFQUFBQSx3QkFySmlCLHNDQXFKVTtBQUMxQixRQUFNc0MsS0FBSyw0RUFBK0RqRSxlQUFlLENBQUNrRSxrQkFBL0UsZUFBWDs7QUFFQSxRQUFJaEcsQ0FBQyxDQUFDUyxTQUFTLENBQUNhLFNBQVgsQ0FBRCxDQUF1QnFELE1BQXZCLEtBQWtDLENBQXRDLEVBQXlDO0FBQ3hDM0UsTUFBQUEsQ0FBQyxDQUFDLHdCQUFELENBQUQsQ0FBNEJpRyxNQUE1QixDQUFtQ0YsS0FBbkM7QUFDQSxLQUZELE1BRU87QUFDTi9GLE1BQUFBLENBQUMsQ0FBQywrQkFBRCxDQUFELENBQW1DdUQsTUFBbkM7QUFDQTtBQUNELEdBN0pnQjtBQThKakIyQyxFQUFBQSxnQkE5SmlCLDRCQThKQS9GLFFBOUpBLEVBOEpVO0FBQzFCLFFBQUlxRSxNQUFNLEdBQUdyRSxRQUFiO0FBQ0FxRSxJQUFBQSxNQUFNLENBQUMyQixJQUFQLEdBQWMxRixTQUFTLENBQUNLLFFBQVYsQ0FBbUJaLElBQW5CLENBQXdCLFlBQXhCLENBQWQ7QUFDQSxRQUFNa0csVUFBVSxHQUFHLEVBQW5CO0FBQ0FwRyxJQUFBQSxDQUFDLENBQUNTLFNBQVMsQ0FBQ2EsU0FBWCxDQUFELENBQXVCMkMsSUFBdkIsQ0FBNEIsVUFBQ0UsS0FBRCxFQUFRa0MsR0FBUixFQUFnQjtBQUMzQyxVQUFJckcsQ0FBQyxDQUFDcUcsR0FBRCxDQUFELENBQU9mLElBQVAsQ0FBWSxJQUFaLENBQUosRUFBdUI7QUFDdEJjLFFBQUFBLFVBQVUsQ0FBQ2hDLElBQVgsQ0FBZ0I7QUFDZkMsVUFBQUEsTUFBTSxFQUFFckUsQ0FBQyxDQUFDcUcsR0FBRCxDQUFELENBQU9mLElBQVAsQ0FBWSxJQUFaLENBRE87QUFFZmdCLFVBQUFBLFFBQVEsRUFBRW5DO0FBRkssU0FBaEI7QUFJQTtBQUNELEtBUEQ7O0FBUUEsUUFBSWlDLFVBQVUsQ0FBQ3pCLE1BQVgsS0FBc0IsQ0FBMUIsRUFBNkI7QUFDNUJILE1BQUFBLE1BQU0sR0FBRyxLQUFUO0FBQ0EvRCxNQUFBQSxTQUFTLENBQUNRLGNBQVYsQ0FBeUJ1RSxJQUF6QixDQUE4QjFELGVBQWUsQ0FBQ3lFLHVCQUE5QztBQUNBOUYsTUFBQUEsU0FBUyxDQUFDSyxRQUFWLENBQW1Cc0UsUUFBbkIsQ0FBNEIsT0FBNUI7QUFDQSxLQUpELE1BSU87QUFDTlosTUFBQUEsTUFBTSxDQUFDMkIsSUFBUCxDQUFZSyxPQUFaLEdBQXNCQyxJQUFJLENBQUNDLFNBQUwsQ0FBZU4sVUFBZixDQUF0QjtBQUNBOztBQUVELFdBQU81QixNQUFQO0FBQ0EsR0FuTGdCO0FBb0xqQm1DLEVBQUFBLGVBcExpQiw2QkFvTEM7QUFDakJsRyxJQUFBQSxTQUFTLENBQUN5QyxhQUFWLEdBQTBCekMsU0FBUyxDQUFDRSxPQUFWLENBQWtCNkIsR0FBbEIsRUFBMUI7QUFDQSxHQXRMZ0I7QUF1TGpCdUIsRUFBQUEsY0F2TGlCLDRCQXVMQTtBQUNoQjZDLElBQUFBLElBQUksQ0FBQzlGLFFBQUwsR0FBZ0JMLFNBQVMsQ0FBQ0ssUUFBMUI7QUFDQThGLElBQUFBLElBQUksQ0FBQ0MsR0FBTCxhQUFjQyxhQUFkO0FBQ0FGLElBQUFBLElBQUksQ0FBQ25GLGFBQUwsR0FBcUJoQixTQUFTLENBQUNnQixhQUEvQjtBQUNBbUYsSUFBQUEsSUFBSSxDQUFDVixnQkFBTCxHQUF3QnpGLFNBQVMsQ0FBQ3lGLGdCQUFsQztBQUNBVSxJQUFBQSxJQUFJLENBQUNELGVBQUwsR0FBdUJsRyxTQUFTLENBQUNrRyxlQUFqQztBQUNBQyxJQUFBQSxJQUFJLENBQUN4RSxVQUFMO0FBQ0E7QUE5TGdCLENBQWxCO0FBaU1BcEMsQ0FBQyxDQUFDK0csUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnZHLEVBQUFBLFNBQVMsQ0FBQzJCLFVBQVY7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGdsb2JhbFRyYW5zbGF0ZSwgRXh0ZW5zaW9ucyxGb3JtLCBTb3VuZEZpbGVzU2VsZWN0b3IgKi9cblxuLy8g0J/RgNC+0LLQtdGA0LrQsCDQvdC10YIg0LvQuCDQvtGI0LjQsdC60Lgg0LfQsNC90Y/RgtC+0LPQviDQtNGA0YPQs9C+0Lkg0YPRh9C10YLQutC+0Lkg0L3QvtC80LXRgNCwXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZXhpc3RSdWxlID0gKHZhbHVlLCBwYXJhbWV0ZXIpID0+ICQoYCMke3BhcmFtZXRlcn1gKS5oYXNDbGFzcygnaGlkZGVuJyk7XG5cbmNvbnN0IGNhbGxRdWV1ZSA9IHtcblx0ZGVmYXVsdEV4dGVuc2lvbjogJycsXG5cdCRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdEF2YWlsYWJsZU1lbWJlcnNMaXN0OiBbXSxcblx0JGZvcm1PYmo6ICQoJyNxdWV1ZS1mb3JtJyksXG5cdCRhY2NvcmRpb25zOiAkKCcjcXVldWUtZm9ybSAudWkuYWNjb3JkaW9uJyksXG5cdCRkcm9wRG93bnM6ICQoJyNxdWV1ZS1mb3JtIC5kcm9wZG93bicpLFxuXHQkZXJyb3JNZXNzYWdlczogJCgnI2Zvcm0tZXJyb3ItbWVzc2FnZXMnKSxcblx0JGNoZWNrQm94ZXM6ICQoJyNxdWV1ZS1mb3JtIC5jaGVja2JveCcpLFxuXHRmb3J3YXJkaW5nU2VsZWN0OiAnI3F1ZXVlLWZvcm0gLmZvcndhcmRpbmctc2VsZWN0Jyxcblx0JGRlbGV0ZVJvd0J1dHRvbjogJCgnLmRlbGV0ZS1yb3ctYnV0dG9uJyksXG5cdCRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd246ICQoJyNxdWV1ZS1mb3JtIC5wZXJpb2RpYy1hbm5vdW5jZS1zb3VuZC1pZC1zZWxlY3QnKSxcblx0bWVtYmVyUm93OiAnI3F1ZXVlLWZvcm0gLm1lbWJlci1yb3cnLFxuXHQkZXh0ZW5zaW9uU2VsZWN0RHJvcGRvd246ICQoJyNleHRlbnNpb25zZWxlY3QnKSxcblx0JGV4dGVuc2lvbnNUYWJsZTogJCgnI2V4dGVuc2lvbnNUYWJsZScpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ25hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVOYW1lRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbnVtYmVyJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZUV4dGVuc2lvbk51bWJlcixcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVFeHRlbnNpb25FbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdleGlzdFJ1bGVbZXh0ZW5zaW9uLWVycm9yXScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0RXh0ZW5zaW9ucy5nZXRQaG9uZUV4dGVuc2lvbnMoY2FsbFF1ZXVlLnNldEF2YWlsYWJsZVF1ZXVlTWVtYmVycyk7XG5cdFx0Y2FsbFF1ZXVlLmRlZmF1bHRFeHRlbnNpb24gPSAkKCcjZXh0ZW5zaW9uJykudmFsKCk7XG5cdFx0Y2FsbFF1ZXVlLiRhY2NvcmRpb25zLmFjY29yZGlvbigpO1xuXHRcdGNhbGxRdWV1ZS4kZHJvcERvd25zLmRyb3Bkb3duKCk7XG5cdFx0Y2FsbFF1ZXVlLiRjaGVja0JveGVzLmNoZWNrYm94KCk7XG5cdFx0Y2FsbFF1ZXVlLiRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd24uZHJvcGRvd24oe1xuXHRcdFx0b25DaGFuZ2UodmFsdWUpIHtcblx0XHRcdFx0aWYgKHBhcnNlSW50KHZhbHVlLCAxMCkgPT09IC0xKSB7XG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLiRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd24uZHJvcGRvd24oJ2NsZWFyJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0fSk7XG5cdFx0JChjYWxsUXVldWUuZm9yd2FyZGluZ1NlbGVjdCkuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5KCkpO1xuXHRcdC8vINCU0LjQvdCw0LzQuNGH0LXRgdC60LDRjyDQv9GA0L7QstC+0LLQtdGA0LrQsCDRgdCy0L7QsdC+0LTQtdC9INC70Lgg0LLQvdGD0YLRgNC10L3QvdC40Lkg0L3QvtC80LXRgFxuXHRcdGNhbGxRdWV1ZS4kbnVtYmVyLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRjb25zdCBuZXdOdW1iZXIgPSBjYWxsUXVldWUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHRcdFx0RXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShjYWxsUXVldWUuZGVmYXVsdE51bWJlciwgbmV3TnVtYmVyKTtcblx0XHR9KTtcblxuXHRcdGNhbGxRdWV1ZS5pbml0aWFsaXplRHJhZ0FuZERyb3BFeHRlbnNpb25UYWJsZVJvd3MoKTtcblxuXHRcdC8vINCj0LTQsNC70LXQvdC40LUg0YHRgtGA0L7QutC4INC40Lcg0YLQsNCx0LvQuNGG0Ysg0YPRh9Cw0YHRgtC90LjQutC+0LIg0L7Rh9C10YDQtdC00Lhcblx0XHRjYWxsUXVldWUuJGRlbGV0ZVJvd0J1dHRvbi5vbignY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0JChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcblx0XHRcdGNhbGxRdWV1ZS5yZWluaXRpYWxpemVFeHRlbnNpb25TZWxlY3QoKTtcblx0XHRcdGNhbGxRdWV1ZS51cGRhdGVFeHRlbnNpb25UYWJsZVZpZXcoKTtcblx0XHRcdGNhbGxRdWV1ZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9KTtcblxuXHRcdCQoJyNxdWV1ZS1mb3JtIC5hdWRpby1tZXNzYWdlLXNlbGVjdCcpLmRyb3Bkb3duKFNvdW5kRmlsZXNTZWxlY3Rvci5nZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5KCkpO1xuXHRcdGNhbGxRdWV1ZS5pbml0aWFsaXplRm9ybSgpO1xuXHR9LFxuXHRzZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMoYXJyUmVzdWx0KSB7XG5cdFx0JC5lYWNoKGFyclJlc3VsdC5yZXN1bHRzLCAoaW5kZXgsIGV4dGVuc2lvbikgPT4ge1xuXHRcdFx0Y2FsbFF1ZXVlLkF2YWlsYWJsZU1lbWJlcnNMaXN0LnB1c2goe1xuXHRcdFx0XHRudW1iZXI6IGV4dGVuc2lvbi52YWx1ZSxcblx0XHRcdFx0Y2FsbGVyaWQ6IGV4dGVuc2lvbi5uYW1lLFxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdFx0Y2FsbFF1ZXVlLnJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCgpO1xuXHRcdGNhbGxRdWV1ZS51cGRhdGVFeHRlbnNpb25UYWJsZVZpZXcoKTtcblx0fSxcblx0Ly8g0JLQtdGA0L3Rg9GC0Ywg0YHQv9C40YHQvtC6INC00L7RgdGC0YPQv9C90YvRhSDRh9C70LXQvdC+0LIg0L7Rh9C10YDQtdC00Lhcblx0Z2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzKCkge1xuXHRcdGNvbnN0IHJlc3VsdCA9IFtdO1xuXHRcdGNhbGxRdWV1ZS5BdmFpbGFibGVNZW1iZXJzTGlzdC5mb3JFYWNoKChtZW1iZXIpID0+IHtcblx0XHRcdGlmICgkKGAubWVtYmVyLXJvdyMke21lbWJlci5udW1iZXJ9YCkubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHJlc3VsdC5wdXNoKHtcblx0XHRcdFx0XHRuYW1lOiBtZW1iZXIuY2FsbGVyaWQsXG5cdFx0XHRcdFx0dmFsdWU6IG1lbWJlci5udW1iZXIsXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdC8vIHJlc3VsdC5zb3J0KChhLCBiKSA9PiAoKGEubmFtZSA+IGIubmFtZSkgPyAxIDogKChiLm5hbWUgPiBhLm5hbWUpID8gLTEgOiAwKSkpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdC8vINCf0LXRgNC10YHQvtCx0YDQsNGC0Ywg0YfQu9C10L3QvtCyINC+0YfQtdGA0LXQtNC4INGBINGD0YfQtdGC0L7QvCDRg9C20LUg0LLRi9Cx0YDQsNC90L3Ri9GFXG5cdHJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCgpIHtcblx0XHRjYWxsUXVldWUuJGV4dGVuc2lvblNlbGVjdERyb3Bkb3duLmRyb3Bkb3duKHtcblx0XHRcdGFjdGlvbjogJ2hpZGUnLFxuXHRcdFx0Zm9yY2VTZWxlY3Rpb246IGZhbHNlLFxuXHRcdFx0b25DaGFuZ2UodmFsdWUsIHRleHQpIHtcblx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0Y29uc3QgJHRyID0gJCgnLm1lbWJlci1yb3ctdHBsJykubGFzdCgpO1xuXHRcdFx0XHRcdGNvbnN0ICRjbG9uZSA9ICR0ci5jbG9uZSh0cnVlKTtcblx0XHRcdFx0XHQkY2xvbmVcblx0XHRcdFx0XHRcdC5yZW1vdmVDbGFzcygnbWVtYmVyLXJvdy10cGwnKVxuXHRcdFx0XHRcdFx0LmFkZENsYXNzKCdtZW1iZXItcm93Jylcblx0XHRcdFx0XHRcdC5zaG93KCk7XG5cdFx0XHRcdFx0JGNsb25lLmF0dHIoJ2lkJywgdmFsdWUpO1xuXHRcdFx0XHRcdCRjbG9uZS5maW5kKCcubnVtYmVyJykuaHRtbCh2YWx1ZSk7XG5cdFx0XHRcdFx0JGNsb25lLmZpbmQoJy5jYWxsZXJpZCcpLmh0bWwodGV4dCk7XG5cdFx0XHRcdFx0aWYgKCQoY2FsbFF1ZXVlLm1lbWJlclJvdykubGFzdCgpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0JHRyLmFmdGVyKCRjbG9uZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdCQoY2FsbFF1ZXVlLm1lbWJlclJvdykubGFzdCgpLmFmdGVyKCRjbG9uZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLnJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCgpO1xuXHRcdFx0XHRcdGNhbGxRdWV1ZS51cGRhdGVFeHRlbnNpb25UYWJsZVZpZXcoKTtcblx0XHRcdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0dmFsdWVzOiBjYWxsUXVldWUuZ2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzKCksXG5cblx0XHR9KTtcblx0fSwgLy8g0JLQutC70Y7Rh9C40YLRjCDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Y8g0Y3Qu9C10LzQtdC90YLQvtCyINGC0LDQsdC70LjRhtGLINGD0YfQsNGB0YLQvdC40LrQvtCyINC+0YfQtdGA0LXQtNC4XG5cblx0aW5pdGlhbGl6ZURyYWdBbmREcm9wRXh0ZW5zaW9uVGFibGVSb3dzKCkge1xuXHRcdGNhbGxRdWV1ZS4kZXh0ZW5zaW9uc1RhYmxlLnRhYmxlRG5EKHtcblx0XHRcdG9uRHJhZ0NsYXNzOiAnaG92ZXJpbmdSb3cnLFxuXHRcdFx0ZHJhZ0hhbmRsZTogJy5kcmFnSGFuZGxlJyxcblx0XHRcdG9uRHJvcDogKCkgPT4ge1xuXHRcdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cdH0sXG5cblx0Ly8g0J7RgtC+0LHRgNCw0LfQuNGC0Ywg0LfQsNCz0LvRg9GI0LrRgyDQtdGB0LvQuCDQsiDRgtCw0LHQu9C40YbQtSAwINGB0YLRgNC+0Lpcblx0dXBkYXRlRXh0ZW5zaW9uVGFibGVWaWV3KCkge1xuXHRcdGNvbnN0IGR1bW15ID0gYDx0ciBjbGFzcz1cImR1bW15XCI+PHRkIGNvbHNwYW49XCI0XCIgY2xhc3M9XCJjZW50ZXIgYWxpZ25lZFwiPiR7Z2xvYmFsVHJhbnNsYXRlLmNxX0FkZFF1ZXVlTWVtYmVyc308L3RkPjwvdHI+YDtcblxuXHRcdGlmICgkKGNhbGxRdWV1ZS5tZW1iZXJSb3cpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0JCgnI2V4dGVuc2lvbnNUYWJsZSB0Ym9keScpLmFwcGVuZChkdW1teSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoJyNleHRlbnNpb25zVGFibGUgdGJvZHkgLmR1bW15JykucmVtb3ZlKCk7XG5cdFx0fVxuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0bGV0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gY2FsbFF1ZXVlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRjb25zdCBhcnJNZW1iZXJzID0gW107XG5cdFx0JChjYWxsUXVldWUubWVtYmVyUm93KS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG5cdFx0XHRpZiAoJChvYmopLmF0dHIoJ2lkJykpIHtcblx0XHRcdFx0YXJyTWVtYmVycy5wdXNoKHtcblx0XHRcdFx0XHRudW1iZXI6ICQob2JqKS5hdHRyKCdpZCcpLFxuXHRcdFx0XHRcdHByaW9yaXR5OiBpbmRleCxcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKGFyck1lbWJlcnMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRyZXN1bHQgPSBmYWxzZTtcblx0XHRcdGNhbGxRdWV1ZS4kZXJyb3JNZXNzYWdlcy5odG1sKGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZU5vRXh0ZW5zaW9ucyk7XG5cdFx0XHRjYWxsUXVldWUuJGZvcm1PYmouYWRkQ2xhc3MoJ2Vycm9yJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc3VsdC5kYXRhLm1lbWJlcnMgPSBKU09OLnN0cmluZ2lmeShhcnJNZW1iZXJzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cdFx0Y2FsbFF1ZXVlLmRlZmF1bHROdW1iZXIgPSBjYWxsUXVldWUuJG51bWJlci52YWwoKTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGNhbGxRdWV1ZS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y2FsbC1xdWV1ZXMvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gY2FsbFF1ZXVlLnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gY2FsbFF1ZXVlLmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjYWxsUXVldWUuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRjYWxsUXVldWUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==