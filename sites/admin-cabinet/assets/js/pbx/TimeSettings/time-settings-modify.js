"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate, SemanticLocalization, Form, PbxApi, clockWorker */
var timeSettings = {
  $number: $('#extension'),
  $formObj: $('#time-settings-form'),
  validateRules: {
    CurrentDateTime: {
      depends: 'PBXManualTimeSettings',
      identifier: 'ManualDateTime',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.ts_ValidateDateTime
      }]
    }
  },
  initialize: function initialize() {
    $('#PBXTimezone').dropdown({
      fullTextSearch: true
    });
    $('.checkbox').checkbox({
      onChange: function onChange() {
        timeSettings.toggleDisabledFieldClass();
      }
    });
    timeSettings.initializeForm();
    timeSettings.toggleDisabledFieldClass();
  },
  toggleDisabledFieldClass: function toggleDisabledFieldClass() {
    if (timeSettings.$formObj.form('get value', 'PBXManualTimeSettings') === 'on') {
      $('#SetDateTimeBlock').removeClass('disabled');
      $('#SetNtpServerBlock').addClass('disabled');
    } else {
      $('#SetNtpServerBlock').removeClass('disabled');
      $('#SetDateTimeBlock').addClass('disabled');
      clockWorker.restartWorker();
    }
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = timeSettings.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    if (timeSettings.$formObj.form('get value', 'PBXManualTimeSettings') === 'on') {
      var manualDate = timeSettings.$formObj.form('get value', 'ManualDateTime');
      var timestamp = Date.parse("".concat(manualDate)) / 1000;
      var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      PbxApi.UpdateDateTime({
        timestamp: timestamp,
        userTimeZone: userTimeZone
      });
    }
  },
  initializeForm: function initializeForm() {
    Form.$formObj = timeSettings.$formObj;
    Form.url = "".concat(globalRootUrl, "time-settings/save");
    Form.validateRules = timeSettings.validateRules;
    Form.cbBeforeSendForm = timeSettings.cbBeforeSendForm;
    Form.cbAfterSendForm = timeSettings.cbAfterSendForm;
    Form.initialize();
  }
};
$(document).ready(function () {
  timeSettings.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9UaW1lU2V0dGluZ3MvdGltZS1zZXR0aW5ncy1tb2RpZnkuanMiXSwibmFtZXMiOlsidGltZVNldHRpbmdzIiwiJG51bWJlciIsIiQiLCIkZm9ybU9iaiIsInZhbGlkYXRlUnVsZXMiLCJDdXJyZW50RGF0ZVRpbWUiLCJkZXBlbmRzIiwiaWRlbnRpZmllciIsInJ1bGVzIiwidHlwZSIsInByb21wdCIsImdsb2JhbFRyYW5zbGF0ZSIsInRzX1ZhbGlkYXRlRGF0ZVRpbWUiLCJpbml0aWFsaXplIiwiZHJvcGRvd24iLCJmdWxsVGV4dFNlYXJjaCIsImNoZWNrYm94Iiwib25DaGFuZ2UiLCJ0b2dnbGVEaXNhYmxlZEZpZWxkQ2xhc3MiLCJpbml0aWFsaXplRm9ybSIsImZvcm0iLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY2xvY2tXb3JrZXIiLCJyZXN0YXJ0V29ya2VyIiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZGF0YSIsImNiQWZ0ZXJTZW5kRm9ybSIsIm1hbnVhbERhdGUiLCJ0aW1lc3RhbXAiLCJEYXRlIiwicGFyc2UiLCJ1c2VyVGltZVpvbmUiLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJyZXNvbHZlZE9wdGlvbnMiLCJ0aW1lWm9uZSIsIlBieEFwaSIsIlVwZGF0ZURhdGVUaW1lIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQSxJQUFNQSxZQUFZLEdBQUc7QUFDcEJDLEVBQUFBLE9BQU8sRUFBRUMsQ0FBQyxDQUFDLFlBQUQsQ0FEVTtBQUVwQkMsRUFBQUEsUUFBUSxFQUFFRCxDQUFDLENBQUMscUJBQUQsQ0FGUztBQUdwQkUsRUFBQUEsYUFBYSxFQUFFO0FB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QixZQUFZLENBQUM2QixlQUFwQztBQUNBWSxJQUFBQSxJQUFJLENBQUM1QixVQUFMO0FBQ0E7QUExRG1CLENBQXJCO0FBNkRBWCxDQUFDLENBQUMwQyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3ZCN0MsRUFBQUEsWUFBWSxDQUFDYSxVQUFiO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgZ2xvYmFsVHJhbnNsYXRlLCBTZW1hbnRpY0xvY2FsaXphdGlvbiwgRm9ybSwgUGJ4QXBpLCBjbG9ja1dvcmtlciAqL1xuXG5jb25zdCB0aW1lU2V0dGluZ3MgPSB7XG5cdCRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcblx0JGZvcm1PYmo6ICQoJyN0aW1lLXNldHRpbmdzLWZvcm0nKSxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdEN1cnJlbnREYXRlVGltZToge1xuXHRcdFx0ZGVwZW5kczogJ1BCWE1hbnVhbFRpbWVTZXR0aW5ncycsXG5cdFx0XHRpZGVudGlmaWVyOiAnTWFudWFsRGF0ZVRpbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUudHNfVmFsaWRhdGVEYXRlVGltZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQkKCcjUEJYVGltZXpvbmUnKS5kcm9wZG93bih7XG5cdFx0XHRmdWxsVGV4dFNlYXJjaDogdHJ1ZSxcblx0XHR9KTtcblxuXHRcdCQoJy5jaGVja2JveCcpLmNoZWNrYm94KHtcblx0XHRcdG9uQ2hhbmdlKCkge1xuXHRcdFx0XHR0aW1lU2V0dGluZ3MudG9nZ2xlRGlzYWJsZWRGaWVsZENsYXNzKCk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXHRcdHRpbWVTZXR0aW5ncy5pbml0aWFsaXplRm9ybSgpO1xuXHRcdHRpbWVTZXR0aW5ncy50b2dnbGVEaXNhYmxlZEZpZWxkQ2xhc3MoKTtcblx0fSxcblx0dG9nZ2xlRGlzYWJsZWRGaWVsZENsYXNzKCkge1xuXHRcdGlmICh0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ1BCWE1hbnVhbFRpbWVTZXR0aW5ncycpID09PSAnb24nKSB7XG5cdFx0XHQkKCcjU2V0RGF0ZVRpbWVCbG9jaycpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0JCgnI1NldE50cFNlcnZlckJsb2NrJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoJyNTZXROdHBTZXJ2ZXJCbG9jaycpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0JCgnI1NldERhdGVUaW1lQmxvY2snKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdGNsb2NrV29ya2VyLnJlc3RhcnRXb3JrZXIoKTtcblx0XHR9XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IHRpbWVTZXR0aW5ncy4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXHRcdGlmICh0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ1BCWE1hbnVhbFRpbWVTZXR0aW5ncycpID09PSAnb24nKSB7XG5cdFx0XHRjb25zdCBtYW51YWxEYXRlID0gdGltZVNldHRpbmdzLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdNYW51YWxEYXRlVGltZScpO1xuXHRcdFx0Y29uc3QgdGltZXN0YW1wID0gRGF0ZS5wYXJzZShgJHttYW51YWxEYXRlfWApLzEwMDA7XG5cdFx0XHRjb25zdCB1c2VyVGltZVpvbmUgPSBJbnRsLkRhdGVUaW1lRm9ybWF0KCkucmVzb2x2ZWRPcHRpb25zKCkudGltZVpvbmU7XG5cdFx0XHRQYnhBcGkuVXBkYXRlRGF0ZVRpbWUoe3RpbWVzdGFtcCwgdXNlclRpbWVab25lfSk7XG5cdFx0fVxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gdGltZVNldHRpbmdzLiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH10aW1lLXNldHRpbmdzL3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IHRpbWVTZXR0aW5ncy52YWxpZGF0ZVJ1bGVzO1xuXHRcdEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IHRpbWVTZXR0aW5ncy5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gdGltZVNldHRpbmdzLmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0dGltZVNldHRpbmdzLmluaXRpYWxpemUoKTtcbn0pO1xuIl19