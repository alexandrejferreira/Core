"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions, SoundFilesSelector */
var ivrMenu = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#ivr-menu-form'),
  $dropDowns: $('#ivr-menu-form .ui.dropdown'),
  $number: $('#extension'),

  /**
   * Dirty check field, for checking if something on the form was changed
   * @type {jQuery}
   */
  $dirrtyField: $('#dirrty'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function initialize() {
    // Initialize dropdowns
    ivrMenu.$dropDowns.dropdown(); // Dynamic check to see if the selected number is available

    ivrMenu.$number.on('change', function () {
      var newNumber = ivrMenu.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
    }); // Add event listener for adding a new IVR action row

    $('#add-new-ivr-action').on('click', function (el) {
      ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown(); // Change the value of '$dirrtyField' to trigger
      // the 'change' form event and enable submit button.

      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
      el.preventDefault();
    }); // Initialize audio message dropdowns

    $('#ivr-menu-form .audio-message-select').dropdown(SoundFilesSelector.getDropdownSettingsWithEmpty()); // Initialize the form

    ivrMenu.initializeForm(); // Build IVR menu actions

    ivrMenu.buildIvrMenuActions(); // Get the default extension value

    ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
  },

  /**
   * Create ivr menu items on the form
   */
  buildIvrMenuActions: function buildIvrMenuActions() {
    var objActions = JSON.parse(ivrActions);
    objActions.forEach(function (element) {
      ivrMenu.addNewActionRow(element);
    });
    if (objActions.length === 0) ivrMenu.addNewActionRow();
    ivrMenu.rebuildActionExtensionsDropdown();
  },

  /**
   * Adds new form validation rules for a newly added action row.
   * @param {string} newRowId - The ID of the newly added action row.
   */
  addNewFormRules: function addNewFormRules(newRowId) {
    // Create the identifier for the digits field of the new row
    var $digitsClass = "digits-".concat(newRowId); // Define the validation rules for the digits field

    ivrMenu.validateRules[$digitsClass] = {
      identifier: $digitsClass,
      rules: [{
        type: 'regExp[/^[0-9]{1,7}$/]',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }, {
        type: 'checkDoublesDigits',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }]
    }; // Create the identifier for the extension field of the new row

    var $extensionClass = "extension-".concat(newRowId); // Define the validation rules for the extension field

    ivrMenu.validateRules[$extensionClass] = {
      identifier: $extensionClass,
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
      }]
    };
  },

  /**
   * Adds a new action row to the IVR menu form.
   * @param {Object} paramObj - Optional parameter object with initial values for the action row.
   *                            If not provided, default values will be used.
   */
  addNewActionRow: function addNewActionRow(paramObj) {
    // Default parameter values
    var param = {
      id: '',
      extension: '',
      extensionRepresent: '',
      digits: ''
    }; // Override default values with the provided parameter object

    if (paramObj !== undefined) {
      param = paramObj;
    } // Increment the actionsRowsCount


    ivrMenu.actionsRowsCount += 1; // Clone the row template and modify its attributes and content

    var $actionTemplate = ivrMenu.$rowTemplate.clone();
    $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', ''); // Set the attributes and values for digits input field

    $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits); // Set the attributes and values for extension input field

    $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension); // Set the data-value attribute for the delete-action-row element

    $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount); // Update the extensionRepresent content based on the provided value or default text

    if (param.extensionRepresent.length > 0) {
      $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
    } else {
      $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
    } // Append the action template to the actions-place element


    $('#actions-place').append($actionTemplate); // Add new form rules for the newly added action row

    ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
  },

  /**
   * Rebuilds the action extensions dropdown by initializing the dropdown settings for routing
   * and attaching the cbOnExtensionSelect callback function to handle the extension selection event.
   */
  rebuildActionExtensionsDropdown: function rebuildActionExtensionsDropdown() {
    // Initialize the dropdown settings for routing with cbOnExtensionSelect callback function
    $('#ivr-menu-form .forwarding-select').dropdown(Extensions.getDropdownSettingsForRouting(ivrMenu.cbOnExtensionSelect)); // Attach a click event handler to the delete-action-row elements

    $('.delete-action-row').on('click', function (e) {
      e.preventDefault(); // Get the 'data-value' attribute of the clicked element

      var id = $(this).attr('data-value'); // Remove the corresponding rules from validateRules object

      delete ivrMenu.validateRules["digits-".concat(id)];
      delete ivrMenu.validateRules["extension-".concat(id)]; // Remove the row with the corresponding id

      $("#row-".concat(id)).remove(); // Change the value of '$dirrtyField' to trigger
      // the 'change' form event and enable submit button.

      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
    });
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    // Copy the settings object to a new variable to avoid modifying the original
    var result = settings; // Get the form values from $formObj of ivrMenu

    result.data = ivrMenu.$formObj.form('get values'); // Initialize an array to store actions

    var arrActions = []; // Iterate over each action row

    $('.action-row').each(function (index, obj) {
      var rowId = $(obj).attr('data-value'); // If rowId is greater than 0, get the 'digits' and 'extension' values from the form and push them into the arrActions array

      if (rowId > 0) {
        arrActions.push({
          digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
          extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
        });
      }
    }); // If there are no action rows, set the result to false, display an error message and add error class to the form

    if (arrActions.length === 0) {
      result = false;
      ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
      ivrMenu.$formObj.addClass('error');
    } else {
      // Convert the arrActions array into a JSON string and assign it to 'actions' key in the result data object
      result.data.actions = JSON.stringify(arrActions);
    } // Return the modified settings object or false


    return result;
  },

  /**
   * Callback function that triggers when a number is selected from the dropdown menu.
   * It generates a random number and triggers a change event.
   */
  cbOnExtensionSelect: function cbOnExtensionSelect() {
    // Change the value of '$dirrtyField' to trigger
    // the 'change' form event and enable submit button.
    ivrMenu.$dirrtyField.val(Math.random());
    ivrMenu.$dirrtyField.trigger('change');
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = ivrMenu.$formObj;
    Form.url = "".concat(globalRootUrl, "ivr-menu/save"); // Form submission URL

    Form.validateRules = ivrMenu.validateRules; // Form validation rules

    Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = ivrMenu.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Custom form rule to check if an element with id 'extension-error' has the class 'hidden'.
 */

$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};
/**
 * Custom form rule to check for duplicate digits values.
 * @param {string} value - The value to check for duplicates.
 * @returns {boolean} - True if there are no duplicates, false otherwise.
 */


$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};
/**
 *  Initialize IVR menu modify form on document ready
 */


$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIml2ck1lbnUiLCIkZm9ybU9iaiIsIiQiLCIkZHJvcERvd25zIiwiJG51bWJlciIsIiRkaXJydHlGaWVsZCIsIiRlcnJvck1lc3NhZ2VzIiwiJHJvd1RlbXBsYXRlIiwiZGVmYXVsdEV4dGVuc2lvbiIsImFjdGlvbnNSb3dzQ291bnQiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJpdl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0VtcHR5IiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0RvdWJsZSIsInRpbWVvdXRfZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVUaW1lb3V0RXh0ZW5zaW9uSXNFbXB0eSIsImF1ZGlvX21lc3NhZ2VfaWQiLCJpdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHkiLCJ0aW1lb3V0IiwiaXZfVmFsaWRhdGVUaW1lb3V0T3V0T2ZSYW5nZSIsIm51bWJlcl9vZl9yZXBlYXQiLCJpdl9WYWxpZGF0ZVJlcGVhdE51bWJlck91dE9mUmFuZ2UiLCJpbml0aWFsaXplIiwiZHJvcGRvd24iLCJvbiIsIm5ld051bWJlciIsImZvcm0iLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiZWwiLCJhZGROZXdBY3Rpb25Sb3ciLCJyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJwcmV2ZW50RGVmYXVsdCIsIlNvdW5kRmlsZXNTZWxlY3RvciIsImdldERyb3Bkb3duU2V0dGluZ3NXaXRoRW1wdHkiLCJpbml0aWFsaXplRm9ybSIsImJ1aWxkSXZyTWVudUFjdGlvbnMiLCJvYmpBY3Rpb25zIiwiSlNPTiIsInBhcnNlIiwiaXZyQWN0aW9ucyIsImZvckVhY2giLCJlbGVtZW50IiwibGVuZ3RoIiwiYWRkTmV3Rm9ybVJ1bGVzIiwibmV3Um93SWQiLCIkZGlnaXRzQ2xhc3MiLCJpdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCIsIiRleHRlbnNpb25DbGFzcyIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0IiwicGFyYW1PYmoiLCJwYXJhbSIsImlkIiwiZXh0ZW5zaW9uUmVwcmVzZW50IiwiZGlnaXRzIiwidW5kZWZpbmVkIiwiJGFjdGlvblRlbXBsYXRlIiwiY2xvbmUiLCJyZW1vdmVDbGFzcyIsImF0dHIiLCJmaW5kIiwiaHRtbCIsImV4X1NlbGVjdE51bWJlciIsImFwcGVuZCIsImdldERyb3Bkb3duU2V0dGluZ3NGb3JSb3V0aW5nIiwiY2JPbkV4dGVuc2lvblNlbGVjdCIsImUiLCJyZW1vdmUiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiYXJyQWN0aW9ucyIsImVhY2giLCJpbmRleCIsIm9iaiIsInJvd0lkIiwicHVzaCIsIml2X1ZhbGlkYXRlTm9JVlJFeHRlbnNpb25zIiwiYWRkQ2xhc3MiLCJhY3Rpb25zIiwic3RyaW5naWZ5IiwiY2JBZnRlclNlbmRGb3JtIiwicmVzcG9uc2UiLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJjaGVja0RvdWJsZXNEaWdpdHMiLCJ2YWx1ZSIsImNvdW50IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBR0EsSUFBTUEsT0FBTyxHQUFHO0FBQ1o7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsUUFBUSxFQUFFQyxDQUFDLENBQUMsZ0JBQUQsQ0FMQztBQU9aQyxFQUFBQSxV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QUFPLENBQUM4RixlQUEvQixDQUxhLENBS21DOztBQUNoREUsSUFBQUEsSUFBSSxDQUFDbkUsVUFBTDtBQUNIO0FBalZXLENBQWhCO0FBb1ZBO0FBQ0E7QUFDQTs7QUFDQTNCLENBQUMsQ0FBQ2lHLEVBQUYsQ0FBS2xFLElBQUwsQ0FBVWdELFFBQVYsQ0FBbUJwRSxLQUFuQixDQUF5QnVGLFNBQXpCLEdBQXFDO0FBQUEsU0FBTWxHLENBQUMsQ0FBQyxrQkFBRCxDQUFELENBQXNCbUcsUUFBdEIsQ0FBK0IsUUFBL0IsQ0FBTjtBQUFBLENBQXJDO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0FuRyxDQUFDLENBQUNpRyxFQUFGLENBQUtsRSxJQUFMLENBQVVnRCxRQUFWLENBQW1CcEUsS0FBbkIsQ0FBeUJ5RixrQkFBekIsR0FBOEMsVUFBQ0MsS0FBRCxFQUFXO0FBQ3JELE1BQUlDLEtBQUssR0FBRyxDQUFaO0FBQ0F0RyxFQUFBQSxDQUFDLENBQUMscUJBQUQsQ0FBRCxDQUF5Qm1GLElBQXpCLENBQThCLFVBQUNDLEtBQUQsRUFBUUMsR0FBUixFQUFnQjtBQUMxQyxRQUFJdkYsT0FBTyxDQUFDQyxRQUFSLENBQWlCZ0MsSUFBakIsQ0FBc0IsV0FBdEIsWUFBc0NzRCxHQUFHLENBQUN2QixFQUExQyxPQUFvRHVDLEtBQXhELEVBQStEQyxLQUFLLElBQUksQ0FBVDtBQUNsRSxHQUZEO0FBSUEsU0FBUUEsS0FBSyxLQUFLLENBQWxCO0FBQ0gsQ0FQRDtBQVNBO0FBQ0E7QUFDQTs7O0FBQ0F0RyxDQUFDLENBQUN1RyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3BCMUcsRUFBQUEsT0FBTyxDQUFDNkIsVUFBUjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgaXZyQWN0aW9ucywgZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBFeHRlbnNpb25zLCBTb3VuZEZpbGVzU2VsZWN0b3IgKi9cblxuXG5jb25zdCBpdnJNZW51ID0ge1xuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNpdnItbWVudS1mb3JtJyksXG5cbiAgICAkZHJvcERvd25zOiAkKCcjaXZyLW1lbnUtZm9ybSAudWkuZHJvcGRvd24nKSxcbiAgICAkbnVtYmVyOiAkKCcjZXh0ZW5zaW9uJyksXG5cbiAgICAvKipcbiAgICAgKiBEaXJ0eSBjaGVjayBmaWVsZCwgZm9yIGNoZWNraW5nIGlmIHNvbWV0aGluZyBvbiB0aGUgZm9ybSB3YXMgY2hhbmdlZFxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cbiAgICAkZXJyb3JNZXNzYWdlczogJCgnI2Zvcm0tZXJyb3ItbWVzc2FnZXMnKSxcbiAgICAkcm93VGVtcGxhdGU6ICQoJyNyb3ctdGVtcGxhdGUnKSxcbiAgICBkZWZhdWx0RXh0ZW5zaW9uOiAnJyxcbiAgICBhY3Rpb25zUm93c0NvdW50OiAwLFxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0gZmllbGRzIGJlZm9yZSBzdWJtaXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVJ1bGVzOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICduYW1lJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBleHRlbnNpb246IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdleHRlbnNpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2V4aXN0UnVsZScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVvdXRfZXh0ZW5zaW9uOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAndGltZW91dF9leHRlbnNpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlVGltZW91dEV4dGVuc2lvbklzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIGF1ZGlvX21lc3NhZ2VfaWQ6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdhdWRpb19tZXNzYWdlX2lkJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVvdXQ6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICd0aW1lb3V0JyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW50ZWdlclswLi45OV0nLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRPdXRPZlJhbmdlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBudW1iZXJfb2ZfcmVwZWF0OiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAnbnVtYmVyX29mX3JlcGVhdCcsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVnZXJbMC4uOTldJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVSZXBlYXROdW1iZXJPdXRPZlJhbmdlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICAvLyBJbml0aWFsaXplIGRyb3Bkb3duc1xuICAgICAgICBpdnJNZW51LiRkcm9wRG93bnMuZHJvcGRvd24oKTtcblxuICAgICAgICAvLyBEeW5hbWljIGNoZWNrIHRvIHNlZSBpZiB0aGUgc2VsZWN0ZWQgbnVtYmVyIGlzIGF2YWlsYWJsZVxuICAgICAgICBpdnJNZW51LiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld051bWJlciA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuICAgICAgICAgICAgRXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShpdnJNZW51LmRlZmF1bHROdW1iZXIsIG5ld051bWJlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3IgYWRkaW5nIGEgbmV3IElWUiBhY3Rpb24gcm93XG4gICAgICAgICQoJyNhZGQtbmV3LWl2ci1hY3Rpb24nKS5vbignY2xpY2snLCAoZWwpID0+IHtcbiAgICAgICAgICAgIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG4gICAgICAgICAgICBpdnJNZW51LnJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKTtcblxuICAgICAgICAgICAgLy8gQ2hhbmdlIHRoZSB2YWx1ZSBvZiAnJGRpcnJ0eUZpZWxkJyB0byB0cmlnZ2VyXG4gICAgICAgICAgICAvLyB0aGUgJ2NoYW5nZScgZm9ybSBldmVudCBhbmQgZW5hYmxlIHN1Ym1pdCBidXR0b24uXG4gICAgICAgICAgICBpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG4gICAgICAgICAgICBpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblxuICAgICAgICAgICAgZWwucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBJbml0aWFsaXplIGF1ZGlvIG1lc3NhZ2UgZHJvcGRvd25zXG4gICAgICAgICQoJyNpdnItbWVudS1mb3JtIC5hdWRpby1tZXNzYWdlLXNlbGVjdCcpLmRyb3Bkb3duKFNvdW5kRmlsZXNTZWxlY3Rvci5nZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5KCkpO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGZvcm1cbiAgICAgICAgaXZyTWVudS5pbml0aWFsaXplRm9ybSgpO1xuXG4gICAgICAgIC8vIEJ1aWxkIElWUiBtZW51IGFjdGlvbnNcbiAgICAgICAgaXZyTWVudS5idWlsZEl2ck1lbnVBY3Rpb25zKCk7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBkZWZhdWx0IGV4dGVuc2lvbiB2YWx1ZVxuICAgICAgICBpdnJNZW51LmRlZmF1bHRFeHRlbnNpb24gPSBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdleHRlbnNpb24nKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBpdnIgbWVudSBpdGVtcyBvbiB0aGUgZm9ybVxuICAgICAqL1xuICAgIGJ1aWxkSXZyTWVudUFjdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IG9iakFjdGlvbnMgPSBKU09OLnBhcnNlKGl2ckFjdGlvbnMpO1xuICAgICAgICBvYmpBY3Rpb25zLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KGVsZW1lbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG9iakFjdGlvbnMubGVuZ3RoID09PSAwKSBpdnJNZW51LmFkZE5ld0FjdGlvblJvdygpO1xuXG4gICAgICAgIGl2ck1lbnUucmVidWlsZEFjdGlvbkV4dGVuc2lvbnNEcm9wZG93bigpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBZGRzIG5ldyBmb3JtIHZhbGlkYXRpb24gcnVsZXMgZm9yIGEgbmV3bHkgYWRkZWQgYWN0aW9uIHJvdy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3Um93SWQgLSBUaGUgSUQgb2YgdGhlIG5ld2x5IGFkZGVkIGFjdGlvbiByb3cuXG4gICAgICovXG4gICAgYWRkTmV3Rm9ybVJ1bGVzKG5ld1Jvd0lkKSB7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBpZGVudGlmaWVyIGZvciB0aGUgZGlnaXRzIGZpZWxkIG9mIHRoZSBuZXcgcm93XG4gICAgICAgIGNvbnN0ICRkaWdpdHNDbGFzcyA9IGBkaWdpdHMtJHtuZXdSb3dJZH1gO1xuXG4gICAgICAgIC8vIERlZmluZSB0aGUgdmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGRpZ2l0cyBmaWVsZFxuICAgICAgICBpdnJNZW51LnZhbGlkYXRlUnVsZXNbJGRpZ2l0c0NsYXNzXSA9IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICRkaWdpdHNDbGFzcyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncmVnRXhwWy9eWzAtOV17MSw3fSQvXScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRGlnaXRzSXNOb3RDb3JyZWN0LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tEb3VibGVzRGlnaXRzJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBDcmVhdGUgdGhlIGlkZW50aWZpZXIgZm9yIHRoZSBleHRlbnNpb24gZmllbGQgb2YgdGhlIG5ldyByb3dcbiAgICAgICAgY29uc3QgJGV4dGVuc2lvbkNsYXNzID0gYGV4dGVuc2lvbi0ke25ld1Jvd0lkfWA7XG5cbiAgICAgICAgLy8gRGVmaW5lIHRoZSB2YWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgZXh0ZW5zaW9uIGZpZWxkXG4gICAgICAgIGl2ck1lbnUudmFsaWRhdGVSdWxlc1skZXh0ZW5zaW9uQ2xhc3NdID0ge1xuICAgICAgICAgICAgaWRlbnRpZmllcjogJGV4dGVuc2lvbkNsYXNzLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBuZXcgYWN0aW9uIHJvdyB0byB0aGUgSVZSIG1lbnUgZm9ybS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1PYmogLSBPcHRpb25hbCBwYXJhbWV0ZXIgb2JqZWN0IHdpdGggaW5pdGlhbCB2YWx1ZXMgZm9yIHRoZSBhY3Rpb24gcm93LlxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdCB2YWx1ZXMgd2lsbCBiZSB1c2VkLlxuICAgICAqL1xuICAgIGFkZE5ld0FjdGlvblJvdyhwYXJhbU9iaikge1xuICAgICAgICAvLyBEZWZhdWx0IHBhcmFtZXRlciB2YWx1ZXNcbiAgICAgICAgbGV0IHBhcmFtID0ge1xuICAgICAgICAgICAgaWQ6ICcnLFxuICAgICAgICAgICAgZXh0ZW5zaW9uOiAnJyxcbiAgICAgICAgICAgIGV4dGVuc2lvblJlcHJlc2VudDogJycsXG4gICAgICAgICAgICBkaWdpdHM6ICcnLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIE92ZXJyaWRlIGRlZmF1bHQgdmFsdWVzIHdpdGggdGhlIHByb3ZpZGVkIHBhcmFtZXRlciBvYmplY3RcbiAgICAgICAgaWYgKHBhcmFtT2JqICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtID0gcGFyYW1PYmo7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGFjdGlvbnNSb3dzQ291bnRcbiAgICAgICAgaXZyTWVudS5hY3Rpb25zUm93c0NvdW50ICs9IDE7XG5cbiAgICAgICAgLy8gQ2xvbmUgdGhlIHJvdyB0ZW1wbGF0ZSBhbmQgbW9kaWZ5IGl0cyBhdHRyaWJ1dGVzIGFuZCBjb250ZW50XG4gICAgICAgIGNvbnN0ICRhY3Rpb25UZW1wbGF0ZSA9IGl2ck1lbnUuJHJvd1RlbXBsYXRlLmNsb25lKCk7XG4gICAgICAgICRhY3Rpb25UZW1wbGF0ZVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdoaWRkZW4nKVxuICAgICAgICAgICAgLmF0dHIoJ2lkJywgYHJvdy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuICAgICAgICAgICAgLmF0dHIoJ2RhdGEtdmFsdWUnLCBpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQpXG4gICAgICAgICAgICAuYXR0cignc3R5bGUnLCAnJyk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBhdHRyaWJ1dGVzIGFuZCB2YWx1ZXMgZm9yIGRpZ2l0cyBpbnB1dCBmaWVsZFxuICAgICAgICAkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImRpZ2l0cy1pZFwiXScpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBgZGlnaXRzLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG4gICAgICAgICAgICAuYXR0cignbmFtZScsIGBkaWdpdHMtJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcbiAgICAgICAgICAgIC5hdHRyKCd2YWx1ZScsIHBhcmFtLmRpZ2l0cyk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBhdHRyaWJ1dGVzIGFuZCB2YWx1ZXMgZm9yIGV4dGVuc2lvbiBpbnB1dCBmaWVsZFxuICAgICAgICAkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImV4dGVuc2lvbi1pZFwiXScpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBgZXh0ZW5zaW9uLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG4gICAgICAgICAgICAuYXR0cignbmFtZScsIGBleHRlbnNpb24tJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcbiAgICAgICAgICAgIC5hdHRyKCd2YWx1ZScsIHBhcmFtLmV4dGVuc2lvbik7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBkYXRhLXZhbHVlIGF0dHJpYnV0ZSBmb3IgdGhlIGRlbGV0ZS1hY3Rpb24tcm93IGVsZW1lbnRcbiAgICAgICAgJGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWxldGUtYWN0aW9uLXJvdycpXG4gICAgICAgICAgICAuYXR0cignZGF0YS12YWx1ZScsIGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBleHRlbnNpb25SZXByZXNlbnQgY29udGVudCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgdmFsdWUgb3IgZGVmYXVsdCB0ZXh0XG4gICAgICAgIGlmIChwYXJhbS5leHRlbnNpb25SZXByZXNlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgJGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWZhdWx0LnRleHQnKS5yZW1vdmVDbGFzcygnZGVmYXVsdCcpLmh0bWwocGFyYW0uZXh0ZW5zaW9uUmVwcmVzZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVmYXVsdC50ZXh0JykuaHRtbChnbG9iYWxUcmFuc2xhdGUuZXhfU2VsZWN0TnVtYmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgYWN0aW9uIHRlbXBsYXRlIHRvIHRoZSBhY3Rpb25zLXBsYWNlIGVsZW1lbnRcbiAgICAgICAgJCgnI2FjdGlvbnMtcGxhY2UnKS5hcHBlbmQoJGFjdGlvblRlbXBsYXRlKTtcblxuICAgICAgICAvLyBBZGQgbmV3IGZvcm0gcnVsZXMgZm9yIHRoZSBuZXdseSBhZGRlZCBhY3Rpb24gcm93XG4gICAgICAgIGl2ck1lbnUuYWRkTmV3Rm9ybVJ1bGVzKGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJlYnVpbGRzIHRoZSBhY3Rpb24gZXh0ZW5zaW9ucyBkcm9wZG93biBieSBpbml0aWFsaXppbmcgdGhlIGRyb3Bkb3duIHNldHRpbmdzIGZvciByb3V0aW5nXG4gICAgICogYW5kIGF0dGFjaGluZyB0aGUgY2JPbkV4dGVuc2lvblNlbGVjdCBjYWxsYmFjayBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGV4dGVuc2lvbiBzZWxlY3Rpb24gZXZlbnQuXG4gICAgICovXG4gICAgcmVidWlsZEFjdGlvbkV4dGVuc2lvbnNEcm9wZG93bigpIHtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZHJvcGRvd24gc2V0dGluZ3MgZm9yIHJvdXRpbmcgd2l0aCBjYk9uRXh0ZW5zaW9uU2VsZWN0IGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICAgICQoJyNpdnItbWVudS1mb3JtIC5mb3J3YXJkaW5nLXNlbGVjdCcpLmRyb3Bkb3duKEV4dGVuc2lvbnMuZ2V0RHJvcGRvd25TZXR0aW5nc0ZvclJvdXRpbmcoaXZyTWVudS5jYk9uRXh0ZW5zaW9uU2VsZWN0KSk7XG5cbiAgICAgICAgLy8gQXR0YWNoIGEgY2xpY2sgZXZlbnQgaGFuZGxlciB0byB0aGUgZGVsZXRlLWFjdGlvbi1yb3cgZWxlbWVudHNcbiAgICAgICAgJCgnLmRlbGV0ZS1hY3Rpb24tcm93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSAnZGF0YS12YWx1ZScgYXR0cmlidXRlIG9mIHRoZSBjbGlja2VkIGVsZW1lbnRcbiAgICAgICAgICAgIGNvbnN0IGlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY29ycmVzcG9uZGluZyBydWxlcyBmcm9tIHZhbGlkYXRlUnVsZXMgb2JqZWN0XG4gICAgICAgICAgICBkZWxldGUgaXZyTWVudS52YWxpZGF0ZVJ1bGVzW2BkaWdpdHMtJHtpZH1gXTtcbiAgICAgICAgICAgIGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGV4dGVuc2lvbi0ke2lkfWBdO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHJvdyB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGlkXG4gICAgICAgICAgICAkKGAjcm93LSR7aWR9YCkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIENoYW5nZSB0aGUgdmFsdWUgb2YgJyRkaXJydHlGaWVsZCcgdG8gdHJpZ2dlclxuICAgICAgICAgICAgLy8gdGhlICdjaGFuZ2UnIGZvcm0gZXZlbnQgYW5kIGVuYWJsZSBzdWJtaXQgYnV0dG9uLlxuICAgICAgICAgICAgaXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuICAgICAgICAgICAgaXZyTWVudS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgYmVmb3JlIHRoZSBmb3JtIGlzIHNlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgLSBUaGUgY3VycmVudCBzZXR0aW5ncyBvZiB0aGUgZm9ybVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IC0gVGhlIHVwZGF0ZWQgc2V0dGluZ3Mgb2YgdGhlIGZvcm1cbiAgICAgKi9cbiAgICBjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG4gICAgICAgIC8vIENvcHkgdGhlIHNldHRpbmdzIG9iamVjdCB0byBhIG5ldyB2YXJpYWJsZSB0byBhdm9pZCBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsXG4gICAgICAgIGxldCByZXN1bHQgPSBzZXR0aW5ncztcblxuICAgICAgICAvLyBHZXQgdGhlIGZvcm0gdmFsdWVzIGZyb20gJGZvcm1PYmogb2YgaXZyTWVudVxuICAgICAgICByZXN1bHQuZGF0YSA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgYW4gYXJyYXkgdG8gc3RvcmUgYWN0aW9uc1xuICAgICAgICBjb25zdCBhcnJBY3Rpb25zID0gW107XG5cbiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGVhY2ggYWN0aW9uIHJvd1xuICAgICAgICAkKCcuYWN0aW9uLXJvdycpLmVhY2goKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJvd0lkID0gJChvYmopLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblxuICAgICAgICAgICAgLy8gSWYgcm93SWQgaXMgZ3JlYXRlciB0aGFuIDAsIGdldCB0aGUgJ2RpZ2l0cycgYW5kICdleHRlbnNpb24nIHZhbHVlcyBmcm9tIHRoZSBmb3JtIGFuZCBwdXNoIHRoZW0gaW50byB0aGUgYXJyQWN0aW9ucyBhcnJheVxuICAgICAgICAgICAgaWYgKHJvd0lkID4gMCkge1xuICAgICAgICAgICAgICAgIGFyckFjdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGRpZ2l0czogaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgZGlnaXRzLSR7cm93SWR9YCksXG4gICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgZXh0ZW5zaW9uLSR7cm93SWR9YCksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSBubyBhY3Rpb24gcm93cywgc2V0IHRoZSByZXN1bHQgdG8gZmFsc2UsIGRpc3BsYXkgYW4gZXJyb3IgbWVzc2FnZSBhbmQgYWRkIGVycm9yIGNsYXNzIHRvIHRoZSBmb3JtXG4gICAgICAgIGlmIChhcnJBY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICBpdnJNZW51LiRlcnJvck1lc3NhZ2VzLmh0bWwoZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlTm9JVlJFeHRlbnNpb25zKTtcbiAgICAgICAgICAgIGl2ck1lbnUuJGZvcm1PYmouYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIGFyckFjdGlvbnMgYXJyYXkgaW50byBhIEpTT04gc3RyaW5nIGFuZCBhc3NpZ24gaXQgdG8gJ2FjdGlvbnMnIGtleSBpbiB0aGUgcmVzdWx0IGRhdGEgb2JqZWN0XG4gICAgICAgICAgICByZXN1bHQuZGF0YS5hY3Rpb25zID0gSlNPTi5zdHJpbmdpZnkoYXJyQWN0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIHNldHRpbmdzIG9iamVjdCBvciBmYWxzZVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCB0cmlnZ2VycyB3aGVuIGEgbnVtYmVyIGlzIHNlbGVjdGVkIGZyb20gdGhlIGRyb3Bkb3duIG1lbnUuXG4gICAgICogSXQgZ2VuZXJhdGVzIGEgcmFuZG9tIG51bWJlciBhbmQgdHJpZ2dlcnMgYSBjaGFuZ2UgZXZlbnQuXG4gICAgICovXG4gICAgY2JPbkV4dGVuc2lvblNlbGVjdCgpIHtcblxuICAgICAgICAvLyBDaGFuZ2UgdGhlIHZhbHVlIG9mICckZGlycnR5RmllbGQnIHRvIHRyaWdnZXJcbiAgICAgICAgLy8gdGhlICdjaGFuZ2UnIGZvcm0gZXZlbnQgYW5kIGVuYWJsZSBzdWJtaXQgYnV0dG9uLlxuICAgICAgICBpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG4gICAgICAgIGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGZvcm0gaGFzIGJlZW4gc2VudC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIGFmdGVyIHRoZSBmb3JtIGlzIHNlbnRcbiAgICAgKi9cbiAgICBjYkFmdGVyU2VuZEZvcm0ocmVzcG9uc2UpIHtcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBmb3JtIHdpdGggY3VzdG9tIHNldHRpbmdzXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUZvcm0oKSB7XG4gICAgICAgIEZvcm0uJGZvcm1PYmogPSBpdnJNZW51LiRmb3JtT2JqO1xuICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9aXZyLW1lbnUvc2F2ZWA7IC8vIEZvcm0gc3VibWlzc2lvbiBVUkxcbiAgICAgICAgRm9ybS52YWxpZGF0ZVJ1bGVzID0gaXZyTWVudS52YWxpZGF0ZVJ1bGVzOyAvLyBGb3JtIHZhbGlkYXRpb24gcnVsZXNcbiAgICAgICAgRm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gaXZyTWVudS5jYkJlZm9yZVNlbmRGb3JtOyAvLyBDYWxsYmFjayBiZWZvcmUgZm9ybSBpcyBzZW50XG4gICAgICAgIEZvcm0uY2JBZnRlclNlbmRGb3JtID0gaXZyTWVudS5jYkFmdGVyU2VuZEZvcm07IC8vIENhbGxiYWNrIGFmdGVyIGZvcm0gaXMgc2VudFxuICAgICAgICBGb3JtLmluaXRpYWxpemUoKTtcbiAgICB9LFxufTtcblxuLyoqXG4gKiBDdXN0b20gZm9ybSBydWxlIHRvIGNoZWNrIGlmIGFuIGVsZW1lbnQgd2l0aCBpZCAnZXh0ZW5zaW9uLWVycm9yJyBoYXMgdGhlIGNsYXNzICdoaWRkZW4nLlxuICovXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZXhpc3RSdWxlID0gKCkgPT4gJCgnI2V4dGVuc2lvbi1lcnJvcicpLmhhc0NsYXNzKCdoaWRkZW4nKTtcblxuXG4vKipcbiAqIEN1c3RvbSBmb3JtIHJ1bGUgdG8gY2hlY2sgZm9yIGR1cGxpY2F0ZSBkaWdpdHMgdmFsdWVzLlxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNoZWNrIGZvciBkdXBsaWNhdGVzLlxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBpZiB0aGVyZSBhcmUgbm8gZHVwbGljYXRlcywgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuY2hlY2tEb3VibGVzRGlnaXRzID0gKHZhbHVlKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICAkKFwiaW5wdXRbaWRePSdkaWdpdHMnXVwiKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgIGlmIChpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGAke29iai5pZH1gKSA9PT0gdmFsdWUpIGNvdW50ICs9IDE7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gKGNvdW50ID09PSAxKTtcbn07XG5cbi8qKlxuICogIEluaXRpYWxpemUgSVZSIG1lbnUgbW9kaWZ5IGZvcm0gb24gZG9jdW1lbnQgcmVhZHlcbiAqL1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIGl2ck1lbnUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==