"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright © 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions, SoundFilesSelector */
$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};

var ivrMenu = {
  $formObj: $('#ivr-menu-form'),
  $dropDowns: $('#ivr-menu-form .ui.dropdown'),
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function initialize() {
    ivrMenu.$dropDowns.dropdown(); // Динамическая прововерка свободен ли выбранный номер

    ivrMenu.$number.on('change', function () {
      var newNumber = ivrMenu.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
    });
    $('#add-new-ivr-action').on('click', function (el) {
      ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown();
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
      el.preventDefault();
    });
    $('#ivr-menu-form .audio-message-select').dropdown(SoundFilesSelector.getDropdownSettingsWithEmpty());
    ivrMenu.initializeForm();
    ivrMenu.buildIvrMenuActions();
    ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
  },

  /**
   * Create ivr menu items on the form
   */
  buildIvrMenuActions: function buildIvrMenuActions() {
    var objActions = JSON.parse(ivrActions);
    objActions.forEach(function (element) {
      ivrMenu.addNewActionRow(element);
    });
    if (objActions.length === 0) ivrMenu.addNewActionRow();
    ivrMenu.rebuildActionExtensionsDropdown();
  },
  addNewFormRules: function addNewFormRules(newRowId) {
    var $digitsClass = "digits-".concat(newRowId);
    ivrMenu.validateRules[$digitsClass] = {
      identifier: $digitsClass,
      rules: [{
        type: 'regExp[/^[0-9]{1,7}$/]',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }, {
        type: 'checkDoublesDigits',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }]
    };
    var $extensionClass = "extension-".concat(newRowId);
    ivrMenu.validateRules[$extensionClass] = {
      identifier: $extensionClass,
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
      }]
    };
  },
  addNewActionRow: function addNewActionRow(paramObj) {
    var param = {
      id: '',
      extension: '',
      extensionRepresent: '',
      digits: ''
    };

    if (paramObj !== undefined) {
      param = paramObj;
    }

    ivrMenu.actionsRowsCount += 1;
    var $actionTemplate = ivrMenu.$rowTemplate.clone();
    $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', '');
    $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits);
    $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension);
    $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount);

    if (param.extensionRepresent.length > 0) {
      $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
    } else {
      $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
    }

    $('#actions-place').append($actionTemplate);
    ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
  },
  rebuildActionExtensionsDropdown: function rebuildActionExtensionsDropdown() {
    $('#ivr-menu-form .forwarding-select').dropdown(Extensions.getDropdownSettingsForRouting(ivrMenu.cbOnExtensionSelect));
    $('.delete-action-row').on('click', function (e) {
      e.preventDefault();
      var id = $(this).attr('data-value');
      delete ivrMenu.validateRules["digits-".concat(id)];
      delete ivrMenu.validateRules["extension-".concat(id)];
      $("#row-".concat(id)).remove();
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
    });
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = ivrMenu.$formObj.form('get values');
    var arrActions = [];
    $('.action-row').each(function (index, obj) {
      var rowId = $(obj).attr('data-value');

      if (rowId > 0) {
        arrActions.push({
          digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
          extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
        });
      }
    });

    if (arrActions.length === 0) {
      result = false;
      ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
      ivrMenu.$formObj.addClass('error');
    } else {
      result.data.actions = JSON.stringify(arrActions);
    }

    return result;
  },

  /**
   * Срабатывает при выборе номера из выпадающего списка
   */
  cbOnExtensionSelect: function cbOnExtensionSelect() {
    ivrMenu.$dirrtyField.val(Math.random());
    ivrMenu.$dirrtyField.trigger('change');
  },
  cbAfterSendForm: function cbAfterSendForm() {},
  initializeForm: function initializeForm() {
    Form.$formObj = ivrMenu.$formObj;
    Form.url = "".concat(globalRootUrl, "ivr-menu/save");
    Form.validateRules = ivrMenu.validateRules;
    Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm;
    Form.cbAfterSendForm = ivrMenu.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};

$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsImZvcm0iLCJzZXR0aW5ncyIsInJ1bGVzIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJpdnJNZW51IiwiJGZvcm1PYmoiLCIkZHJvcERvd25zIiwiJG51bWJlciIsIiRkaXJydHlGaWVsZCIsIiRlcnJvck1lc3NhZ2VzIiwiJHJvd1RlbXBsYXRlIiwiZGVmYXVsdEV4dGVuc2lvbiIsImFjdGlvbnNSb3dzQ291bnQiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiaXZfVmFsaWRhdGVOYW1lSXNFbXB0eSIsImV4dGVuc2lvbiIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUiLCJ0aW1lb3V0X2V4dGVuc2lvbiIsIml2X1ZhbGlkYXRlVGltZW91dEV4dGVuc2lvbklzRW1wdHkiLCJhdWRpb19tZXNzYWdlX2lkIiwiaXZfVmFsaWRhdGVBdWRpb0ZpbGVJc0VtcHR5IiwidGltZW91dCIsIml2X1ZhbGlkYXRlVGltZW91dE91dE9mUmFuZ2UiLCJudW1iZXJfb2ZfcmVwZWF0IiwiaXZfVmFsaWRhdGVSZXBlYXROdW1iZXJPdXRPZlJhbmdlIiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib24iLCJuZXdOdW1iZXIiLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiZWwiLCJhZGROZXdBY3Rpb25Sb3ciLCJyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJwcmV2ZW50RGVmYXVsdCIsIlNvdW5kRmlsZXNTZWxlY3RvciIsImdldERyb3Bkb3duU2V0dGluZ3NXaXRoRW1wdHkiLCJpbml0aWFsaXplRm9ybSIsImJ1aWxkSXZyTWVudUFjdGlvbnMiLCJvYmpBY3Rpb25zIiwiSlNPTiIsInBhcnNlIiwiaXZyQWN0aW9ucyIsImZvckVhY2giLCJlbGVtZW50IiwibGVuZ3RoIiwiYWRkTmV3Rm9ybVJ1bGVzIiwibmV3Um93SWQiLCIkZGlnaXRzQ2xhc3MiLCJpdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCIsIiRleHRlbnNpb25DbGFzcyIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0IiwicGFyYW1PYmoiLCJwYXJhbSIsImlkIiwiZXh0ZW5zaW9uUmVwcmVzZW50IiwiZGlnaXRzIiwidW5kZWZpbmVkIiwiJGFjdGlvblRlbXBsYXRlIiwiY2xvbmUiLCJyZW1vdmVDbGFzcyIsImF0dHIiLCJmaW5kIiwiaHRtbCIsImV4X1NlbGVjdE51bWJlciIsImFwcGVuZCIsImdldERyb3Bkb3duU2V0dGluZ3NGb3JSb3V0aW5nIiwiY2JPbkV4dGVuc2lvblNlbGVjdCIsImUiLCJyZW1vdmUiLCJjYkJlZm9yZVNlbmRGb3JtIiwicmVzdWx0IiwiZGF0YSIsImFyckFjdGlvbnMiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJyb3dJZCIsInB1c2giLCJpdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyIsImFkZENsYXNzIiwiYWN0aW9ucyIsInN0cmluZ2lmeSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiY2hlY2tEb3VibGVzRGlnaXRzIiwidmFsdWUiLCJjb3VudCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBQSxDQUFDLENBQUNDLEVBQUYsQ0FBS0MsSUFBTCxDQUFVQyxRQUFWLENBQW1CQyxLQUFuQixDQUF5QkMsU0FBekIsR0FBcUM7QUFBQSxTQUFNTCxDQUFDLENBQUMsa0JBQUQsQ0FBRCxD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ZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgaXZyQWN0aW9ucywgZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBFeHRlbnNpb25zLCBTb3VuZEZpbGVzU2VsZWN0b3IgKi9cblxuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmV4aXN0UnVsZSA9ICgpID0+ICQoJyNleHRlbnNpb24tZXJyb3InKS5oYXNDbGFzcygnaGlkZGVuJyk7XG5cbmNvbnN0IGl2ck1lbnUgPSB7XG5cdCRmb3JtT2JqOiAkKCcjaXZyLW1lbnUtZm9ybScpLFxuXHQkZHJvcERvd25zOiAkKCcjaXZyLW1lbnUtZm9ybSAudWkuZHJvcGRvd24nKSxcblx0JG51bWJlcjogJCgnI2V4dGVuc2lvbicpLFxuXHQkZGlycnR5RmllbGQ6ICQoJyNkaXJydHknKSxcblx0JGVycm9yTWVzc2FnZXM6ICQoJyNmb3JtLWVycm9yLW1lc3NhZ2VzJyksXG5cdCRyb3dUZW1wbGF0ZTogJCgnI3Jvdy10ZW1wbGF0ZScpLFxuXHRkZWZhdWx0RXh0ZW5zaW9uOiAnJyxcblx0YWN0aW9uc1Jvd3NDb3VudDogMCxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICduYW1lJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlTmFtZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdleGlzdFJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0dGltZW91dF9leHRlbnNpb246IHtcblx0XHRcdGlkZW50aWZpZXI6ICd0aW1lb3V0X2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRFeHRlbnNpb25Jc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGF1ZGlvX21lc3NhZ2VfaWQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdhdWRpb19tZXNzYWdlX2lkJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlQXVkaW9GaWxlSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHR0aW1lb3V0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAndGltZW91dCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2ludGVnZXJbMC4uOTldJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRPdXRPZlJhbmdlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdG51bWJlcl9vZl9yZXBlYXQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdudW1iZXJfb2ZfcmVwZWF0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnaW50ZWdlclswLi45OV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlUmVwZWF0TnVtYmVyT3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblxuXHRpbml0aWFsaXplKCkge1xuXHRcdGl2ck1lbnUuJGRyb3BEb3ducy5kcm9wZG93bigpO1xuXG5cdFx0Ly8g0JTQuNC90LDQvNC40YfQtdGB0LrQsNGPINC/0YDQvtCy0L7QstC10YDQutCwINGB0LLQvtCx0L7QtNC10L0g0LvQuCDQstGL0LHRgNCw0L3QvdGL0Lkg0L3QvtC80LXRgFxuXHRcdGl2ck1lbnUuJG51bWJlci5vbignY2hhbmdlJywgKCkgPT4ge1xuXHRcdFx0Y29uc3QgbmV3TnVtYmVyID0gaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdFx0XHRFeHRlbnNpb25zLmNoZWNrQXZhaWxhYmlsaXR5KGl2ck1lbnUuZGVmYXVsdE51bWJlciwgbmV3TnVtYmVyKTtcblx0XHR9KTtcblxuXHRcdCQoJyNhZGQtbmV3LWl2ci1hY3Rpb24nKS5vbignY2xpY2snLCAoZWwpID0+IHtcblx0XHRcdGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG5cdFx0XHRpdnJNZW51LnJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKTtcblx0XHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0ZWwucHJldmVudERlZmF1bHQoKTtcblx0XHR9KTtcblx0XHQkKCcjaXZyLW1lbnUtZm9ybSAuYXVkaW8tbWVzc2FnZS1zZWxlY3QnKS5kcm9wZG93bihTb3VuZEZpbGVzU2VsZWN0b3IuZ2V0RHJvcGRvd25TZXR0aW5nc1dpdGhFbXB0eSgpKTtcblxuXHRcdGl2ck1lbnUuaW5pdGlhbGl6ZUZvcm0oKTtcblxuXHRcdGl2ck1lbnUuYnVpbGRJdnJNZW51QWN0aW9ucygpO1xuXG5cdFx0aXZyTWVudS5kZWZhdWx0RXh0ZW5zaW9uID0gaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdH0sXG5cdC8qKlxuXHQgKiBDcmVhdGUgaXZyIG1lbnUgaXRlbXMgb24gdGhlIGZvcm1cblx0ICovXG5cdGJ1aWxkSXZyTWVudUFjdGlvbnMoKSB7XG5cdFx0Y29uc3Qgb2JqQWN0aW9ucyA9IEpTT04ucGFyc2UoaXZyQWN0aW9ucyk7XG5cdFx0b2JqQWN0aW9ucy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG5cdFx0XHRpdnJNZW51LmFkZE5ld0FjdGlvblJvdyhlbGVtZW50KTtcblx0XHR9KTtcblx0XHRpZiAob2JqQWN0aW9ucy5sZW5ndGggPT09IDApIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG5cblx0XHRpdnJNZW51LnJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKTtcblx0fSxcblx0YWRkTmV3Rm9ybVJ1bGVzKG5ld1Jvd0lkKSB7XG5cdFx0Y29uc3QgJGRpZ2l0c0NsYXNzID0gYGRpZ2l0cy0ke25ld1Jvd0lkfWA7XG5cdFx0aXZyTWVudS52YWxpZGF0ZVJ1bGVzWyRkaWdpdHNDbGFzc10gPSB7XG5cdFx0XHRpZGVudGlmaWVyOiAkZGlnaXRzQ2xhc3MsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ3JlZ0V4cFsvXlswLTldezEsN30kL10nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRGlnaXRzSXNOb3RDb3JyZWN0LFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2NoZWNrRG91Ymxlc0RpZ2l0cycsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXG5cdFx0fTtcblx0XHRjb25zdCAkZXh0ZW5zaW9uQ2xhc3MgPSBgZXh0ZW5zaW9uLSR7bmV3Um93SWR9YDtcblx0XHRpdnJNZW51LnZhbGlkYXRlUnVsZXNbJGV4dGVuc2lvbkNsYXNzXSA9IHtcblx0XHRcdGlkZW50aWZpZXI6ICRleHRlbnNpb25DbGFzcyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblxuXHRcdH07XG5cdH0sXG5cdGFkZE5ld0FjdGlvblJvdyhwYXJhbU9iaikge1xuXHRcdGxldCBwYXJhbSA9IHtcblx0XHRcdGlkOiAnJyxcblx0XHRcdGV4dGVuc2lvbjogJycsXG5cdFx0XHRleHRlbnNpb25SZXByZXNlbnQ6ICcnLFxuXHRcdFx0ZGlnaXRzOiAnJyxcblx0XHR9O1xuXHRcdGlmIChwYXJhbU9iaiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRwYXJhbSA9IHBhcmFtT2JqO1xuXHRcdH1cblx0XHRpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQgKz0gMTtcblx0XHRjb25zdCAkYWN0aW9uVGVtcGxhdGUgPSBpdnJNZW51LiRyb3dUZW1wbGF0ZS5jbG9uZSgpO1xuXHRcdCRhY3Rpb25UZW1wbGF0ZVxuXHRcdFx0LnJlbW92ZUNsYXNzKCdoaWRkZW4nKVxuXHRcdFx0LmF0dHIoJ2lkJywgYHJvdy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ2RhdGEtdmFsdWUnLCBpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQpXG5cdFx0XHQuYXR0cignc3R5bGUnLCAnJyk7XG5cblx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImRpZ2l0cy1pZFwiXScpXG5cdFx0XHQuYXR0cignaWQnLCBgZGlnaXRzLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cignbmFtZScsIGBkaWdpdHMtJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCd2YWx1ZScsIHBhcmFtLmRpZ2l0cyk7XG5cblx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImV4dGVuc2lvbi1pZFwiXScpXG5cdFx0XHQuYXR0cignaWQnLCBgZXh0ZW5zaW9uLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cignbmFtZScsIGBleHRlbnNpb24tJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCd2YWx1ZScsIHBhcmFtLmV4dGVuc2lvbik7XG5cdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWxldGUtYWN0aW9uLXJvdycpXG5cdFx0XHQuYXR0cignZGF0YS12YWx1ZScsIGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG5cblx0XHRpZiAocGFyYW0uZXh0ZW5zaW9uUmVwcmVzZW50Lmxlbmd0aCA+IDApIHtcblx0XHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVmYXVsdC50ZXh0JykucmVtb3ZlQ2xhc3MoJ2RlZmF1bHQnKS5odG1sKHBhcmFtLmV4dGVuc2lvblJlcHJlc2VudCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVmYXVsdC50ZXh0JykuaHRtbChnbG9iYWxUcmFuc2xhdGUuZXhfU2VsZWN0TnVtYmVyKTtcblx0XHR9XG5cblx0XHQkKCcjYWN0aW9ucy1wbGFjZScpLmFwcGVuZCgkYWN0aW9uVGVtcGxhdGUpO1xuXHRcdGl2ck1lbnUuYWRkTmV3Rm9ybVJ1bGVzKGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG5cdH0sXG5cdHJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKSB7XG5cdFx0JCgnI2l2ci1tZW51LWZvcm0gLmZvcndhcmRpbmctc2VsZWN0JykuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzRm9yUm91dGluZyhpdnJNZW51LmNiT25FeHRlbnNpb25TZWxlY3QpKTtcblx0XHQkKCcuZGVsZXRlLWFjdGlvbi1yb3cnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0Y29uc3QgaWQgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblx0XHRcdGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGRpZ2l0cy0ke2lkfWBdO1xuXHRcdFx0ZGVsZXRlIGl2ck1lbnUudmFsaWRhdGVSdWxlc1tgZXh0ZW5zaW9uLSR7aWR9YF07XG5cdFx0XHQkKGAjcm93LSR7aWR9YCkucmVtb3ZlKCk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9KTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGxldCByZXN1bHQgPSBzZXR0aW5ncztcblxuXHRcdHJlc3VsdC5kYXRhID0gaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0Y29uc3QgYXJyQWN0aW9ucyA9IFtdO1xuXG5cdFx0JCgnLmFjdGlvbi1yb3cnKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG5cdFx0XHRjb25zdCByb3dJZCA9ICQob2JqKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRpZiAocm93SWQgPiAwKSB7XG5cdFx0XHRcdGFyckFjdGlvbnMucHVzaCh7XG5cdFx0XHRcdFx0ZGlnaXRzOiBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGBkaWdpdHMtJHtyb3dJZH1gKSxcblx0XHRcdFx0XHRleHRlbnNpb246IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgYGV4dGVuc2lvbi0ke3Jvd0lkfWApLFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoYXJyQWN0aW9ucy5sZW5ndGggPT09IDApIHtcblx0XHRcdHJlc3VsdCA9IGZhbHNlO1xuXHRcdFx0aXZyTWVudS4kZXJyb3JNZXNzYWdlcy5odG1sKGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyk7XG5cdFx0XHRpdnJNZW51LiRmb3JtT2JqLmFkZENsYXNzKCdlcnJvcicpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHQuZGF0YS5hY3Rpb25zID0gSlNPTi5zdHJpbmdpZnkoYXJyQWN0aW9ucyk7XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdC8qKlxuXHQgKiDQodGA0LDQsdCw0YLRi9Cy0LDQtdGCINC/0YDQuCDQstGL0LHQvtGA0LUg0L3QvtC80LXRgNCwINC40Lcg0LLRi9C/0LDQtNCw0Y7RidC10LPQviDRgdC/0LjRgdC60LBcblx0ICovXG5cdGNiT25FeHRlbnNpb25TZWxlY3QoKSB7XG5cdFx0aXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGl2ck1lbnUuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWl2ci1tZW51L3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGl2ck1lbnUudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBpdnJNZW51LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBpdnJNZW51LmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5jaGVja0RvdWJsZXNEaWdpdHMgPSAodmFsdWUpID0+IHtcblx0bGV0IGNvdW50ID0gMDtcblx0JChcImlucHV0W2lkXj0nZGlnaXRzJ11cIikuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdGlmIChpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGAke29iai5pZH1gKSA9PT0gdmFsdWUpIGNvdW50ICs9IDE7XG5cdH0pO1xuXG5cdHJldHVybiAoY291bnQgPT09IDEpO1xufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRpdnJNZW51LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=